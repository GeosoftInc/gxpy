

<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>geosoft.gxpy.map &#8212; Geosoft GX Python API 2021.2.0 documentation</title>
    <link rel="stylesheet" href="../../../_static/maki.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
 
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-87443115-1']);
  _gaq.push(['_trackPageview']);
</script>

  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">Geosoft GX Python API 2021.2.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">geosoft.gxpy.map</a></li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Introduction</a></li>
    <li><a href="../../index.html">Module code</a></li>
</ul>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for geosoft.gxpy.map</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Geosoft maps contain one or more 2D and 3D views.</span>

<span class="sd">Each 2D view has a specific coordinate system and clip region.</span>
<span class="sd">Each 3D view is a link to a separate `geosoft_3dv` file, which can be placed in the map</span>
<span class="sd">as a 2D perspective of the last viewing state of the 3D view.</span>

<span class="sd">:Classes:</span>
<span class="sd">    :`Map`: map class</span>

<span class="sd">:Constants:</span>
<span class="sd">    :WRITE_NEW: `geosoft.gxapi.MAP_WRITENEW`</span>
<span class="sd">    :WRITE_OLD: `geosoft.gxapi.MAP_WRITEOLD`</span>

<span class="sd">    :LIST_ALL: `geosoft.gxapi.MAP_LIST_MODE_ALL`</span>
<span class="sd">    :LIST_3D: `geosoft.gxapi.MAP_LIST_MODE_3D`</span>
<span class="sd">    :LIST_2D: `geosoft.gxapi.MAP_LIST_MODE_NOT3D`</span>

<span class="sd">    :VIEW_NAME_SIZE: 2080</span>

<span class="sd">    :TEXT_BOTTOM_LEFT: -1</span>
<span class="sd">    :TEXT_BOTTOM_CENTER: 0</span>
<span class="sd">    :TEXT_BOTTOM_RIGHT: 1</span>
<span class="sd">    :TEXT_ALL_CENTER: 2</span>
<span class="sd">    :TEXT_BASE_LEFT: 3</span>
<span class="sd">    :TEXT_BASE_CENTER: 4</span>
<span class="sd">    :TEXT_BASE_RIGHT: 5</span>
<span class="sd">    :TEXT_BASE_ALL_CENTER: 6</span>
<span class="sd">    :TEXT_BASE_FIT_BY_CHARACTER_WIDTH: 7</span>
<span class="sd">    :TEXT_BASE_FIT_BY_CHARACTER_SIZE: 8</span>

<span class="sd">    :MAP_LANDSCAPE: 0</span>
<span class="sd">    :MAP_PORTRAIT: 1</span>

<span class="sd">    :TOP_IN: 1</span>
<span class="sd">    :TOP_OUT: -1</span>

<span class="sd">    :GRID_NONE: 0</span>
<span class="sd">    :GRID_DOTTED: 1</span>
<span class="sd">    :GRID_CROSSES: 2</span>
<span class="sd">    :GRID_LINES: 3</span>

<span class="sd">    :GROUP_NEW: 0</span>
<span class="sd">    :GROUP_APPEND: 1</span>

<span class="sd">    :VIEW_BASE: 0</span>
<span class="sd">    :VIEW_DATA: 1</span>

<span class="sd">    :STYLE_FIGURE: 0</span>
<span class="sd">    :STYLE_MAP: 1</span>

<span class="sd">    :RASTER_FORMAT_EMF: `geosoft.gxapi.MAP_EXPORT_RASTER_FORMAT_EMF`</span>
<span class="sd">    :RASTER_FORMAT_BMP: `geosoft.gxapi.MAP_EXPORT_RASTER_FORMAT_BMP`</span>
<span class="sd">    :RASTER_FORMAT_JPEGL: `geosoft.gxapi.MAP_EXPORT_RASTER_FORMAT_JPEGL`</span>
<span class="sd">    :RASTER_FORMAT_JPEG: `geosoft.gxapi.MAP_EXPORT_RASTER_FORMAT_JPEG`</span>
<span class="sd">    :RASTER_FORMAT_JPEGH: `geosoft.gxapi.MAP_EXPORT_RASTER_FORMAT_JPEGH`</span>
<span class="sd">    :RASTER_FORMAT_GIF: `geosoft.gxapi.MAP_EXPORT_RASTER_FORMAT_GIF`</span>
<span class="sd">    :RASTER_FORMAT_PCX: `geosoft.gxapi.MAP_EXPORT_RASTER_FORMAT_PCX`</span>
<span class="sd">    :RASTER_FORMAT_PNG: `geosoft.gxapi.MAP_EXPORT_RASTER_FORMAT_PNG`</span>
<span class="sd">    :RASTER_FORMAT_EPS: `geosoft.gxapi.MAP_EXPORT_RASTER_FORMAT_EPS`</span>
<span class="sd">    :RASTER_FORMAT_TIFF: `geosoft.gxapi.MAP_EXPORT_RASTER_FORMAT_TIFF`</span>

<span class="sd">.. seealso:: :mod:`geosoft.gxpy.view`, :mod:`geosoft.gxpy.group`</span>

<span class="sd">    :mod:`geosoft.gxapi.GXMAP`, :mod:`geosoft.gxapi.GXMVIEW`, :mod:`geosoft.gxapi.GXMVU`</span>

<span class="sd">.. note::</span>

<span class="sd">    Regression tests provide usage examples:</span>
<span class="sd">    `map tests &lt;https://github.com/GeosoftInc/gxpy/blob/master/geosoft/gxpy/tests/test_map.py&gt;`_</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">ceil</span>

<span class="kn">import</span> <span class="nn">geosoft</span>
<span class="kn">import</span> <span class="nn">geosoft.gxapi</span> <span class="k">as</span> <span class="nn">gxapi</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">gx</span> <span class="k">as</span> <span class="n">gx</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">grid</span> <span class="k">as</span> <span class="n">gxgrd</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">utility</span> <span class="k">as</span> <span class="n">gxu</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">dataframe</span> <span class="k">as</span> <span class="n">gxdf</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">group</span> <span class="k">as</span> <span class="n">gxg</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">view</span> <span class="k">as</span> <span class="n">gxv</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">geometry</span> <span class="k">as</span> <span class="n">gxgeo</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">coordinate_system</span> <span class="k">as</span> <span class="n">gxcs</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">metadata</span> <span class="k">as</span> <span class="n">gxmeta</span>

<span class="n">__version__</span> <span class="o">=</span> <span class="n">geosoft</span><span class="o">.</span><span class="n">__version__</span>


<span class="k">def</span> <span class="nf">_t</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">s</span>


<div class="viewcode-block" id="MapException"><a class="viewcode-back" href="../../../geosoft.gxpy.map.html#geosoft.gxpy.map.MapException">[docs]</a><span class="k">class</span> <span class="nc">MapException</span><span class="p">(</span><span class="n">geosoft</span><span class="o">.</span><span class="n">GXRuntimeError</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Exceptions from :mod:`geosoft.gxpy.map`.</span>

<span class="sd">    .. versionadded:: 9.2</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span></div>


<span class="n">WRITE_NEW</span> <span class="o">=</span> <span class="n">gxapi</span><span class="o">.</span><span class="n">MAP_WRITENEW</span>
<span class="n">WRITE_OLD</span> <span class="o">=</span> <span class="n">gxapi</span><span class="o">.</span><span class="n">MAP_WRITEOLD</span>

<span class="n">LIST_ALL</span> <span class="o">=</span> <span class="n">gxapi</span><span class="o">.</span><span class="n">MAP_LIST_MODE_ALL</span>
<span class="n">LIST_3D</span> <span class="o">=</span> <span class="n">gxapi</span><span class="o">.</span><span class="n">MAP_LIST_MODE_3D</span>
<span class="n">LIST_2D</span> <span class="o">=</span> <span class="n">gxapi</span><span class="o">.</span><span class="n">MAP_LIST_MODE_NOT3D</span>

<span class="n">VIEW_NAME_SIZE</span> <span class="o">=</span> <span class="mi">2080</span>

<span class="n">TEXT_BOTTOM_LEFT</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<span class="n">TEXT_BOTTOM_CENTER</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">TEXT_BOTTOM_RIGHT</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">TEXT_ALL_CENTER</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">TEXT_BASE_LEFT</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">TEXT_BASE_CENTER</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">TEXT_BASE_RIGHT</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">TEXT_BASE_ALL_CENTER</span> <span class="o">=</span> <span class="mi">6</span>
<span class="n">TEXT_BASE_FIT_BY_CHARACTER_WIDTH</span> <span class="o">=</span> <span class="mi">7</span>
<span class="n">TEXT_BASE_FIT_BY_CHARACTER_SIZE</span> <span class="o">=</span> <span class="mi">8</span>

<span class="n">MAP_LANDSCAPE</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">MAP_PORTRAIT</span> <span class="o">=</span> <span class="mi">1</span>

<span class="n">TOP_IN</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">TOP_OUT</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

<span class="n">GRID_NONE</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">GRID_DOTTED</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">GRID_CROSSES</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">GRID_LINES</span> <span class="o">=</span> <span class="mi">3</span>

<span class="n">GROUP_NEW</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">GROUP_APPEND</span> <span class="o">=</span> <span class="mi">1</span>

<span class="n">VIEW_BASE</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">VIEW_DATA</span> <span class="o">=</span> <span class="mi">1</span>

<span class="n">STYLE_FIGURE</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">STYLE_MAP</span> <span class="o">=</span> <span class="mi">1</span>

<span class="n">RASTER_FORMAT_EMF</span> <span class="o">=</span> <span class="n">gxapi</span><span class="o">.</span><span class="n">MAP_EXPORT_RASTER_FORMAT_EMF</span>
<span class="n">RASTER_FORMAT_BMP</span> <span class="o">=</span> <span class="n">gxapi</span><span class="o">.</span><span class="n">MAP_EXPORT_RASTER_FORMAT_BMP</span>
<span class="n">RASTER_FORMAT_JPEGL</span> <span class="o">=</span> <span class="n">gxapi</span><span class="o">.</span><span class="n">MAP_EXPORT_RASTER_FORMAT_JPEGL</span>
<span class="n">RASTER_FORMAT_JPEG</span>  <span class="o">=</span> <span class="n">gxapi</span><span class="o">.</span><span class="n">MAP_EXPORT_RASTER_FORMAT_JPEG</span>
<span class="n">RASTER_FORMAT_JPEGH</span> <span class="o">=</span> <span class="n">gxapi</span><span class="o">.</span><span class="n">MAP_EXPORT_RASTER_FORMAT_JPEGH</span>
<span class="n">RASTER_FORMAT_GIF</span> <span class="o">=</span> <span class="n">gxapi</span><span class="o">.</span><span class="n">MAP_EXPORT_RASTER_FORMAT_GIF</span>
<span class="n">RASTER_FORMAT_PCX</span> <span class="o">=</span> <span class="n">gxapi</span><span class="o">.</span><span class="n">MAP_EXPORT_RASTER_FORMAT_PCX</span>
<span class="n">RASTER_FORMAT_PNG</span> <span class="o">=</span> <span class="n">gxapi</span><span class="o">.</span><span class="n">MAP_EXPORT_RASTER_FORMAT_PNG</span>
<span class="n">RASTER_FORMAT_EPS</span> <span class="o">=</span> <span class="n">gxapi</span><span class="o">.</span><span class="n">MAP_EXPORT_RASTER_FORMAT_EPS</span>
<span class="n">RASTER_FORMAT_TIFF</span>  <span class="o">=</span> <span class="n">gxapi</span><span class="o">.</span><span class="n">MAP_EXPORT_RASTER_FORMAT_TIFF</span>

<div class="viewcode-block" id="map_file_name"><a class="viewcode-back" href="../../../geosoft.gxpy.map.html#geosoft.gxpy.map.map_file_name">[docs]</a><span class="k">def</span> <span class="nf">map_file_name</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">file_type</span><span class="o">=</span><span class="s1">&#39;map&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return a fully resolved map file path using the file name, with .map extension</span>

<span class="sd">    :param file_name:   file name, with ot without path and/or extension</span>
<span class="sd">    :param file_type:   Geosoft file type, &#39;map&#39; or &#39;geosoft_3dv&#39; expected.  Default is &#39;map&#39;</span>
<span class="sd">    :returns:           file name path with extension .map</span>

<span class="sd">    .. versionadded:: 9.2</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">file_name</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">ext</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;.map&#39;</span><span class="p">,</span> <span class="s1">&#39;.geosoft_3dv&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">file_type</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;.&#39;</span><span class="p">:</span>
            <span class="n">file_name</span> <span class="o">=</span> <span class="n">file_name</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">file_type</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">file_name</span> <span class="o">+=</span> <span class="n">file_type</span>
    <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span></div>


<div class="viewcode-block" id="delete_files"><a class="viewcode-back" href="../../../geosoft.gxpy.map.html#geosoft.gxpy.map.delete_files">[docs]</a><span class="k">def</span> <span class="nf">delete_files</span><span class="p">(</span><span class="n">file_name</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Delete all files associated with this map name.</span>

<span class="sd">    :param file_name:</span>

<span class="sd">    .. versionadded:: 9.2</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="n">fn</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
            <span class="k">pass</span>

    <span class="n">file_name</span> <span class="o">=</span> <span class="n">map_file_name</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>

    <span class="c1"># remove child files, if any</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">meta</span> <span class="o">=</span> <span class="n">Map</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span><span class="o">.</span><span class="n">metadata</span>
        <span class="n">views</span> <span class="o">=</span> <span class="n">gxmeta</span><span class="o">.</span><span class="n">get_node_from_meta_dict</span><span class="p">(</span><span class="s1">&#39;geosoft/dataset/map/views&#39;</span><span class="p">,</span> <span class="n">meta</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">views</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">views</span><span class="p">:</span>
                <span class="n">child_files</span> <span class="o">=</span> <span class="n">gxmeta</span><span class="o">.</span><span class="n">get_node_from_meta_dict</span><span class="p">(</span><span class="n">v</span> <span class="o">+</span> <span class="s1">&#39;/child_files&#39;</span><span class="p">,</span> <span class="n">views</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">child_files</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">child_files</span><span class="p">:</span>
                        <span class="n">remove</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="n">remove</span><span class="p">(</span><span class="n">file_name</span> <span class="o">+</span> <span class="s1">&#39;.xml&#39;</span><span class="p">)</span>
    <span class="n">remove</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">file_name</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.mdf&#39;</span><span class="p">)</span>
    <span class="n">remove</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span></div>


<div class="viewcode-block" id="save_as_image"><a class="viewcode-back" href="../../../geosoft.gxpy.map.html#geosoft.gxpy.map.save_as_image">[docs]</a><span class="k">def</span> <span class="nf">save_as_image</span><span class="p">(</span><span class="n">mapfile</span><span class="p">,</span> <span class="n">imagefile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">RASTER_FORMAT_PNG</span><span class="p">,</span> <span class="n">pix_width</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">pix_height</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">pix_32_bit</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Save a map file to an image file</span>

<span class="sd">    :param mapfile:     map or geosoft_3dv file name</span>
<span class="sd">    :param imagefile:   name of the output raster file, default is a temporary png file.</span>
<span class="sd">    :param type:        one of the RASTER_FORMAT types, default`RASTER_FORMAT_PNG`</span>
<span class="sd">    :param pix_width:   image pixel width, if 0 use pix_height only</span>
<span class="sd">    :param pix_height:  image pixel height, if 0 use pix_width only</span>
<span class="sd">    :param pix_32_bit:  make 32-bit image (with 8-bit alpha background)</span>

<span class="sd">    .. versionadded:: 9.2</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="n">Map</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">mapfile</span><span class="p">)</span><span class="o">.</span><span class="n">image_file</span><span class="p">(</span><span class="n">imagefile</span><span class="o">=</span><span class="n">imagefile</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">type</span><span class="p">,</span>
                                        <span class="n">pix_width</span><span class="o">=</span><span class="n">pix_width</span><span class="p">,</span> <span class="n">pix_height</span><span class="o">=</span><span class="n">pix_height</span><span class="p">,</span> <span class="n">pix_32_bit</span><span class="o">=</span><span class="n">pix_32_bit</span><span class="p">)</span></div>


<div class="viewcode-block" id="crc_map"><a class="viewcode-back" href="../../../geosoft.gxpy.map.html#geosoft.gxpy.map.crc_map">[docs]</a><span class="k">def</span> <span class="nf">crc_map</span><span class="p">(</span><span class="n">mapfile</span><span class="p">,</span> <span class="n">pix_width</span><span class="o">=</span><span class="mi">1000</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the CRC of a map based on the output bitmap image.</span>

<span class="sd">    :param mapfile:     name of the map file</span>
<span class="sd">    :param pix_width:   image pixel width - use a higher resolution to test more detail</span>
<span class="sd">    :returns:           CRC as an int</span>

<span class="sd">    .. versionadded:: 9.2</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">Map</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">mapfile</span><span class="p">)</span><span class="o">.</span><span class="n">crc_image</span><span class="p">(</span><span class="n">pix_width</span><span class="o">=</span><span class="n">pix_width</span><span class="p">)</span></div>

<div class="viewcode-block" id="Map"><a class="viewcode-back" href="../../../geosoft.gxpy.map.html#geosoft.gxpy.map.Map">[docs]</a><span class="k">class</span> <span class="nc">Map</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Geosoft map files.</span>

<span class="sd">    A Geosoft map is a container for views.  A view has a defined coordinate system (2D or 3D) and</span>
<span class="sd">    contains groups of graphical elements defined relative to the coordinate system of the view.  The</span>
<span class="sd">    :mod:`geosoft.gxpy.view` module provides classes and methods for working with individual 2D or</span>
<span class="sd">    3D views, and the :mod:`geosoft.gxpy.group` modules contains classes that deal with drawing groups..</span>

<span class="sd">    Geosoft maps will always have a 2D &#39;base&#39; view and is intended for drawing map annotations, such as titles,</span>
<span class="sd">    a scale bar, North arrow and legends.  The lower-left corner of the base view ia at location (0, 0) and the</span>
<span class="sd">    upper-right corner is defined by the media size and may be adjusted to fit the data view.</span>

<span class="sd">    When drawing to the base view the native unit is millimetres and locations and graphic entity</span>
<span class="sd">    sizes are assumed to be mm.  When drawing to the map using map methods the units are in map cm,</span>
<span class="sd">    including graphic entity scaling.</span>

<span class="sd">    Maps will also have one or more data views, each with it&#39;s own defined coordinate system</span>
<span class="sd">    and graphical content.  Creating a new map will create one data view, which will become the map&#39;s</span>
<span class="sd">    `current_data_view`, within which any spatial data drawn by Geosoft 2D drawing applications</span>
<span class="sd">    will be placed.  Maps may have more than one data view, including 3D data views, and the</span>
<span class="sd">    `current_data_view` can be changed to any 2D or 3D view, and subsequent drawing will be placed</span>
<span class="sd">    in that view.</span>

<span class="sd">    3D views define a 3D spatial volume and accept both 2D and 3D drawing elements.  A 3D view will always</span>
<span class="sd">    contain a plane or surface on which 2D elements are drawn, and when a 3D view is the</span>
<span class="sd">    `default data view`, 2D elements will be drawn to the identified plane or surface.  When a 3D view is</span>
<span class="sd">    rendered on a map, which is a flat surface, the view is rendered from the last use point of view.  Geosoft</span>
<span class="sd">    map viewing applications allow a user to open a 3D view in a 3D viewer, which provides for 3D viewing,</span>
<span class="sd">    3D navigation and 3D drawing capabilities.</span>

<span class="sd">    :Constructors:</span>

<span class="sd">        ============ ========================================</span>
<span class="sd">        :meth:`open` open an existing map</span>
<span class="sd">        :meth:`new`  create a new map</span>
<span class="sd">        ============ ========================================</span>

<span class="sd">    .. versionadded:: 9.2</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xtype</span><span class="p">,</span> <span class="n">xvalue</span><span class="p">,</span> <span class="n">xtraceback</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="fm">__del__</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_close&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_close</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">(</span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file_name</span>

<div class="viewcode-block" id="Map.__init__"><a class="viewcode-back" href="../../../geosoft.gxpy.map.html#geosoft.gxpy.map.Map.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">WRITE_NEW</span><span class="p">,</span> <span class="n">_internal</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">gxmap</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">_internal</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">MapException</span><span class="p">(</span><span class="n">_t</span><span class="p">(</span><span class="s2">&quot;Map must be created from Map.new(), or Map.open(), or Map.from_gxapi().&quot;</span><span class="p">))</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_gx</span> <span class="o">=</span> <span class="n">gx</span><span class="o">.</span><span class="n">gx</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_remove</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">gxmap</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_gxmap</span> <span class="o">=</span> <span class="n">gxmap</span>
            <span class="n">file_name_ref</span> <span class="o">=</span> <span class="n">gxapi</span><span class="o">.</span><span class="n">str_ref</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_gxmap</span><span class="o">.</span><span class="n">get_file_name</span><span class="p">(</span><span class="n">file_name_ref</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_file_name</span> <span class="o">=</span> <span class="n">map_file_name</span><span class="p">(</span><span class="n">file_name_ref</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_file_name</span> <span class="o">=</span> <span class="n">map_file_name</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_gxmap</span> <span class="o">=</span> <span class="n">gxapi</span><span class="o">.</span><span class="n">GXMAP</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_name</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_file_name</span><span class="p">)[</span><span class="mi">1</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_annotation_outer_edge</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_metadata_changed</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_metadata_root</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_open</span> <span class="o">=</span> <span class="n">gx</span><span class="o">.</span><span class="n">track_resource</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file_name</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_close</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pop</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_open&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_open</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gxmap</span><span class="p">:</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">_gxmap</span> <span class="o">=</span> <span class="kc">None</span>

                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metadata_changed</span><span class="p">:</span>
                        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_file_name</span> <span class="o">+</span> <span class="s1">&#39;.xml&#39;</span><span class="p">,</span> <span class="s1">&#39;w+&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">gxu</span><span class="o">.</span><span class="n">xml_from_dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span><span class="p">))</span>
                        <span class="n">gxapi</span><span class="o">.</span><span class="n">GXMAP</span><span class="o">.</span><span class="n">sync</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_file_name</span><span class="p">)</span>

                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_remove</span><span class="p">:</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">delete_files</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_file_name</span><span class="p">)</span>
                        <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
                            <span class="c1"># TODO We ignore this and it can be reproduced by using with statement with some exception.</span>
                            <span class="c1"># E.g. in test_grid.test_image_file without an IMG DAT dll present. Should be investigated.</span>
                            <span class="c1"># See issue #82</span>
                            <span class="k">pass</span>
                <span class="k">if</span> <span class="n">pop</span><span class="p">:</span>
                    <span class="n">gx</span><span class="o">.</span><span class="n">pop_resource</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_open</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_open</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="Map.from_gxapi"><a class="viewcode-back" href="../../../geosoft.gxpy.map.html#geosoft.gxpy.map.Map.from_gxapi">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_gxapi</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">gxmap</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Instantiate Map from gxapi instance.</span>

<span class="sd">        :param gxmap:    a gxapi.CGXMAP</span>

<span class="sd">        .. versionadded:: 9.9</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">gxmap</span><span class="o">=</span><span class="n">gxmap</span><span class="p">,</span> <span class="n">_internal</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="Map.open"><a class="viewcode-back" href="../../../geosoft.gxpy.map.html#geosoft.gxpy.map.Map.open">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">open</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">file_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Open an existing map file.</span>

<span class="sd">        :param file_name:    name of the map file</span>

<span class="sd">        .. versionadded:: 9.2</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nb">map</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">WRITE_OLD</span><span class="p">,</span> <span class="n">_internal</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">map</span></div>

<div class="viewcode-block" id="Map.new"><a class="viewcode-back" href="../../../geosoft.gxpy.map.html#geosoft.gxpy.map.Map.new">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">new</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span>
            <span class="n">file_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">data_area</span><span class="o">=</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">100.</span><span class="p">,</span> <span class="mf">100.</span><span class="p">),</span>
            <span class="n">scale</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">coordinate_system</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">media</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">layout</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">fixed_size</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">map_style</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">margins</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">inside_margin</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">no_data_view</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create and open a new Geosoft map.</span>

<span class="sd">        :parameters:</span>
<span class="sd">            :file_name:         Map file name.  If not specified a temporary file is created in the instance</span>
<span class="sd">                                temporary folder.  Use ``file_name()`` to get the file name if needed.  The</span>
<span class="sd">                                temporary map file will be unique and will exist through the life of the</span>
<span class="sd">                                Python GX instance, but will be deleted along with all temporary files</span>
<span class="sd">                                when the GX loses context.</span>
<span class="sd">            :data_area:         (min_x, min_y, max_x, max_y) data area for a 2D data view on the map</span>
<span class="sd">            :scale:             required scale, default will fit data to the map media</span>
<span class="sd">            :coordinate_system: coordinate system, default is an unknown coordinate system.  You may pass</span>
<span class="sd">                                a :class:`geosoft.gxpy.coordinate_system.Coordinate_system` instance, a string</span>
<span class="sd">                                descriptor, such as &#39;`WGS 84 / UTM zone 15N`&#39;, or another valid constructor supported</span>
<span class="sd">                                by :class:`geosoft.gxpy.coordinate_system.Coordinate_system`.</span>
<span class="sd">            :media:             media size as a tuple (x_cm, y_cm), or as a standard media name string.</span>
<span class="sd">                                If the media string contains &#39;portrait&#39;, the media aspect will be portrait.</span>
<span class="sd">                                Named media sizes are read from media.csv, which includes A4, A3, A2, A1, A0,</span>
<span class="sd">                                letter, legal, ledger, A, B, C, D, E. For example `media=&#39;A4 portrait&#39;`.</span>
<span class="sd">            :layout:            MAP_PORTRAIT or MAP_LANDSCAPE, overrides media setting.  If the layout is not</span>
<span class="sd">                                defined by media or this parameter, the layout is determined by the aspect</span>
<span class="sd">                                ratio of the data area.</span>
<span class="sd">            :map_style:         STYLE_FIGURE or STYLE_MAP (default).  A MAP style is intended for A3 or larger</span>
<span class="sd">                                media with a larger right or left margin for map annotations.  A FIGURE</span>
<span class="sd">                                style is intended for smaller media with a larger bottom margin for a</span>
<span class="sd">                                title and limited annotations.</span>
<span class="sd">            :fixed_size:        True for fixed media size, if, and only if, a media size is defined.</span>
<span class="sd">                                If False, the base view boundary will be reduced to the data view plus margins.</span>
<span class="sd">                                If True, the base view boundary is fixed to the media size and margins are</span>
<span class="sd">                                adjusted to locate the data view proportionally relative to the requested margins.</span>
<span class="sd">            :margins:           (left, right, bottom, top) map margins in map cm.  The default for STYLE_MAP</span>
<span class="sd">                                is (3, 14, 6, 3), and for figure (1, 4, 1, 1).</span>
<span class="sd">            :inside_margin:     additional margin (cm) inside the base view.  This margin effectively</span>
<span class="sd">                                expands the data_area to allow room for graphical elements related to</span>
<span class="sd">                                spatial data near the edge of the defined data area.</span>
<span class="sd">            :overwrite:         `True` to overwrite map file should it exist</span>
<span class="sd">            :no_data_view:      True to create a map without a &#39;data&#39; view. Use :class:`geosoft.gxpy.view.View` and</span>
<span class="sd">                                :class:`geosoft.gxpy.view.View_3d` to add data views to a map.</span>

<span class="sd">        .. versionadded:: 9.2</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">data_window_on_map</span><span class="p">():</span>
            <span class="n">mx</span> <span class="o">=</span> <span class="n">media</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">m_left</span> <span class="o">-</span> <span class="n">m_right</span>
            <span class="n">my</span> <span class="o">=</span> <span class="n">media</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">m_bottom</span> <span class="o">-</span> <span class="n">m_top</span>
            <span class="n">im</span> <span class="o">=</span> <span class="n">inside_margin</span> <span class="o">*</span> <span class="mi">2</span>
            <span class="k">return</span> <span class="n">mx</span> <span class="o">-</span> <span class="n">im</span><span class="p">,</span> <span class="n">my</span> <span class="o">-</span> <span class="n">im</span>  <span class="c1"># data window on map cm</span>

        <span class="k">def</span> <span class="nf">set_registry</span><span class="p">(</span><span class="nb">map</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="n">inside_margin</span><span class="p">):</span>
            <span class="n">rd</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;MAP.STYLE&#39;</span><span class="p">:</span> <span class="n">style</span><span class="p">,</span>
                  <span class="s1">&#39;MAP.MARGIN_INSIDE&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">inside_margin</span><span class="p">),</span>
                  <span class="s1">&#39;MAP.UP_DIRECTION&#39;</span><span class="p">:</span> <span class="s1">&#39;right&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;MAP.UP_ANGLE&#39;</span><span class="p">:</span> <span class="s1">&#39;67.5&#39;</span><span class="p">}</span>
            <span class="nb">map</span><span class="o">.</span><span class="n">gxmap</span><span class="o">.</span><span class="n">set_reg</span><span class="p">(</span><span class="n">gxu</span><span class="o">.</span><span class="n">reg_from_dict</span><span class="p">(</span><span class="n">rd</span><span class="p">))</span>

        <span class="k">if</span> <span class="p">((</span><span class="n">data_area</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">data_area</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">((</span><span class="n">data_area</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">data_area</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">MapException</span><span class="p">(</span><span class="n">_t</span><span class="p">(</span><span class="s1">&#39;Invalid data area </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data_area</span><span class="p">)))</span>

        <span class="k">if</span> <span class="n">layout</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">data_area</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">data_area</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">data_area</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">data_area</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                <span class="n">layout</span> <span class="o">=</span> <span class="n">MAP_PORTRAIT</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">layout</span> <span class="o">=</span> <span class="n">MAP_LANDSCAPE</span>

        <span class="k">if</span> <span class="n">file_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">file_name</span> <span class="o">=</span> <span class="n">gx</span><span class="o">.</span><span class="n">gx</span><span class="p">()</span><span class="o">.</span><span class="n">temp_file</span><span class="p">(</span><span class="s1">&#39;.map&#39;</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">overwrite</span><span class="p">:</span>
                <span class="n">file_name</span> <span class="o">=</span> <span class="n">map_file_name</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">file_name</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="n">MapException</span><span class="p">(</span><span class="n">_t</span><span class="p">(</span><span class="s1">&#39;Cannot overwrite existing file: &quot;</span><span class="si">{}</span><span class="s1">&quot;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">file_name</span><span class="p">))</span>

        <span class="nb">map</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">WRITE_NEW</span><span class="p">,</span> <span class="n">_internal</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">media</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">spec</span> <span class="o">=</span> <span class="n">gxdf</span><span class="o">.</span><span class="n">table_record</span><span class="p">(</span><span class="s1">&#39;media&#39;</span><span class="p">,</span> <span class="n">media</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
                <span class="n">media</span> <span class="o">=</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">spec</span><span class="p">[</span><span class="s1">&#39;SIZE_X&#39;</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">spec</span><span class="p">[</span><span class="s1">&#39;SIZE_Y&#39;</span><span class="p">]))</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">media</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">fixed_size</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">map_style</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">map_style</span> <span class="o">=</span> <span class="n">STYLE_FIGURE</span>

        <span class="k">if</span> <span class="n">media</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fixed_size</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="n">scale</span><span class="p">:</span>
                <span class="n">media</span> <span class="o">=</span> <span class="p">(</span><span class="mf">5000.</span><span class="p">,</span> <span class="mf">4000.</span><span class="p">)</span>  <span class="c1"># crazy large, will be trimmed to scale</span>
                <span class="k">if</span> <span class="n">margins</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">map_style</span> <span class="o">==</span> <span class="n">STYLE_MAP</span><span class="p">:</span>
                        <span class="n">margins</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">14.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">margins</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">media</span> <span class="o">=</span> <span class="p">(</span><span class="mf">50.</span><span class="p">,</span> <span class="mf">40.</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">layout</span> <span class="o">==</span> <span class="n">MAP_PORTRAIT</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">media</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">media</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">media</span> <span class="o">=</span> <span class="p">(</span><span class="n">media</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">media</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">margins</span><span class="p">:</span>
            <span class="n">m_left</span><span class="p">,</span> <span class="n">m_right</span><span class="p">,</span> <span class="n">m_bottom</span><span class="p">,</span> <span class="n">m_top</span> <span class="o">=</span> <span class="n">margins</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">mx</span><span class="p">,</span> <span class="n">my</span> <span class="o">=</span> <span class="n">media</span>
            <span class="k">if</span> <span class="n">map_style</span> <span class="o">==</span> <span class="n">STYLE_MAP</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">mx</span> <span class="o">&lt;=</span> <span class="mf">30.0</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">MapException</span><span class="p">(</span><span class="n">_t</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\&#39;</span><span class="s1">map</span><span class="se">\&#39;</span><span class="s1"> style requires minimum 30cm media. Yours is </span><span class="si">{}</span><span class="s1">cm&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mx</span><span class="p">)))</span>
                <span class="n">m_left</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">mx</span> <span class="o">*</span> <span class="mf">0.025</span><span class="p">)</span>
                <span class="n">m_right</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">14.0</span><span class="p">,</span> <span class="n">mx</span> <span class="o">*</span> <span class="mf">0.15</span><span class="p">)</span>
                <span class="n">m_bottom</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">5.0</span><span class="p">,</span> <span class="n">my</span> <span class="o">*</span> <span class="mf">0.1</span><span class="p">)</span>
                <span class="n">m_top</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">my</span> <span class="o">*</span> <span class="mf">0.025</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">m_left</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">mx</span> <span class="o">*</span> <span class="mf">0.04</span><span class="p">)</span>
                <span class="n">m_right</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">mx</span> <span class="o">*</span> <span class="mf">0.04</span><span class="p">)</span>
                <span class="n">m_bottom</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">4.0</span><span class="p">,</span> <span class="n">my</span> <span class="o">*</span> <span class="mf">0.15</span><span class="p">)</span>
                <span class="n">m_top</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">my</span> <span class="o">*</span> <span class="mf">0.04</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">scale</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># determine largest scale to fit the media</span>
            <span class="n">mx</span><span class="p">,</span> <span class="n">my</span> <span class="o">=</span> <span class="n">data_window_on_map</span><span class="p">()</span>
            <span class="n">sx</span> <span class="o">=</span> <span class="p">(</span><span class="n">data_area</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">data_area</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="mf">100.0</span> <span class="o">/</span> <span class="n">mx</span>
            <span class="n">sy</span> <span class="o">=</span> <span class="p">(</span><span class="n">data_area</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">data_area</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="mf">100.0</span> <span class="o">/</span> <span class="n">my</span>
            <span class="n">scale</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">gxu</span><span class="o">.</span><span class="n">str_significant</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">sx</span><span class="p">,</span> <span class="n">sy</span><span class="p">),</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">fixed_size</span><span class="p">:</span>
            <span class="n">mx</span><span class="p">,</span> <span class="n">my</span> <span class="o">=</span> <span class="n">data_window_on_map</span><span class="p">()</span>
            <span class="n">x_adjust</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="p">(</span><span class="n">mx</span> <span class="o">-</span> <span class="p">((</span><span class="n">data_area</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">data_area</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="mf">100.0</span> <span class="o">/</span> <span class="n">scale</span><span class="p">))</span> <span class="o">*</span> <span class="mf">0.5</span><span class="p">)</span>
            <span class="n">y_adjust</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="p">(</span><span class="n">my</span> <span class="o">-</span> <span class="p">((</span><span class="n">data_area</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">data_area</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="mf">100.0</span> <span class="o">/</span> <span class="n">scale</span><span class="p">))</span> <span class="o">*</span> <span class="mf">0.5</span><span class="p">)</span>
            <span class="n">m_left</span> <span class="o">+=</span> <span class="n">x_adjust</span>
            <span class="n">m_right</span> <span class="o">+=</span> <span class="n">x_adjust</span>
            <span class="n">m_bottom</span> <span class="o">+=</span> <span class="n">y_adjust</span>
            <span class="n">m_top</span> <span class="o">+=</span> <span class="n">y_adjust</span>

        <span class="c1"># ensure the data fits on this media</span>
        <span class="n">mx</span><span class="p">,</span> <span class="n">my</span> <span class="o">=</span> <span class="n">data_window_on_map</span><span class="p">()</span>
        <span class="n">dmx</span> <span class="o">=</span> <span class="p">(</span><span class="n">data_area</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">data_area</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="mf">100.0</span> <span class="o">/</span> <span class="n">scale</span>
        <span class="n">dmy</span> <span class="o">=</span> <span class="p">(</span><span class="n">data_area</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">data_area</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="mf">100.0</span> <span class="o">/</span> <span class="n">scale</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">mx</span> <span class="o">-</span> <span class="n">dmx</span><span class="p">)</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">0.01</span> <span class="ow">or</span> <span class="p">(</span><span class="n">my</span> <span class="o">-</span> <span class="n">dmy</span><span class="p">)</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">0.01</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">MapException</span><span class="p">(</span><span class="n">_t</span><span class="p">(</span><span class="s1">&#39;The data does not fit media (</span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="s1">)cm at a scale of 1:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="p">)</span>
                               <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">media</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">media</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">scale</span><span class="p">))</span>

        <span class="n">gxapi</span><span class="o">.</span><span class="n">GXMVU</span><span class="o">.</span><span class="n">mapset</span><span class="p">(</span><span class="nb">map</span><span class="o">.</span><span class="n">gxmap</span><span class="p">,</span>
                           <span class="s1">&#39;base&#39;</span><span class="p">,</span>
                           <span class="s1">&#39;&#39;</span> <span class="k">if</span> <span class="n">no_data_view</span> <span class="k">else</span> <span class="s1">&#39;data&#39;</span><span class="p">,</span>
                           <span class="n">data_area</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">data_area</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                           <span class="n">data_area</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">data_area</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
                           <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">media</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mf">50.0</span><span class="p">,</span> <span class="n">media</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mf">50.0</span><span class="p">),</span> <span class="n">layout</span><span class="p">,</span>
                           <span class="mi">0</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="n">gxapi</span><span class="o">.</span><span class="n">rDUMMY</span><span class="p">,</span>
                           <span class="n">m_left</span><span class="p">,</span> <span class="n">m_right</span><span class="p">,</span> <span class="n">m_bottom</span><span class="p">,</span> <span class="n">m_top</span><span class="p">,</span>
                           <span class="nb">float</span><span class="p">(</span><span class="n">inside_margin</span><span class="p">))</span>

        <span class="k">with</span> <span class="n">gxv</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="nb">map</span><span class="p">,</span> <span class="s1">&#39;*data&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">view</span><span class="p">:</span>
            <span class="n">view</span><span class="o">.</span><span class="n">coordinate_system</span> <span class="o">=</span> <span class="n">coordinate_system</span>
        <span class="n">set_registry</span><span class="p">(</span><span class="nb">map</span><span class="p">,</span>
                     <span class="s1">&#39;figure&#39;</span> <span class="k">if</span> <span class="p">(</span><span class="n">map_style</span> <span class="o">==</span> <span class="n">STYLE_FIGURE</span><span class="p">)</span> <span class="k">else</span> <span class="s1">&#39;map&#39;</span><span class="p">,</span>
                     <span class="n">inside_margin</span><span class="p">)</span>

        <span class="nb">map</span><span class="o">.</span><span class="n">_make_base_mm</span><span class="p">()</span>

        <span class="k">return</span> <span class="nb">map</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">gxmap</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; The :class:`geosoft.gxapi.GXMAP` instance handle.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gxmap</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;map name, which is to root name of the map file&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">file_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        full map file path name.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file_name</span>

    <span class="k">def</span> <span class="nf">_init_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span> <span class="o">=</span> <span class="n">gxu</span><span class="o">.</span><span class="n">geosoft_metadata</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_file_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_metadata_root</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span><span class="o">.</span><span class="n">items</span><span class="p">())[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the map file metadata as a dictionary.  Can be set, in which case</span>
<span class="sd">        the dictionary items passed will be added to, or replace existing metadata.</span>

<span class="sd">        .. versionadded:: 9.2</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init_metadata</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_metadata_root</span><span class="p">]</span>

    <span class="nd">@metadata</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">meta</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init_metadata</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_metadata_root</span><span class="p">]</span> <span class="o">=</span> <span class="n">gxu</span><span class="o">.</span><span class="n">merge_dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_metadata_root</span><span class="p">],</span> <span class="n">meta</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_metadata_changed</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">current_data_view</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Name of the current default data view which accepts drawing groups from Geosoft methods that do not</span>
<span class="sd">        explicitly identify a view.</span>

<span class="sd">        Set this to a view name that should accept default drawing groups.</span>

<span class="sd">        If this is a 3D view, new 2D groups are placed on the default drawing plane of the view.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_class_name</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">)</span>

    <span class="nd">@current_data_view</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">current_data_view</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_view</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">MapException</span><span class="p">(</span><span class="n">_t</span><span class="p">(</span><span class="s1">&#39;Map does not contain a view named &quot;</span><span class="si">{}</span><span class="s1">&quot;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gxmap</span><span class="o">.</span><span class="n">set_class_name</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">current_base_view</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Name of the current default base view which accepts map annotation drawing groups</span>
<span class="sd">        (like titles, North arrow, etc.) from Geosoft methods.</span>

<span class="sd">        This can be set, though Geosoft uses the &#39;base&#39; view in most standard cases.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_class_name</span><span class="p">(</span><span class="s1">&#39;base&#39;</span><span class="p">)</span>

    <span class="nd">@current_base_view</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">current_base_view</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_view</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">MapException</span><span class="p">(</span><span class="n">_t</span><span class="p">(</span><span class="s1">&#39;Map does not contain a view named &quot;</span><span class="si">{}</span><span class="s1">&quot;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gxmap</span><span class="o">.</span><span class="n">set_class_name</span><span class="p">(</span><span class="s1">&#39;base&#39;</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">current_section_view</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Name of the current default section view which accepts drawing commands to a section</span>
<span class="sd">        from Geosoft methods.</span>

<span class="sd">        Can be set.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_class_name</span><span class="p">(</span><span class="s1">&#39;section&#39;</span><span class="p">)</span>

    <span class="nd">@current_section_view</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">current_section_view</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_view</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">MapException</span><span class="p">(</span><span class="n">_t</span><span class="p">(</span><span class="s1">&#39;Map does not contain a view named &quot;</span><span class="si">{}</span><span class="s1">&quot;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gxmap</span><span class="o">.</span><span class="n">set_class_name</span><span class="p">(</span><span class="s1">&#39;section&#39;</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">map_scale</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Map scale, based on the current default &quot;data&quot; view if it exists.</span>

<span class="sd">        WARNING: If the &quot;data&quot; view is open this returns 1000. TODO - add test for open views.</span>

<span class="sd">        Can be set, but must not be called if any views are open. Resetting the map scale changes the</span>
<span class="sd">        scale of all views in the map.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">gxmap</span><span class="o">.</span><span class="n">get_map_scale</span><span class="p">()</span>

    <span class="nd">@map_scale</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">map_scale</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scale</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">scale</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gxmap</span><span class="o">.</span><span class="n">set_map_scale</span><span class="p">(</span><span class="n">scale</span><span class="p">)</span>

<div class="viewcode-block" id="Map.close"><a class="viewcode-back" href="../../../geosoft.gxpy.map.html#geosoft.gxpy.map.Map.close">[docs]</a>    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Close the map and release resources. &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_close</span><span class="p">()</span></div>

<div class="viewcode-block" id="Map.remove_on_close"><a class="viewcode-back" href="../../../geosoft.gxpy.map.html#geosoft.gxpy.map.Map.remove_on_close">[docs]</a>    <span class="k">def</span> <span class="nf">remove_on_close</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">remove</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param remove:  if True (the default), remove the map file when finished.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_remove</span> <span class="o">=</span> <span class="n">remove</span></div>

<div class="viewcode-block" id="Map.commit_changes"><a class="viewcode-back" href="../../../geosoft.gxpy.map.html#geosoft.gxpy.map.Map.commit_changes">[docs]</a>    <span class="k">def</span> <span class="nf">commit_changes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Commit changes to the map.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gxmap</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">_make_base_cm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_view</span><span class="p">(</span><span class="s1">&#39;*base&#39;</span><span class="p">):</span>
            <span class="k">with</span> <span class="n">gxv</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;*base&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">view</span><span class="p">:</span>
                <span class="n">ex_cm</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">extent_map_cm</span><span class="p">()</span>
                <span class="n">view</span><span class="o">.</span><span class="n">locate</span><span class="p">(</span><span class="n">gxcs</span><span class="o">.</span><span class="n">Coordinate_system</span><span class="p">(</span><span class="s1">&#39;cm&#39;</span><span class="p">),</span>
                            <span class="n">map_location</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span>
                            <span class="n">area</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ex_cm</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">ex_cm</span><span class="p">[</span><span class="mi">3</span><span class="p">]),</span>
                            <span class="n">scale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
                <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">_make_base_mm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_view</span><span class="p">(</span><span class="s1">&#39;*base&#39;</span><span class="p">):</span>
            <span class="k">with</span> <span class="n">gxv</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;*base&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">view</span><span class="p">:</span>
                <span class="n">ex_cm</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">extent_map_cm</span><span class="p">()</span>
                <span class="n">view</span><span class="o">.</span><span class="n">locate</span><span class="p">(</span><span class="n">gxcs</span><span class="o">.</span><span class="n">Coordinate_system</span><span class="p">(</span><span class="s1">&#39;mm&#39;</span><span class="p">),</span>
                            <span class="n">map_location</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                            <span class="n">area</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ex_cm</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="mf">10.</span><span class="p">,</span> <span class="n">ex_cm</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="mf">10.</span><span class="p">),</span>
                            <span class="n">scale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
                <span class="k">pass</span>

<div class="viewcode-block" id="Map.extent_data_views"><a class="viewcode-back" href="../../../geosoft.gxpy.map.html#geosoft.gxpy.map.Map.extent_data_views">[docs]</a>    <span class="k">def</span> <span class="nf">extent_data_views</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the extent of all data views on the map in map cm.</span>

<span class="sd">        .. versionadded:: 9.2</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="nf">extents</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="n">ext</span><span class="p">):</span>
            <span class="n">ex</span> <span class="o">=</span> <span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">ex</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ext</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                  <span class="nb">min</span><span class="p">(</span><span class="n">ex</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ext</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                  <span class="nb">max</span><span class="p">(</span><span class="n">ex</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">ext</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span>
                  <span class="nb">max</span><span class="p">(</span><span class="n">ex</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">ext</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
            <span class="k">return</span> <span class="n">ex</span>

        <span class="n">vlist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">view_list</span>
        <span class="n">ex</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0e10</span><span class="p">,</span> <span class="mf">1.0e10</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0e10</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0e10</span><span class="p">)</span>
        <span class="n">base_view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">classview</span><span class="p">(</span><span class="s1">&#39;*base&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">view_name</span> <span class="ow">in</span> <span class="n">vlist</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">view_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">!=</span> <span class="n">base_view</span><span class="p">:</span>
                <span class="k">with</span> <span class="n">gxv</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">view_name</span><span class="p">)</span> <span class="k">as</span> <span class="n">v</span><span class="p">:</span>
                    <span class="n">ex</span> <span class="o">=</span> <span class="n">extents</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="n">v</span><span class="o">.</span><span class="n">extent_map_cm</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">extent_clip</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">ex</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mf">1.0e10</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">MapException</span><span class="p">(</span><span class="n">_t</span><span class="p">(</span><span class="s1">&#39;Map &quot;</span><span class="si">{}</span><span class="s1">&quot; has no data views.&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">ex</span></div>


<div class="viewcode-block" id="Map.classview"><a class="viewcode-back" href="../../../geosoft.gxpy.map.html#geosoft.gxpy.map.Map.classview">[docs]</a>    <span class="k">def</span> <span class="nf">classview</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given a view name that may be a class name (&#39;*&#39; prefix), return the view name for that class.  if not</span>
<span class="sd">        class decorated, the name passed is returned.</span>

<span class="sd">        :param name:    view name, `&#39;*data&#39;` will return the name associated with the `&#39;data&#39;` class, while</span>
<span class="sd">                        `&#39;my_view&#39;` will return `&#39;my_view&#39;`.</span>

<span class="sd">        :returns:       the name, or if a class name, the view name associated with that class.</span>

<span class="sd">        .. versionadded: 9.2</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;*&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">name</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_class_name</span><span class="p">(</span><span class="n">name</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span></div>

    <span class="k">def</span> <span class="nf">_views</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">view_type</span><span class="o">=</span><span class="n">LIST_ALL</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return dictionary of view names.</span>

<span class="sd">        :param view_type: `gxmap.LIST_ALL`, `gxapi.LIST_2D` or `gxapi.LIST_3D`</span>
<span class="sd">        :returns: list of views</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">glst</span> <span class="o">=</span> <span class="n">gxapi</span><span class="o">.</span><span class="n">GXLST</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">VIEW_NAME_SIZE</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gxmap</span><span class="o">.</span><span class="n">view_list_ex</span><span class="p">(</span><span class="n">glst</span><span class="p">,</span> <span class="n">view_type</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">gxu</span><span class="o">.</span><span class="n">dict_from_lst</span><span class="p">(</span><span class="n">glst</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">view_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;list of views in the map, both 2D and 3D&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_views</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">view_list_2D</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;list of 2D views in the map&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_views</span><span class="p">(</span><span class="n">LIST_2D</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">view_list_3D</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;list of 3D views in the map&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_views</span><span class="p">(</span><span class="n">LIST_3D</span><span class="p">)</span>

<div class="viewcode-block" id="Map.aggregate_list"><a class="viewcode-back" href="../../../geosoft.gxpy.map.html#geosoft.gxpy.map.Map.aggregate_list">[docs]</a>    <span class="k">def</span> <span class="nf">aggregate_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        List of all aggregates in the map as &#39;view_name/group_name&#39; (mode=0) or</span>
<span class="sd">        &#39;view_name/group_name/layer&#39; (mode=1).</span>

<span class="sd">        ..versionadded:: 9.2</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">glst</span> <span class="o">=</span> <span class="n">gxapi</span><span class="o">.</span><span class="n">GXLST</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">gxg</span><span class="o">.</span><span class="n">GROUP_NAME_SIZE</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gxmap</span><span class="o">.</span><span class="n">agg_list_ex</span><span class="p">(</span><span class="n">glst</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">gxu</span><span class="o">.</span><span class="n">dict_from_lst</span><span class="p">(</span><span class="n">glst</span><span class="p">))</span></div>

<div class="viewcode-block" id="Map.has_view"><a class="viewcode-back" href="../../../geosoft.gxpy.map.html#geosoft.gxpy.map.Map.has_view">[docs]</a>    <span class="k">def</span> <span class="nf">has_view</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">view</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns True if the map contains this view.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">gxmap</span><span class="o">.</span><span class="n">exist_view</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">classview</span><span class="p">(</span><span class="n">view</span><span class="p">))</span></div>

<div class="viewcode-block" id="Map.copy_view"><a class="viewcode-back" href="../../../geosoft.gxpy.map.html#geosoft.gxpy.map.Map.copy_view">[docs]</a>    <span class="k">def</span> <span class="nf">copy_view</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">old</span><span class="p">,</span> <span class="n">new</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">copy_all</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Copy an existing view into a new view.</span>

<span class="sd">        :param old:         name of the existing view</span>
<span class="sd">        :param new:         name for the new view</span>
<span class="sd">        :param overwrite:   True to overwrite an existing view if it exists</span>
<span class="sd">        :param copy_all:    True to copy content of old to new, false to create an empty new view</span>
<span class="sd">                            with the same coordinate system, scale and clipping as the old view.</span>

<span class="sd">        .. versionadded:: 9.2</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">old</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">classview</span><span class="p">(</span><span class="n">old</span><span class="p">)</span>
        <span class="n">new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">classview</span><span class="p">(</span><span class="n">new</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_view</span><span class="p">(</span><span class="n">old</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">MapException</span><span class="p">(</span><span class="n">_t</span><span class="p">(</span><span class="s1">&#39;&quot;</span><span class="si">{}</span><span class="s1">&quot; view does not exist.&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">old</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_view</span><span class="p">(</span><span class="n">new</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">overwrite</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">gxmap</span><span class="o">.</span><span class="n">delete_view</span><span class="p">(</span><span class="n">new</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">MapException</span><span class="p">(</span><span class="n">_t</span><span class="p">(</span><span class="s1">&#39;Cannot overwtite existing view &quot;</span><span class="si">{}</span><span class="s1">&quot;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">new</span><span class="p">))</span>

        <span class="n">s</span> <span class="o">=</span> <span class="n">gxapi</span><span class="o">.</span><span class="n">str_ref</span><span class="p">()</span>
        <span class="n">s</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">new</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">gxmap</span><span class="o">.</span><span class="n">duplicate_view</span><span class="p">(</span><span class="n">old</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">copy_all</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">value</span> <span class="o">!=</span> <span class="n">new</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gxmap</span><span class="o">.</span><span class="n">delete_view</span><span class="p">(</span><span class="n">new</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">MapException</span><span class="p">(</span><span class="n">_t</span><span class="p">(</span><span class="s1">&#39;Invalid view name &quot;</span><span class="si">{}</span><span class="s1">&quot;, suggest &quot;</span><span class="si">{}</span><span class="s1">&quot;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">new</span><span class="p">,</span> <span class="n">s</span><span class="o">.</span><span class="n">value</span><span class="p">))</span></div>

<div class="viewcode-block" id="Map.delete_view"><a class="viewcode-back" href="../../../geosoft.gxpy.map.html#geosoft.gxpy.map.Map.delete_view">[docs]</a>    <span class="k">def</span> <span class="nf">delete_view</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Delete a view from a map. You cannot delete the last view in a map.</span>

<span class="sd">        :param name: name of the view to delete</span>

<span class="sd">        .. versionadded:: 9.2</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gxmap</span><span class="o">.</span><span class="n">delete_view</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">classview</span><span class="p">(</span><span class="n">name</span><span class="p">))</span></div>

<div class="viewcode-block" id="Map.mdf"><a class="viewcode-back" href="../../../geosoft.gxpy.map.html#geosoft.gxpy.map.Map.mdf">[docs]</a>    <span class="k">def</span> <span class="nf">mdf</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the Map Description File specification for maps that contain</span>
<span class="sd">        both a base view and a data view:</span>

<span class="sd">        ((x_size, y_size, margin_bottom, margin_right, margin_top, margin_left),</span>
<span class="sd">        (scale, units_per_metre, x_origin, y_origin))</span>

<span class="sd">        .. versionadded: 9.2</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">views</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">view_list_2D</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">has_view</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_data_view</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_view</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_base_view</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="n">MapException</span><span class="p">(</span><span class="n">_t</span><span class="p">(</span><span class="s1">&#39;The map must have both a base view and a data view.&#39;</span><span class="p">))</span>

        <span class="k">with</span> <span class="n">gxv</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_base_view</span><span class="p">,</span> <span class="n">read_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">base</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">gxv</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_data_view</span><span class="p">,</span> <span class="n">read_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">data</span><span class="p">:</span>
                <span class="n">mdf</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">mdf</span><span class="p">(</span><span class="n">base_view</span><span class="o">=</span><span class="n">base</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">mdf</span></div>

<div class="viewcode-block" id="Map.get_class_name"><a class="viewcode-back" href="../../../geosoft.gxpy.map.html#geosoft.gxpy.map.Map.get_class_name">[docs]</a>    <span class="k">def</span> <span class="nf">get_class_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">view_class</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the view name associated with a class.</span>

<span class="sd">        :param view_class:  desired class</span>

<span class="sd">        Common view class names are::</span>

<span class="sd">            &#39;base&#39;      the base map/figure view, uses map cm</span>
<span class="sd">            &#39;data&#39;      the default data view for drawing spatial data.</span>
<span class="sd">            &#39;section&#39;   the default section view for things drawn in section</span>

<span class="sd">        Other class names may be defined, though they are not used by Geosoft.</span>

<span class="sd">        :returns: view name associated with the class, &#39;&#39; if not defined.</span>

<span class="sd">        .. versionadded:: 9.2</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sr</span> <span class="o">=</span> <span class="n">gxapi</span><span class="o">.</span><span class="n">str_ref</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gxmap</span><span class="o">.</span><span class="n">get_class_name</span><span class="p">(</span><span class="n">view_class</span><span class="p">,</span> <span class="n">sr</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">sr</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span></div>

<div class="viewcode-block" id="Map.set_class_name"><a class="viewcode-back" href="../../../geosoft.gxpy.map.html#geosoft.gxpy.map.Map.set_class_name">[docs]</a>    <span class="k">def</span> <span class="nf">set_class_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">view_class</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the view name associated with a class.</span>

<span class="sd">        :param view_class:  class name</span>
<span class="sd">        :param name:   name of the view associated with this class.</span>

<span class="sd">        Common view class names are::</span>

<span class="sd">            &#39;base&#39;      the base map/figure view, uses map cm</span>
<span class="sd">            &#39;data&#39;      the default data view for drawing spatial data.</span>
<span class="sd">            &#39;section&#39;   the default section view for things drawn in section</span>

<span class="sd">        .. versionadded:: 9.2</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gxmap</span><span class="o">.</span><span class="n">set_class_name</span><span class="p">(</span><span class="n">view_class</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span></div>

<div class="viewcode-block" id="Map.create_linked_3d_view"><a class="viewcode-back" href="../../../geosoft.gxpy.map.html#geosoft.gxpy.map.Map.create_linked_3d_view">[docs]</a>    <span class="k">def</span> <span class="nf">create_linked_3d_view</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">view</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;3D&#39;</span><span class="p">,</span> <span class="n">area_on_map</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">300</span><span class="p">)):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a linked 3D view inside a 2D map to a `geosoft.gxpy.view.View_3d` in a 3DV</span>

<span class="sd">        :param view:        `geosoft.gxpy.view.View_3d` instance</span>
<span class="sd">        :param name:        name of the linked view to create</span>
<span class="sd">        :param area_on_map: min_x, min_y, max_x, max_y) placement of view on map in mm</span>

<span class="sd">        .. versionadded:: 9.2</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">gxmap</span><span class="o">.</span><span class="n">create_linked_3d_view</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">gxview</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span>
                                         <span class="n">area_on_map</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">area_on_map</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                         <span class="n">area_on_map</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">area_on_map</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span></div>

<div class="viewcode-block" id="Map.image_file"><a class="viewcode-back" href="../../../geosoft.gxpy.map.html#geosoft.gxpy.map.Map.image_file">[docs]</a>    <span class="k">def</span> <span class="nf">image_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">imagefile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">RASTER_FORMAT_PNG</span><span class="p">,</span> <span class="n">pix_width</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">pix_height</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">pix_32_bit</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save a map to an image file</span>

<span class="sd">        :param mapfile:     map or geosoft_3dv file name</span>
<span class="sd">        :param imagefile:   name of the output raster file, default will be a temporary png file.</span>
<span class="sd">        :param type:        one of the RASTER_FORMAT types, default`RASTER_FORMAT_PNG`</span>
<span class="sd">        :param pix_width:   image pixel width, if 0 use pix_height only</span>
<span class="sd">        :param pix_height:  image pixel height, if 0 use pix_width only</span>
<span class="sd">        :param pix_32_bit:  make 32-bit image (with 8-bit alpha background)</span>
<span class="sd">        :returns:           image file name</span>

<span class="sd">        .. versionadded:: 9.3</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">imagefile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">imagefile</span> <span class="o">=</span> <span class="n">gx</span><span class="o">.</span><span class="n">gx</span><span class="p">()</span><span class="o">.</span><span class="n">temp_file</span><span class="p">(</span><span class="s1">&#39;.png&#39;</span><span class="p">)</span>
            <span class="nb">type</span> <span class="o">=</span> <span class="n">RASTER_FORMAT_PNG</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">gxmap</span><span class="o">.</span><span class="n">export_all_raster</span><span class="p">(</span><span class="n">imagefile</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                                     <span class="n">pix_width</span><span class="p">,</span> <span class="n">pix_height</span><span class="p">,</span> <span class="n">gxapi</span><span class="o">.</span><span class="n">rDUMMY</span><span class="p">,</span>
                                     <span class="n">gxapi</span><span class="o">.</span><span class="n">MAP_EXPORT_BITS_32</span> <span class="k">if</span> <span class="n">pix_32_bit</span> <span class="k">else</span> <span class="n">gxapi</span><span class="o">.</span><span class="n">MAP_EXPORT_BITS_24</span><span class="p">,</span>
                                     <span class="n">gxapi</span><span class="o">.</span><span class="n">MAP_EXPORT_METHOD_NONE</span><span class="p">,</span>
                                     <span class="nb">type</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">imagefile</span></div>

<div class="viewcode-block" id="Map.crc_image"><a class="viewcode-back" href="../../../geosoft.gxpy.map.html#geosoft.gxpy.map.Map.crc_image">[docs]</a>    <span class="k">def</span> <span class="nf">crc_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pix_width</span><span class="o">=</span><span class="mi">1000</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the CRC of a map based on the output bitmap image.</span>

<span class="sd">        :param pix_width:   image pixel width - use a higher resolution to test more detail</span>
<span class="sd">        :returns:           CRC as an int</span>

<span class="sd">        .. versionadded:: 9.3</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">crc_image</span> <span class="o">=</span> <span class="n">gx</span><span class="o">.</span><span class="n">gx</span><span class="p">()</span><span class="o">.</span><span class="n">temp_file</span><span class="p">(</span><span class="s1">&#39;.bmp&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image_file</span><span class="p">(</span><span class="n">crc_image</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">RASTER_FORMAT_BMP</span><span class="p">,</span> <span class="n">pix_width</span><span class="o">=</span><span class="n">pix_width</span><span class="p">)</span>
        <span class="n">crc</span> <span class="o">=</span> <span class="n">gxu</span><span class="o">.</span><span class="n">crc32_file</span><span class="p">(</span><span class="n">crc_image</span><span class="p">)</span>
        <span class="n">gxgrd</span><span class="o">.</span><span class="n">delete_files</span><span class="p">(</span><span class="n">crc_image</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">crc</span></div>

<div class="viewcode-block" id="Map.figure"><a class="viewcode-back" href="../../../geosoft.gxpy.map.html#geosoft.gxpy.map.Map.figure">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">figure</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">data_area</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">features</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;SCALE&#39;</span><span class="p">,</span> <span class="s1">&#39;NEATLINE&#39;</span><span class="p">,</span> <span class="s1">&#39;ANNOT_XY&#39;</span><span class="p">),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a figure-style map.</span>

<span class="sd">        :param data_area:       the area extend for the data view as (xmin, ymin, xmax, ymax)</span>
<span class="sd">        :param file_name:       map file name, default creates a temporary map</span>
<span class="sd">        :param overwrite:       `True` to overwrite file should it exist</span>
<span class="sd">        :param title:           figure title</span>
<span class="sd">        :param features:        list of features to place on the map, default is (&#39;SCALE&#39;, &#39;NEATLINE&#39;, &#39;ANNOT_XY&#39;)</span>

<span class="sd">                                    =========== =========================================</span>
<span class="sd">                                    &#39;ALL&#39;       all features</span>
<span class="sd">                                    &#39;SCALE&#39;     show a scale bar</span>
<span class="sd">                                    &#39;NEATLINE&#39;  draw a neat-line around the image</span>
<span class="sd">                                    &#39;ANNOT_XY&#39;  annotate map coordinates</span>
<span class="sd">                                    &#39;ANNOT_LL&#39;  annotate map Latitude, Longitude</span>
<span class="sd">                                    =========== =========================================</span>

<span class="sd">        :return:                `Map` instance with &#39;base&#39; and &#39;data&#39; views.</span>

<span class="sd">        .. seealso:: `Map.new` arguments to modify map layout requirements</span>

<span class="sd">        .. versionadded:: 9.3</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># uppercase features, use a dict so we pop things we use and report error</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">features</span> <span class="o">=</span> <span class="p">(</span><span class="n">features</span><span class="p">,)</span>
        <span class="n">feature_list</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">features</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">features</span><span class="p">:</span>
                <span class="n">feature_list</span><span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">upper</span><span class="p">()]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="s1">&#39;ALL&#39;</span> <span class="ow">in</span> <span class="n">feature_list</span><span class="p">:</span>
                <span class="n">feature_list</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;SCALE&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                                <span class="s1">&#39;NEATLINE&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                                <span class="s1">&#39;ANNOT_LL&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                                <span class="s1">&#39;ANNOT_XY&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;margins&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>

            <span class="n">bottom_margin</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">title</span><span class="p">:</span>
                <span class="n">bottom_margin</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="s1">&#39;SCALE&#39;</span> <span class="ow">in</span> <span class="n">feature_list</span><span class="p">:</span>
                <span class="n">bottom_margin</span> <span class="o">+=</span> <span class="mf">1.2</span>

            <span class="n">right_margin</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="s1">&#39;LEGEND&#39;</span> <span class="ow">in</span> <span class="n">feature_list</span><span class="p">:</span>
                <span class="n">right_margin</span> <span class="o">+=</span> <span class="mf">3.5</span>

            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;margins&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">right_margin</span><span class="p">,</span> <span class="n">bottom_margin</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;media&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;media&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;A4&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;inside_margin&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;inside_margin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.2</span>

        <span class="c1"># data area adjustment</span>
        <span class="n">data_area</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">data_area</span><span class="p">)</span>
        <span class="n">dx</span> <span class="o">=</span> <span class="n">data_area</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">data_area</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">dy</span> <span class="o">=</span> <span class="n">data_area</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">data_area</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">dx</span> <span class="o">&lt;</span> <span class="n">dy</span> <span class="o">*</span> <span class="mf">0.67</span><span class="p">:</span>
            <span class="n">d</span> <span class="o">=</span> <span class="p">(</span><span class="n">dy</span> <span class="o">*</span> <span class="mf">0.67</span> <span class="o">-</span> <span class="n">dx</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.5</span>
            <span class="n">data_area</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-=</span> <span class="n">d</span>
            <span class="n">data_area</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+=</span> <span class="n">d</span>
        <span class="k">elif</span> <span class="n">dy</span> <span class="o">&lt;</span> <span class="n">dx</span> <span class="o">*</span> <span class="mf">0.67</span><span class="p">:</span>
            <span class="n">d</span> <span class="o">=</span> <span class="p">(</span><span class="n">dx</span> <span class="o">*</span> <span class="mf">0.67</span> <span class="o">-</span> <span class="n">dy</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.5</span>
            <span class="n">data_area</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-=</span> <span class="n">d</span>
            <span class="n">data_area</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+=</span> <span class="n">d</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;data_area&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_area</span> <span class="c1"># over-ride</span>

        <span class="n">gmap</span> <span class="o">=</span> <span class="n">Map</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="n">overwrite</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;ANNOT_XY&#39;</span> <span class="ow">in</span> <span class="n">feature_list</span><span class="p">:</span>
            <span class="n">gmap</span><span class="o">.</span><span class="n">annotate_data_xy</span><span class="p">(</span><span class="n">grid</span><span class="o">=</span><span class="n">GRID_CROSSES</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;ANNOT_LL&#39;</span> <span class="ow">in</span> <span class="n">feature_list</span><span class="p">:</span>
            <span class="n">gmap</span><span class="o">.</span><span class="n">annotate_data_ll</span><span class="p">(</span><span class="n">grid</span><span class="o">=</span><span class="n">GRID_LINES</span><span class="p">,</span>
                                  <span class="n">grid_pen</span><span class="o">=</span><span class="s1">&#39;b255r100g100t150&#39;</span><span class="p">,</span>
                                  <span class="n">text_def</span><span class="o">=</span><span class="n">gxg</span><span class="o">.</span><span class="n">Text_def</span><span class="p">(</span><span class="n">height</span><span class="o">=</span><span class="mf">0.18</span><span class="p">,</span> <span class="n">italics</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>

        <span class="k">if</span> <span class="s1">&#39;SCALE&#39;</span> <span class="ow">in</span> <span class="n">feature_list</span><span class="p">:</span>
            <span class="n">gmap</span><span class="o">.</span><span class="n">scale_bar</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">),</span> <span class="n">sections</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                           <span class="n">text_def</span><span class="o">=</span><span class="n">gxg</span><span class="o">.</span><span class="n">Text_def</span><span class="p">(</span><span class="n">height</span><span class="o">=</span><span class="mf">0.15</span><span class="p">))</span>
            <span class="n">bottom</span> <span class="o">=</span> <span class="mi">15</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">bottom</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="s1">&#39;NEATLINE&#39;</span> <span class="ow">in</span> <span class="n">feature_list</span><span class="p">:</span>
            <span class="n">gmap</span><span class="o">.</span><span class="n">surround</span><span class="p">()</span>

        <span class="k">with</span> <span class="n">gxv</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">gmap</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">v</span><span class="p">:</span>

            <span class="c1"># map title</span>
            <span class="k">if</span> <span class="n">title</span><span class="p">:</span>
                <span class="k">with</span> <span class="n">gxv</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">gmap</span><span class="p">,</span> <span class="s2">&quot;base&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">v</span><span class="p">:</span>
                    <span class="k">with</span> <span class="n">gxg</span><span class="o">.</span><span class="n">Draw</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="s1">&#39;annotations&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">g</span><span class="p">:</span>
                        <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">extent_clip</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">v</span><span class="o">.</span><span class="n">extent_clip</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span>
                        <span class="n">g</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">title</span><span class="p">,</span>
                               <span class="n">reference</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                               <span class="n">location</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">bottom</span> <span class="o">+</span> <span class="mi">5</span><span class="p">),</span>
                               <span class="n">text_def</span><span class="o">=</span><span class="n">gxg</span><span class="o">.</span><span class="n">Text_def</span><span class="p">(</span><span class="n">height</span><span class="o">=</span><span class="mf">3.5</span><span class="p">,</span>
                                                         <span class="n">weight</span><span class="o">=</span><span class="n">gxg</span><span class="o">.</span><span class="n">FONT_WEIGHT_BOLD</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">gmap</span></div>

<div class="viewcode-block" id="Map.surround"><a class="viewcode-back" href="../../../geosoft.gxpy.map.html#geosoft.gxpy.map.Map.surround">[docs]</a>    <span class="k">def</span> <span class="nf">surround</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outer_pen</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">inner_pen</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">gap</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Draw a map surround.  This will draw a single or a double neat-line around the base view of the</span>
<span class="sd">        map.</span>

<span class="sd">        :param outer_pen:   outer-line pen attributes (cm)</span>
<span class="sd">        :param inner_pen:   inner-line pen attributes (cm)</span>
<span class="sd">        :param gap:         gap between the outer and inner line in cm.  If 0, only the outer line is drawn.</span>

<span class="sd">        .. versionadded:: 9.2</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">outer_pen</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">outer_pen</span> <span class="o">=</span> <span class="n">gxg</span><span class="o">.</span><span class="n">Pen</span><span class="p">(</span><span class="n">line_thick</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">outer_pen</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">outer_pen</span> <span class="o">=</span> <span class="n">gxg</span><span class="o">.</span><span class="n">Pen</span><span class="o">.</span><span class="n">from_mapplot_string</span><span class="p">(</span><span class="n">outer_pen</span><span class="p">)</span>
            <span class="n">outer_pen</span><span class="o">.</span><span class="n">line_thick</span> <span class="o">=</span> <span class="n">outer_pen</span><span class="o">.</span><span class="n">line_thick</span> <span class="o">/</span> <span class="mf">10.0</span> <span class="c1"># to cm</span>
        <span class="k">if</span> <span class="n">inner_pen</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">inner_pen</span> <span class="o">=</span> <span class="n">gxg</span><span class="o">.</span><span class="n">Pen</span><span class="p">(</span><span class="n">line_thick</span><span class="o">=</span><span class="n">outer_pen</span><span class="o">.</span><span class="n">line_thick</span> <span class="o">*</span> <span class="mf">0.5</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">inner_pen</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">inner_pen</span> <span class="o">=</span> <span class="n">gxg</span><span class="o">.</span><span class="n">Pen</span><span class="o">.</span><span class="n">from_mapplot_string</span><span class="p">(</span><span class="n">inner_pen</span><span class="p">)</span>
            <span class="n">inner_pen</span><span class="o">.</span><span class="n">line_thick</span> <span class="o">=</span> <span class="n">inner_pen</span><span class="o">.</span><span class="n">line_thick</span> <span class="o">/</span> <span class="mf">10.0</span> <span class="c1"># to cm</span>

        <span class="k">with</span> <span class="n">_Mapplot</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="k">as</span> <span class="n">mpl</span><span class="p">:</span>
            <span class="n">mpl</span><span class="o">.</span><span class="n">start_group</span><span class="p">(</span><span class="s1">&#39;surround&#39;</span><span class="p">,</span> <span class="n">view</span><span class="o">=</span><span class="n">VIEW_BASE</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">GROUP_APPEND</span><span class="p">)</span>
            <span class="n">mpl</span><span class="o">.</span><span class="n">define_named_attribute</span><span class="p">(</span><span class="s1">&#39;outer&#39;</span><span class="p">,</span> <span class="n">pen</span><span class="o">=</span><span class="n">outer_pen</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">gap</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">inner</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                <span class="n">gap</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">inner_pen</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">inner_pen</span> <span class="o">=</span> <span class="n">gxg</span><span class="o">.</span><span class="n">Pen</span><span class="p">(</span><span class="n">line_thick</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span> <span class="c1"># cm</span>
                <span class="n">inner</span> <span class="o">=</span> <span class="s1">&#39;inner&#39;</span>
                <span class="n">mpl</span><span class="o">.</span><span class="n">define_named_attribute</span><span class="p">(</span><span class="n">inner</span><span class="p">,</span> <span class="n">pen</span><span class="o">=</span><span class="n">inner_pen</span><span class="p">)</span>

            <span class="n">mpl</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;SURR &quot;</span><span class="si">{}</span><span class="s1">&quot;,</span><span class="si">{}</span><span class="s1">,&quot;</span><span class="si">{}</span><span class="s1">&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;outer&#39;</span><span class="p">,</span> <span class="n">gap</span><span class="p">,</span> <span class="n">inner</span><span class="p">))</span></div>

<div class="viewcode-block" id="Map.north_arrow"><a class="viewcode-back" href="../../../geosoft.gxpy.map.html#geosoft.gxpy.map.Map.north_arrow">[docs]</a>    <span class="k">def</span> <span class="nf">north_arrow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                    <span class="n">location</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">2.</span><span class="p">,</span> <span class="mf">2.7</span><span class="p">),</span>
                    <span class="n">direction</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">length</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                    <span class="n">inclination</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">declination</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">text_def</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">pen</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a North arrow to the base view of the map.</span>

<span class="sd">        :param location:    (reference, x_offset, y_offset) reference is a reference point relative to the</span>
<span class="sd">                            base map extents (1 through 9) nd the offsets are the offset from that reference</span>
<span class="sd">                            point in map cm.</span>
<span class="sd">        :param direction:   North direction in degrees azimuth (clockwise from map Y axis).  The efault is</span>
<span class="sd">                            calculated direction of North at the center of the data view.</span>
<span class="sd">        :param length:      arrow length in cm on the map.</span>
<span class="sd">        :param inclination: magnetic inclination, not shown if not specified</span>
<span class="sd">        :param declination: magnetic declination, not shown if not specified</span>
<span class="sd">        :param text_def:    :class:`geosoft.gxpy.group.Text_def` instance, or `None` for the default.</span>
<span class="sd">        :param pen:         :class:`geosoft.gxpy.group.Pen` instance, or `None` for the default</span>

<span class="sd">        .. versionadded:: 9.2</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">direction</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">gxv</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;*data&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">v</span><span class="p">:</span>
                <span class="n">direction</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">gxview</span><span class="o">.</span><span class="n">north</span><span class="p">(),</span> <span class="mi">1</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">direction</span> <span class="o">==</span> <span class="n">gxapi</span><span class="o">.</span><span class="n">rDUMMY</span><span class="p">:</span>
                    <span class="n">direction</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

        <span class="k">if</span> <span class="n">inclination</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">inclination</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

        <span class="k">if</span> <span class="n">declination</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">declination</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

        <span class="k">if</span> <span class="n">pen</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pen</span> <span class="o">=</span> <span class="n">gxg</span><span class="o">.</span><span class="n">Pen</span><span class="p">(</span><span class="n">line_thick</span><span class="o">=</span><span class="mf">0.015</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">text_def</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">text_def</span> <span class="o">=</span> <span class="n">gxg</span><span class="o">.</span><span class="n">Text_def</span><span class="p">(</span><span class="n">height</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">italics</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="n">gxg</span><span class="o">.</span><span class="n">FONT_WEIGHT_LIGHT</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">_Mapplot</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="k">as</span> <span class="n">mpl</span><span class="p">:</span>
            <span class="n">mpl</span><span class="o">.</span><span class="n">start_group</span><span class="p">(</span><span class="s1">&#39;north_arrow&#39;</span><span class="p">,</span> <span class="n">view</span><span class="o">=</span><span class="n">VIEW_BASE</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">GROUP_APPEND</span><span class="p">)</span>
            <span class="n">mpl</span><span class="o">.</span><span class="n">define_named_attribute</span><span class="p">(</span><span class="s1">&#39;arrow&#39;</span><span class="p">,</span> <span class="n">pen</span><span class="o">=</span><span class="n">pen</span><span class="p">)</span>
            <span class="n">mpl</span><span class="o">.</span><span class="n">define_named_attribute</span><span class="p">(</span><span class="s1">&#39;annot&#39;</span><span class="p">,</span> <span class="n">text_def</span><span class="o">=</span><span class="n">text_def</span><span class="p">)</span>
            <span class="n">mpl</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s2">&quot;NARR </span><span class="si">{}</span><span class="s2">,</span><span class="si">{}</span><span class="s2">,</span><span class="si">{}</span><span class="s2">,</span><span class="si">{}</span><span class="s2">,</span><span class="si">{}</span><span class="s2">,</span><span class="si">{}</span><span class="s2">,</span><span class="si">{}</span><span class="s2">,</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">location</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">location</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">location</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                                                              <span class="n">direction</span><span class="p">,</span>
                                                              <span class="n">length</span><span class="p">,</span>
                                                              <span class="s1">&#39;arrow&#39;</span><span class="p">,</span>
                                                              <span class="n">inclination</span><span class="p">,</span>
                                                              <span class="n">declination</span><span class="p">))</span>
            <span class="n">mpl</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;     annot&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Map.scale_bar"><a class="viewcode-back" href="../../../geosoft.gxpy.map.html#geosoft.gxpy.map.Map.scale_bar">[docs]</a>    <span class="k">def</span> <span class="nf">scale_bar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                  <span class="n">location</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
                  <span class="n">length</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                  <span class="n">sections</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">post_scale</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                  <span class="n">text_def</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">pen</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Draw a scale bar.</span>

<span class="sd">        :param location:    (ref_point, x_off, y_off) bar location reference point an offset from that point</span>
<span class="sd">        :param length:      maximum scale bar length in map cm, default is 5 cm. 0 will suppress drawing of the bar.</span>
<span class="sd">        :param sections:    number of major sections in the bar, default is determined automatically.</span>
<span class="sd">        :param post_scale:  True to post the actual scale as a string, e.g. &#39;1:50,000&#39;.  Note that a posted</span>
<span class="sd">                            scale is only relevant for printed maps.  The default does not post the scale.</span>
<span class="sd">        :param text_def:    :class:`geosoft.gxpy.view.Text_def` instance.</span>
<span class="sd">        :param pen:         :class:`geosoft.gxpy.view.Pen` instance.</span>


<span class="sd">        .. versionadded:: 9.2</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">sections</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">sections</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

        <span class="k">if</span> <span class="n">post_scale</span><span class="p">:</span>
            <span class="n">option</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">option</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">text_def</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">text_def</span> <span class="o">=</span> <span class="n">gxg</span><span class="o">.</span><span class="n">Text_def</span><span class="p">(</span><span class="n">height</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="n">gxg</span><span class="o">.</span><span class="n">FONT_WEIGHT_LIGHT</span><span class="p">,</span> <span class="n">italics</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">pen</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pen</span> <span class="o">=</span> <span class="n">gxg</span><span class="o">.</span><span class="n">Pen</span><span class="p">(</span><span class="n">line_thick</span><span class="o">=</span><span class="mf">0.001</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">_Mapplot</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="k">as</span> <span class="n">mpl</span><span class="p">:</span>
            <span class="n">mpl</span><span class="o">.</span><span class="n">start_group</span><span class="p">(</span><span class="s1">&#39;scale_bar&#39;</span><span class="p">,</span> <span class="n">view</span><span class="o">=</span><span class="n">VIEW_BASE</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">GROUP_APPEND</span><span class="p">)</span>
            <span class="n">mpl</span><span class="o">.</span><span class="n">define_named_attribute</span><span class="p">(</span><span class="s1">&#39;scale_text&#39;</span><span class="p">,</span> <span class="n">text_def</span><span class="o">=</span><span class="n">text_def</span><span class="p">)</span>
            <span class="n">mpl</span><span class="o">.</span><span class="n">define_named_attribute</span><span class="p">(</span><span class="s1">&#39;scale_bar&#39;</span><span class="p">,</span> <span class="n">pen</span><span class="o">=</span><span class="n">pen</span><span class="p">)</span>
            <span class="n">mpl</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s2">&quot;SCAL </span><span class="si">{}</span><span class="s2">,</span><span class="si">{}</span><span class="s2">,</span><span class="si">{}</span><span class="s2">,,,</span><span class="si">{}</span><span class="s2">,</span><span class="si">{}</span><span class="s2">,,</span><span class="si">{}</span><span class="s2">,&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">location</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">location</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">location</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                                                            <span class="n">length</span><span class="p">,</span> <span class="n">sections</span><span class="p">,</span> <span class="n">option</span><span class="p">))</span>
            <span class="n">mpl</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;     scale_text&#39;</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_annotation_offset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">text_height</span><span class="p">):</span>
        <span class="n">inside</span> <span class="o">=</span> <span class="n">text_height</span> <span class="o">*</span> <span class="mf">0.25</span>
        <span class="k">if</span> <span class="n">offset</span><span class="p">:</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="n">offset</span> <span class="o">+</span> <span class="n">inside</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_annotation_outer_edge</span> <span class="o">+</span> <span class="n">inside</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_annotation_outer_edge</span> <span class="o">+=</span> <span class="n">offset</span> <span class="o">+</span> <span class="n">text_height</span> <span class="o">+</span> <span class="n">inside</span> <span class="o">*</span> <span class="mf">0.5</span>
        <span class="k">return</span> <span class="n">offset</span>

<div class="viewcode-block" id="Map.annotate_data_xy"><a class="viewcode-back" href="../../../geosoft.gxpy.map.html#geosoft.gxpy.map.Map.annotate_data_xy">[docs]</a>    <span class="k">def</span> <span class="nf">annotate_data_xy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                         <span class="n">view_name</span><span class="o">=</span><span class="s1">&#39;*data&#39;</span><span class="p">,</span>
                         <span class="n">tick</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                         <span class="n">x_sep</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">x_dec</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                         <span class="n">y_sep</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">y_dec</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                         <span class="n">compass</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                         <span class="n">top</span><span class="o">=</span><span class="n">TOP_OUT</span><span class="p">,</span>
                         <span class="n">text_def</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                         <span class="n">edge_pen</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                         <span class="n">grid</span><span class="o">=</span><span class="n">GRID_NONE</span><span class="p">,</span>
                         <span class="n">grid_pen</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Annotate a data view axis</span>

<span class="sd">        :param view_name:    name of the data view to annotate</span>
<span class="sd">        :param tick:        inner tick size in cm</span>
<span class="sd">        :param offset:      posting offset from the edge in map cm. The posting edge is adjusted to be outside</span>
<span class="sd">                            character height for a subsequent call to an edge annotation.  This allows one to</span>
<span class="sd">                            annotate both geographic and projected coordinates.</span>
<span class="sd">        :param top:         TOP_IN or TOP_OUT (default) for vertical annotations</span>
<span class="sd">        :param x_sep:       separation between X annotations, default is calculated from data</span>
<span class="sd">        :param x_dec:       X axis label decimals, default is 0</span>
<span class="sd">        :param y_sep:       separation between Y annotations, default is calculated from data</span>
<span class="sd">        :param y_dec:       Y axis label decimals, default is 0</span>
<span class="sd">        :param compass:     True to append compass direction to annotations, default True if known coordinate system.</span>
<span class="sd">        :param grid:</span>

<span class="sd">                            ::</span>

<span class="sd">                                GRID_NONE       no grid</span>
<span class="sd">                                GRID_DOTTED     dotted lines</span>
<span class="sd">                                GRID_CROSSES    crosses at intersections</span>
<span class="sd">                                GRID_LINES      lines</span>

<span class="sd">        :param text_def:    `geosoft.gxpy.group.Text_def`</span>
<span class="sd">        :param edge_pen:    `geosoft.gxpy.group.Pen`</span>
<span class="sd">        :param grid_pen:    `geosoft.gxpy.group.Pen`</span>

<span class="sd">        .. versionadded:: 9.2</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">text_def</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">text_def</span> <span class="o">=</span> <span class="n">gxg</span><span class="o">.</span><span class="n">Text_def</span><span class="p">(</span><span class="n">height</span><span class="o">=</span><span class="mf">0.18</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">edge_pen</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">edge_pen</span> <span class="o">=</span> <span class="n">gxg</span><span class="o">.</span><span class="n">Pen</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">grid_pen</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">grid_pen</span> <span class="o">=</span> <span class="n">edge_pen</span>

        <span class="n">current_view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_data_view</span>
        <span class="n">view_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">classview</span><span class="p">(</span><span class="n">view_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_data_view</span> <span class="o">=</span> <span class="n">view_name</span>

        <span class="k">try</span><span class="p">:</span>

            <span class="n">offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_annotation_offset</span><span class="p">(</span><span class="n">offset</span><span class="p">,</span> <span class="n">text_def</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>

            <span class="k">with</span> <span class="n">gxv</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">view_name</span><span class="p">)</span> <span class="k">as</span> <span class="n">v</span><span class="p">:</span>
                <span class="k">with</span> <span class="n">gxg</span><span class="o">.</span><span class="n">Draw</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">as</span> <span class="n">g</span><span class="p">:</span>
                    <span class="n">g</span><span class="o">.</span><span class="n">rectangle</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">extent_clip</span><span class="p">,</span> <span class="n">pen</span><span class="o">=</span><span class="n">gxg</span><span class="o">.</span><span class="n">Pen</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">edge_pen</span><span class="p">,</span> <span class="n">factor</span><span class="o">=</span><span class="n">v</span><span class="o">.</span><span class="n">units_per_map_cm</span><span class="p">))</span>

                <span class="c1"># if view has a known coordinate system, use compass annotations</span>
                <span class="k">if</span> <span class="n">compass</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">compass</span> <span class="o">=</span> <span class="n">gxcs</span><span class="o">.</span><span class="n">is_known</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">coordinate_system</span><span class="p">)</span>

            <span class="k">with</span> <span class="n">_Mapplot</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="k">as</span> <span class="n">mpl</span><span class="p">:</span>

                <span class="n">mpl</span><span class="o">.</span><span class="n">start_group</span><span class="p">(</span><span class="n">view_name</span> <span class="o">+</span> <span class="s1">&#39;_edge&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">view_name</span><span class="p">)</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">tick</span> <span class="ow">and</span> <span class="n">grid</span> <span class="o">==</span> <span class="n">GRID_LINES</span><span class="p">:</span>
                    <span class="n">tick</span> <span class="o">=</span> <span class="mf">0.0</span>

                <span class="n">mpl</span><span class="o">.</span><span class="n">define_named_attribute</span><span class="p">(</span><span class="s1">&#39;annot&#39;</span><span class="p">,</span> <span class="n">text_def</span><span class="o">=</span><span class="n">text_def</span><span class="p">,</span>
                                           <span class="n">pen</span><span class="o">=</span><span class="n">gxg</span><span class="o">.</span><span class="n">Pen</span><span class="p">(</span><span class="n">line_color</span><span class="o">=</span><span class="n">text_def</span><span class="o">.</span><span class="n">color</span><span class="p">,</span> <span class="n">line_thick</span><span class="o">=</span><span class="n">text_def</span><span class="o">.</span><span class="n">line_thick</span><span class="p">))</span>
                <span class="n">mpl</span><span class="o">.</span><span class="n">define_named_attribute</span><span class="p">(</span><span class="n">pen</span><span class="o">=</span><span class="n">edge_pen</span><span class="p">)</span>

                <span class="n">mpl</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s2">&quot;ANOX ,,,,,</span><span class="si">{}</span><span class="s2">,</span><span class="si">{}</span><span class="s2">,,</span><span class="si">{}</span><span class="s2">,,,,</span><span class="si">{}</span><span class="s2">,</span><span class="si">{}</span><span class="s2">,1&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x_sep</span><span class="p">,</span> <span class="n">tick</span><span class="p">,</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">compass</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">x_dec</span><span class="p">))</span>
                <span class="n">mpl</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;     annot&#39;</span><span class="p">)</span>
                <span class="n">mpl</span><span class="o">.</span><span class="n">command</span><span class="p">(</span>
                    <span class="s2">&quot;ANOY ,,,,,</span><span class="si">{}</span><span class="s2">,</span><span class="si">{}</span><span class="s2">,,</span><span class="si">{}</span><span class="s2">,</span><span class="si">{}</span><span class="s2">,,,</span><span class="si">{}</span><span class="s2">,</span><span class="si">{}</span><span class="s2">,1&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">y_sep</span><span class="p">,</span> <span class="n">tick</span><span class="p">,</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">compass</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">top</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">y_dec</span><span class="p">))</span>
                <span class="n">mpl</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;     annot&#39;</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">grid</span><span class="p">:</span>
                    <span class="n">mpl</span><span class="o">.</span><span class="n">define_named_attribute</span><span class="p">(</span><span class="n">pen</span><span class="o">=</span><span class="n">grid_pen</span><span class="p">)</span>
                    <span class="n">mpl</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s2">&quot;GRID </span><span class="si">{}</span><span class="s2">,,,,,_&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">grid</span><span class="p">))</span>

        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span>

        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_data_view</span> <span class="o">=</span> <span class="n">current_view</span></div>

<div class="viewcode-block" id="Map.annotate_data_ll"><a class="viewcode-back" href="../../../geosoft.gxpy.map.html#geosoft.gxpy.map.Map.annotate_data_ll">[docs]</a>    <span class="k">def</span> <span class="nf">annotate_data_ll</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                         <span class="n">view_name</span><span class="o">=</span><span class="s1">&#39;*data&#39;</span><span class="p">,</span>
                         <span class="n">tick</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                         <span class="n">offset</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                         <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                         <span class="n">top</span><span class="o">=</span><span class="n">TOP_OUT</span><span class="p">,</span>
                         <span class="n">text_def</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                         <span class="n">edge_pen</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                         <span class="n">grid</span><span class="o">=</span><span class="n">GRID_LINES</span><span class="p">,</span>
                         <span class="n">grid_pen</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Annotate the data view axis</span>

<span class="sd">        :param view_name:   name of the data view to annotate</span>
<span class="sd">        :param tick:        inner tick size in cm</span>
<span class="sd">        :param offset:      posting offset from the edge in cm. The posting edge is adjusted to be outside</span>
<span class="sd">                            character height for a subsequent call to an edge annotation.  This allows one to</span>
<span class="sd">                            annotate both geographic and projected coordinates.</span>
<span class="sd">        :param sep:         separation between annotations, default is calculated from data</span>
<span class="sd">        :param top:         TOP_IN or TOP_OUT (default) for vertical annotations</span>
<span class="sd">        :param grid:</span>

<span class="sd">                            ::</span>

<span class="sd">                                GRID_NONE       no grid</span>
<span class="sd">                                GRID_DOTTED     dotted lines</span>
<span class="sd">                                GRID_CROSSES    crosses at intersections</span>
<span class="sd">                                GRID_LINES      lines</span>

<span class="sd">        :param text_def:    `geosoft.gxpy.group.Text_def`, units cm</span>
<span class="sd">        :param edge_pen:    `geosoft.gxpy.group.Pen`, units cm</span>
<span class="sd">        :param grid_pen:    `geosoft.gxpy.group.Pen`, units cm</span>

<span class="sd">        .. versionadded:: 9.2</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">text_def</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">text_def</span> <span class="o">=</span> <span class="n">gxg</span><span class="o">.</span><span class="n">Text_def</span><span class="p">(</span><span class="n">height</span><span class="o">=</span><span class="mf">0.18</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">edge_pen</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">edge_pen</span> <span class="o">=</span> <span class="n">gxg</span><span class="o">.</span><span class="n">Pen</span><span class="p">(</span><span class="n">factor</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">grid_pen</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">grid_pen</span> <span class="o">=</span> <span class="n">edge_pen</span>

        <span class="n">current_view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_data_view</span>
        <span class="n">view_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">classview</span><span class="p">(</span><span class="n">view_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_data_view</span> <span class="o">=</span> <span class="n">view_name</span>

        <span class="k">try</span><span class="p">:</span>

            <span class="n">offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_annotation_offset</span><span class="p">(</span><span class="n">offset</span><span class="p">,</span> <span class="n">text_def</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>

            <span class="k">with</span> <span class="n">gxv</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">view_name</span><span class="p">)</span> <span class="k">as</span> <span class="n">v</span><span class="p">:</span>
                <span class="k">with</span> <span class="n">gxg</span><span class="o">.</span><span class="n">Draw</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">as</span> <span class="n">g</span><span class="p">:</span>
                    <span class="n">pen</span> <span class="o">=</span> <span class="n">gxg</span><span class="o">.</span><span class="n">Pen</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">edge_pen</span><span class="p">,</span> <span class="n">factor</span><span class="o">=</span><span class="n">v</span><span class="o">.</span><span class="n">units_per_map_cm</span><span class="p">)</span>
                    <span class="n">g</span><span class="o">.</span><span class="n">rectangle</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">extent_clip</span><span class="p">,</span> <span class="n">pen</span><span class="o">=</span><span class="n">pen</span><span class="p">)</span>

            <span class="k">with</span> <span class="n">_Mapplot</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="k">as</span> <span class="n">mpl</span><span class="p">:</span>

                <span class="n">mpl</span><span class="o">.</span><span class="n">start_group</span><span class="p">(</span><span class="n">view_name</span> <span class="o">+</span> <span class="s1">&#39;_edge&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">view_name</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">tick</span> <span class="ow">and</span> <span class="n">grid</span> <span class="o">==</span> <span class="n">GRID_LINES</span><span class="p">:</span>
                    <span class="n">tick</span> <span class="o">=</span> <span class="mf">0.0</span>

                <span class="n">mpl</span><span class="o">.</span><span class="n">define_named_attribute</span><span class="p">(</span><span class="s1">&#39;annot&#39;</span><span class="p">,</span> <span class="n">text_def</span><span class="o">=</span><span class="n">text_def</span><span class="p">,</span>
                                           <span class="n">pen</span><span class="o">=</span><span class="n">gxg</span><span class="o">.</span><span class="n">Pen</span><span class="p">(</span><span class="n">line_color</span><span class="o">=</span><span class="n">text_def</span><span class="o">.</span><span class="n">color</span><span class="p">,</span> <span class="n">line_thick</span><span class="o">=</span><span class="n">text_def</span><span class="o">.</span><span class="n">line_thick</span><span class="p">)</span>
                                           <span class="p">)</span>
                <span class="n">mpl</span><span class="o">.</span><span class="n">define_named_attribute</span><span class="p">(</span><span class="n">pen</span><span class="o">=</span><span class="n">edge_pen</span><span class="p">)</span>

                <span class="n">mpl</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s2">&quot;ALON </span><span class="si">{}</span><span class="s2">,</span><span class="si">{}</span><span class="s2">,</span><span class="si">{}</span><span class="s2">,,1&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sep</span><span class="p">,</span> <span class="n">tick</span><span class="p">,</span> <span class="n">offset</span><span class="p">))</span>
                <span class="n">mpl</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;    annot&#39;</span><span class="p">)</span>
                <span class="n">mpl</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s2">&quot;ALAT </span><span class="si">{}</span><span class="s2">,</span><span class="si">{}</span><span class="s2">,</span><span class="si">{}</span><span class="s2">,,,</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sep</span><span class="p">,</span> <span class="n">tick</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">top</span><span class="p">))</span>
                <span class="n">mpl</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;    annot&#39;</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">grid</span><span class="p">:</span>
                    <span class="n">mpl</span><span class="o">.</span><span class="n">define_named_attribute</span><span class="p">(</span><span class="n">pen</span><span class="o">=</span><span class="n">grid_pen</span><span class="p">)</span>
                    <span class="n">mpl</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s2">&quot;GRID -</span><span class="si">{}</span><span class="s2">,,,,,_&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">grid</span><span class="p">))</span>

        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span>

        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_data_view</span> <span class="o">=</span> <span class="n">current_view</span></div>

<div class="viewcode-block" id="Map.export_geotiff"><a class="viewcode-back" href="../../../geosoft.gxpy.map.html#geosoft.gxpy.map.Map.export_geotiff">[docs]</a>    <span class="k">def</span> <span class="nf">export_geotiff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">geotiff</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">96</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Export map as a GeoTIFF image</span>

<span class="sd">        :param geotiff:     GeoTIFF file name</span>
<span class="sd">        :param dpi:         resolution in dots-per-inch, default is common screen resolution of 96 dpi.</span>

<span class="sd">        .. versionadded:: 9.3</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gxmap</span><span class="o">.</span><span class="n">export_all_in_view</span><span class="p">(</span><span class="n">geotiff</span><span class="p">,</span> <span class="s2">&quot;*data&quot;</span><span class="p">,</span> <span class="n">gxapi</span><span class="o">.</span><span class="n">rDUMMY</span><span class="p">,</span> <span class="n">dpi</span><span class="p">,</span>
            <span class="n">gxapi</span><span class="o">.</span><span class="n">MAP_EXPORT_BITS_24</span><span class="p">,</span> <span class="n">gxapi</span><span class="o">.</span><span class="n">MAP_EXPORT_METHOD_NONE</span><span class="p">,</span>
            <span class="n">gxapi</span><span class="o">.</span><span class="n">MAP_EXPORT_FORMAT_GTIFF</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span></div></div>


<span class="k">class</span> <span class="nc">_Mapplot</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Internal class to marshal MAPPLOT commands to support basic map annotations.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xtype</span><span class="p">,</span> <span class="n">xvalue</span><span class="p">,</span> <span class="n">xtraceback</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="fm">__del__</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_process&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_process</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">(</span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;mapplot(</span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_map</span><span class="o">.</span><span class="n">file_name</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">map</span><span class="p">,</span> <span class="n">data_view</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ref_prefix</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">map</span><span class="o">.</span><span class="n">has_view</span><span class="p">(</span><span class="nb">map</span><span class="o">.</span><span class="n">current_base_view</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">map</span><span class="o">.</span><span class="n">has_view</span><span class="p">(</span><span class="nb">map</span><span class="o">.</span><span class="n">current_data_view</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="n">MapException</span><span class="p">(</span><span class="n">_t</span><span class="p">(</span><span class="s2">&quot;Map must have a &#39;*base&#39; and &#39;*data&#39; view.&quot;</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_map</span> <span class="o">=</span> <span class="nb">map</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ref_pre</span> <span class="o">=</span> <span class="n">ref_prefix</span>

        <span class="k">if</span> <span class="n">data_view</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prior_data_view</span> <span class="o">=</span> <span class="nb">map</span><span class="o">.</span><span class="n">current_data_view</span>
            <span class="nb">map</span><span class="o">.</span><span class="n">current_data_view</span> <span class="o">=</span> <span class="n">data_view</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prior_data_view</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># mapplot control file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_maplfile_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">gx</span><span class="o">.</span><span class="n">gx</span><span class="p">()</span><span class="o">.</span><span class="n">temp_folder</span><span class="p">(),</span> <span class="s1">&#39;mapl_&#39;</span> <span class="o">+</span> <span class="n">gxu</span><span class="o">.</span><span class="n">uuid</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;.con&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_maplfile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_maplfile_name</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_annotation_outer_edge</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_open</span> <span class="o">=</span> <span class="n">gx</span><span class="o">.</span><span class="n">track_resource</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maplfile_name</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">define_named_attribute</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pop</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maplfile</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_maplfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_maplfile</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">gxmapl</span> <span class="o">=</span> <span class="n">gxapi</span><span class="o">.</span><span class="n">GXMAPL</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_maplfile_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ref_pre</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">gxmapl</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_map</span><span class="o">.</span><span class="n">gxmap</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_maplfile_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prior_data_view</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">current_data_view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prior_data_view</span>
        <span class="k">if</span> <span class="n">pop</span><span class="p">:</span>
            <span class="n">gx</span><span class="o">.</span><span class="n">pop_resource</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_open</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_maplfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">command</span> <span class="ow">and</span> <span class="n">command</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_maplfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="c1"># geosoft.gxpy.gx.gx().log(command)</span>

    <span class="k">def</span> <span class="nf">define_named_attribute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="n">pen</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">text_def</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">pen</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">text_def</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s2">&quot;DATT </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">pen</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">pen</span> <span class="o">=</span> <span class="n">gxg</span><span class="o">.</span><span class="n">Pen</span><span class="p">(</span><span class="n">line_color</span><span class="o">=</span><span class="n">text_def</span><span class="o">.</span><span class="n">color</span><span class="p">,</span> <span class="n">line_thick</span><span class="o">=</span><span class="n">text_def</span><span class="o">.</span><span class="n">line_thick</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pen</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">pen</span> <span class="o">=</span> <span class="n">gxg</span><span class="o">.</span><span class="n">Pen</span><span class="o">.</span><span class="n">from_mapplot_string</span><span class="p">(</span><span class="n">pen</span><span class="p">)</span>
                <span class="n">pen</span><span class="o">.</span><span class="n">line_thick</span> <span class="o">=</span> <span class="n">pen</span><span class="o">.</span><span class="n">line_thick</span> <span class="o">*</span> <span class="mf">0.1</span> <span class="c1"># to cm</span>
            <span class="n">ls</span> <span class="o">=</span> <span class="n">pen</span><span class="o">.</span><span class="n">line_style</span>
            <span class="n">lp</span> <span class="o">=</span> <span class="n">pen</span><span class="o">.</span><span class="n">line_pitch</span>
            <span class="n">pen</span><span class="o">.</span><span class="n">line_thick</span> <span class="o">=</span> <span class="n">pen</span><span class="o">.</span><span class="n">line_thick</span> <span class="o">*</span> <span class="mf">10.0</span> <span class="c1"># to mm for mapplot_string</span>
            <span class="n">penstr</span> <span class="o">=</span> <span class="n">pen</span><span class="o">.</span><span class="n">mapplot_string</span>
            <span class="n">pen</span><span class="o">.</span><span class="n">line_thick</span> <span class="o">=</span> <span class="n">pen</span><span class="o">.</span><span class="n">line_thick</span> <span class="o">/</span> <span class="mf">10.0</span> <span class="c1"># back to cm</span>

            <span class="k">if</span> <span class="n">text_def</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">textstr</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">textstr</span> <span class="o">=</span> <span class="n">text_def</span><span class="o">.</span><span class="n">mapplot_string</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s2">&quot;DATT </span><span class="si">{}</span><span class="s2">=</span><span class="si">{}</span><span class="s2">,</span><span class="si">{}</span><span class="s2">,</span><span class="si">{}</span><span class="s2">,</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">penstr</span><span class="p">,</span> <span class="n">ls</span><span class="p">,</span> <span class="n">lp</span><span class="p">,</span> <span class="n">textstr</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">start_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">GROUP_NEW</span><span class="p">,</span> <span class="n">view</span><span class="o">=</span><span class="n">VIEW_BASE</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Start a view group, or append to an existing group.  Graphic entities can be organized</span>
<span class="sd">        into named groups, which appear as separate components that can be managed within a</span>
<span class="sd">        Geosoft viewer.</span>

<span class="sd">        :param name:    Group name (required).</span>
<span class="sd">        :param mode:    GROUP_NEW (default) or GROUP_APPEND.  GROUP_NEW relaces an existing group, and the</span>
<span class="sd">                        content of an existing group will be deleted.</span>
<span class="sd">        :param view:    VIEW_BASE or VIEW_DATA.  Coordinates in the base view are map cm, and coordionates</span>
<span class="sd">                        in the data view are in data view units.</span>

<span class="sd">        .. versionadded:: 9.2</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">view</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">view</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;base&#39;</span><span class="p">:</span>
                <span class="n">view</span> <span class="o">=</span> <span class="n">VIEW_BASE</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">view</span> <span class="o">=</span> <span class="n">VIEW_DATA</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s1">&#39;MGRP </span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">view</span><span class="p">))</span>
</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">Geosoft GX Python API 2021.2.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">geosoft.gxpy.map</a></li> 
      </ul>
    </div>

    <div class="footer" role="contentinfo">
        &#169; Copyright 2021, Geosoft Inc.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 3.2.1.
    </div>
<div class="footer">This page uses <a href="http://analytics.google.com/">
Google Analytics</a> to collect statistics. You can disable it by blocking
the JavaScript coming from www.google-analytics.com.
<script type="text/javascript">
  (function() {
    var ga = document.createElement('script');
    ga.src = ('https:' == document.location.protocol ?
              'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    ga.setAttribute('async', 'true');
    document.documentElement.firstChild.appendChild(ga);
  })();
</script>
</div>

  </body>
</html>