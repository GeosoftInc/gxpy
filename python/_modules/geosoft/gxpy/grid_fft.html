

<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>geosoft.gxpy.grid_fft &#8212; Geosoft GX Python API 2022.1.0 documentation</title>
    <link rel="stylesheet" href="../../../_static/maki.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
 
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-87443115-1']);
  _gaq.push(['_trackPageview']);
</script>

  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">Geosoft GX Python API 2022.1.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">geosoft.gxpy.grid_fft</a></li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Introduction</a></li>
    <li><a href="../../index.html">Module code</a></li>
</ul>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for geosoft.gxpy.grid_fft</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Geosoft Fast Fourier Transform processes for 2D gridded data.</span>

<span class="sd">:Classes:</span>
<span class="sd">    :`GridFFT`: Grid FFT</span>

<span class="sd">Note that &#39;wavenumber&#39; in this module refers to cycles/unit_distance. Multiply by 2*math.pi for the</span>
<span class="sd">angular wavenumber.</span>

<span class="sd">.. seealso:: :class:`geosoft.gxapi.GXFFT2`</span>

<span class="sd">.. note::</span>

<span class="sd">    Regression tests provide usage examples:     </span>
<span class="sd">    `Tests &lt;https://github.com/GeosoftInc/gxpy/blob/master/geosoft/gxpy/tests/test_grid_fft.py&gt;`_</span>
<span class="sd">    </span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">math</span>

<span class="kn">import</span> <span class="nn">geosoft</span>
<span class="kn">import</span> <span class="nn">geosoft.gxapi</span> <span class="k">as</span> <span class="nn">gxapi</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">gx</span> <span class="k">as</span> <span class="n">gx</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">grid</span> <span class="k">as</span> <span class="n">gxgrd</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">grid_utility</span> <span class="k">as</span> <span class="n">gxgrdu</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">utility</span> <span class="k">as</span> <span class="n">gxu</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">vv</span> <span class="k">as</span> <span class="n">gxvv</span>

<span class="n">__version__</span> <span class="o">=</span> <span class="n">geosoft</span><span class="o">.</span><span class="n">__version__</span>


<span class="k">def</span> <span class="nf">_t</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">geosoft</span><span class="o">.</span><span class="n">gxpy</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>


<span class="n">FILL_MAXIMUM_ENTROPY</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">FILL_MINIMUM_CURVATURE</span> <span class="o">=</span> <span class="mi">1</span>

<span class="n">TRN_SOURCE</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">TRN_FILTERED</span> <span class="o">=</span> <span class="mi">1</span>

<span class="n">I_WAVENUMBER</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">I_SAMPLE_COUNT</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">I_LOG_POWER</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">I_DEPTH_3</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">I_DEPTH_5</span> <span class="o">=</span> <span class="mi">4</span>


<div class="viewcode-block" id="GridFFTException"><a class="viewcode-back" href="../../../geosoft.gxpy.grid_fft.html#geosoft.gxpy.grid_fft.GridFFTException">[docs]</a><span class="k">class</span> <span class="nc">GridFFTException</span><span class="p">(</span><span class="n">geosoft</span><span class="o">.</span><span class="n">GXRuntimeError</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Exceptions from this module. &quot;&quot;&quot;</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="GridFFT"><a class="viewcode-back" href="../../../geosoft.gxpy.grid_fft.html#geosoft.gxpy.grid_fft.GridFFT">[docs]</a><span class="k">class</span> <span class="nc">GridFFT</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Descrete Fourier Transform of a grid.</span>

<span class="sd">    :param grid:            grid file name or a `geosoft.gxpy.grid.Grid` instance.</span>
<span class="sd">    :param expand:          minimum expansion percent to create a periodic function. The default is 10.</span>
<span class="sd">    :param trend_order:     trend order to remove, default is 1</span>
<span class="sd">    :param fill_method:     FILL_MAXIMUM_ENTROPY (default) or FILL_MINIMUM_CURVATURE.  Maximum entropy</span>
<span class="sd">                            prediction fills the expanded area in a way that preserves the character of the</span>
<span class="sd">                            radially-averaged power spectrum so that spectral analysis based on the shape</span>
<span class="sd">                            of the spectrum will be more reliable.</span>
<span class="sd">    </span>
<span class="sd">    The following parameters only apply for maximum-entropy prediction. The defaults will be fine in all but</span>
<span class="sd">    exceptional situations where edge effects unduly distort the result.</span>
<span class="sd">    </span>
<span class="sd">    :param buffer:              percentage buffer area, default 2%.  The buffer expands the size of the grid</span>
<span class="sd">                                footprint before filling internal space with a minimum-curvacture surface.  This</span>
<span class="sd">                                minimizes edge effects from high-amplitude features at the edge of the grid.</span>
<span class="sd">    :param buff_iterations:     maximum iterations to resolve the minimum curvature surface for the internal fill.</span>
<span class="sd">    :param filter_length:       maximum entropy filter length,</span>
<span class="sd">    :param amplitude_limit:     Amplitudes limiting, which starts at halve this setting.  Default no limiting.</span>
<span class="sd">    :param edge_limit:          edge amplitude limiting, starting at half this value. Default no limiting.</span>
<span class="sd">    :param edge_limit_cells:    if edge limiting, start this many cells from the edge</span>
<span class="sd">    :param smooth:              `True` (default) to smooth the filled expanded area.</span>
<span class="sd">    :param feather:             `True` to feather expanded data to mean value at the expanded edges. If `False`</span>
<span class="sd">                                the data will be periodic at the edges. Feathering may be useful should the</span>
<span class="sd">                                prediction function introduce unreasonable edge effects.</span>


<span class="sd">    .. versionadded:: 9.4</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_type</span><span class="p">,</span> <span class="n">_value</span><span class="p">,</span> <span class="n">_traceback</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="fm">__del__</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_close&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_close</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_open&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_open</span><span class="p">:</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">_source_transform</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">discard</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filtered_transform</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_filtered_transform</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">discard</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_prep_grid</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">discard</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">_source_grid</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_trend</span> <span class="o">=</span> <span class="kc">None</span>

                <span class="n">gx</span><span class="o">.</span><span class="n">pop_resource</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_open</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_open</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">(</span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;&lt;class GridFFT&gt;: </span><span class="si">{}</span><span class="s1"> (</span><span class="si">{}</span><span class="s1">, </span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_source_grid</span><span class="o">.</span><span class="n">nx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_source_grid</span><span class="o">.</span><span class="n">ny</span><span class="p">)</span>

<div class="viewcode-block" id="GridFFT.__init__"><a class="viewcode-back" href="../../../geosoft.gxpy.grid_fft.html#geosoft.gxpy.grid_fft.GridFFT.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">grid</span><span class="p">,</span>
                 <span class="n">buffer</span><span class="o">=</span><span class="mf">2.</span><span class="p">,</span>
                 <span class="n">buff_iterations</span><span class="o">=</span><span class="mi">250</span><span class="p">,</span>
                 <span class="n">buffer_tolerance</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">trend_order</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                 <span class="n">trend_edge</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                 <span class="n">expand</span><span class="o">=</span><span class="mf">10.</span><span class="p">,</span>
                 <span class="n">fill_method</span><span class="o">=</span><span class="n">FILL_MAXIMUM_ENTROPY</span><span class="p">,</span>
                 <span class="n">filter_length</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                 <span class="n">amplitude_limit</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span>
                 <span class="n">edge_limit</span><span class="o">=-</span><span class="mf">1.</span><span class="p">,</span>
                 <span class="n">edge_limit_cells</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                 <span class="n">smooth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                 <span class="n">feather</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

        <span class="k">def</span> <span class="nf">max_entropy_fill</span><span class="p">(</span><span class="n">btol</span><span class="p">,</span> <span class="n">melen</span><span class="p">,</span> <span class="n">feath</span><span class="p">):</span>

            <span class="k">def</span> <span class="nf">tpg_rows</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;=</span> <span class="n">grid</span><span class="o">.</span><span class="n">ny</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">None</span>
                <span class="n">tpg</span><span class="o">.</span><span class="n">read_row</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">rvv</span><span class="o">.</span><span class="n">gxvv</span><span class="p">)</span>
                <span class="n">xyv</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">y0</span> <span class="o">+</span> <span class="n">n</span> <span class="o">*</span> <span class="n">grid</span><span class="o">.</span><span class="n">dy</span>
                <span class="n">xyv</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">rvv</span><span class="o">.</span><span class="n">np</span>
                <span class="k">return</span> <span class="n">xyv</span>

            <span class="n">xyv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">grid</span><span class="o">.</span><span class="n">nx</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
            <span class="n">rvv</span> <span class="o">=</span> <span class="n">gxvv</span><span class="o">.</span><span class="n">GXvv</span><span class="p">()</span>

            <span class="c1"># expand buffer and fill</span>
            <span class="k">if</span> <span class="n">buffer</span> <span class="o">==</span> <span class="mf">0.</span><span class="p">:</span>
                <span class="n">buffer_cells</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">buffer_cells</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">+</span> <span class="nb">min</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">nx</span><span class="p">,</span> <span class="n">grid</span><span class="o">.</span><span class="n">ny</span><span class="p">)</span> <span class="o">*</span> <span class="n">buffer</span> <span class="o">/</span> <span class="mf">100.</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">gxc</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">_t</span><span class="p">(</span><span class="s1">&#39;Internal fill with </span><span class="si">{}</span><span class="s1"> cell buffer...&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">buffer_cells</span><span class="p">))</span>
            <span class="n">expanded_area</span> <span class="o">=</span> <span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">x0</span> <span class="o">-</span> <span class="n">buffer_cells</span> <span class="o">*</span> <span class="n">grid</span><span class="o">.</span><span class="n">dx</span><span class="p">,</span>
                             <span class="n">grid</span><span class="o">.</span><span class="n">y0</span> <span class="o">-</span> <span class="n">buffer_cells</span> <span class="o">*</span> <span class="n">grid</span><span class="o">.</span><span class="n">dy</span><span class="p">,</span>
                             <span class="n">grid</span><span class="o">.</span><span class="n">x0</span> <span class="o">+</span> <span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">nx</span> <span class="o">+</span> <span class="n">buffer_cells</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">grid</span><span class="o">.</span><span class="n">dx</span><span class="p">,</span>
                             <span class="n">grid</span><span class="o">.</span><span class="n">y0</span> <span class="o">+</span> <span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">ny</span> <span class="o">+</span> <span class="n">buffer_cells</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">grid</span><span class="o">.</span><span class="n">dy</span><span class="p">)</span>
            <span class="n">rvv</span><span class="o">.</span><span class="n">length</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">nx</span>
            <span class="n">xyv</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[(</span><span class="n">grid</span><span class="o">.</span><span class="n">x0</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="n">grid</span><span class="o">.</span><span class="n">dx</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">nx</span><span class="p">)]</span>
            <span class="n">bkd</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">nx</span><span class="p">,</span> <span class="n">grid</span><span class="o">.</span><span class="n">ny</span><span class="p">)</span> <span class="o">*</span> <span class="n">grid</span><span class="o">.</span><span class="n">dx</span>
            <span class="k">if</span> <span class="n">btol</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">btol</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">statistics</span><span class="p">()[</span><span class="s1">&#39;sd&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.001</span>
            <span class="n">buffer_grid</span> <span class="o">=</span> <span class="n">gxgrd</span><span class="o">.</span><span class="n">Grid</span><span class="o">.</span><span class="n">minimum_curvature</span><span class="p">(</span><span class="n">tpg_rows</span><span class="p">,</span>
                                                       <span class="n">cs</span><span class="o">=</span><span class="n">grid</span><span class="o">.</span><span class="n">dx</span><span class="p">,</span>
                                                       <span class="n">area</span><span class="o">=</span><span class="n">expanded_area</span><span class="p">,</span>
                                                       <span class="n">bkd</span><span class="o">=</span><span class="n">bkd</span><span class="p">,</span>
                                                       <span class="n">itrmax</span><span class="o">=</span><span class="n">buff_iterations</span><span class="p">,</span>
                                                       <span class="n">pastol</span><span class="o">=</span><span class="mf">99.</span><span class="p">,</span>
                                                       <span class="n">tol</span><span class="o">=</span><span class="n">btol</span><span class="p">,</span>
                                                       <span class="n">icgr</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>
                                                       <span class="n">max_segments</span><span class="o">=</span><span class="n">grid</span><span class="o">.</span><span class="n">ny</span><span class="p">)</span>

            <span class="c1"># expand for periodic function</span>
            <span class="n">gxc</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">_t</span><span class="p">(</span><span class="s1">&#39;Expand from (</span><span class="si">{}</span><span class="s1">, </span><span class="si">{}</span><span class="s1">)&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">nx</span><span class="p">,</span> <span class="n">grid</span><span class="o">.</span><span class="n">ny</span><span class="p">))</span>
            <span class="n">xpg</span> <span class="o">=</span> <span class="n">gxapi</span><span class="o">.</span><span class="n">GXPG</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">tpg</span><span class="o">.</span><span class="n">e_type</span><span class="p">())</span>
            <span class="n">gxapi</span><span class="o">.</span><span class="n">GXPGU</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="n">buffer_grid</span><span class="o">.</span><span class="n">gxpg</span><span class="p">(),</span> <span class="n">xpg</span><span class="p">,</span> <span class="n">expand</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

            <span class="n">xnx</span> <span class="o">=</span> <span class="n">xpg</span><span class="o">.</span><span class="n">n_cols</span><span class="p">()</span>
            <span class="n">xny</span> <span class="o">=</span> <span class="n">xpg</span><span class="o">.</span><span class="n">n_rows</span><span class="p">()</span>
            <span class="n">gxc</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">_t</span><span class="p">(</span><span class="s1">&#39;         to (</span><span class="si">{}</span><span class="s1">, </span><span class="si">{}</span><span class="s1">)...&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">xnx</span><span class="p">,</span> <span class="n">xny</span><span class="p">))</span>

            <span class="c1"># fill</span>
            <span class="n">gxc</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">_t</span><span class="p">(</span><span class="s1">&#39;Maximum-entropy prediction fill...&#39;</span><span class="p">))</span>

            <span class="n">reference_file</span> <span class="o">=</span> <span class="n">gx</span><span class="o">.</span><span class="n">gx</span><span class="p">()</span><span class="o">.</span><span class="n">temp_file</span><span class="p">(</span><span class="s1">&#39;grd&#39;</span><span class="p">)</span>
            <span class="n">gxapi</span><span class="o">.</span><span class="n">GXPGU</span><span class="o">.</span><span class="n">ref_file</span><span class="p">(</span><span class="n">xpg</span><span class="p">,</span> <span class="n">reference_file</span><span class="p">)</span>
            <span class="n">gxapi</span><span class="o">.</span><span class="n">GXPGU</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">xpg</span><span class="p">,</span>
                             <span class="mi">2</span><span class="p">,</span>                     <span class="c1"># Roll off weighting option: 1 - linear, 2 - square</span>
                             <span class="n">gxapi</span><span class="o">.</span><span class="n">rDUMMY</span><span class="p">,</span>          <span class="c1"># the value to roll off to, GS_R8DM for line mean</span>
                             <span class="mi">0</span><span class="p">,</span>                     <span class="c1"># roll-off distance in cells, 0 for none, -1 default</span>
                             <span class="n">melen</span><span class="p">,</span>                 <span class="c1"># max. filter length. -1 for no max. entropy. 0 for the default.</span>
                             <span class="mi">0</span><span class="p">,</span>                     <span class="c1"># max. pred. sample 0 for the default of 2*lMxf.</span>
                             <span class="n">amplitude_limit</span><span class="p">,</span>       <span class="c1"># limit amplitudes to this level, starting at half, 0. for none</span>
                             <span class="n">edge_limit</span><span class="p">,</span>  <span class="c1"># limit edge amplitudes to this level. &lt;0.0 for no none</span>
                             <span class="n">edge_limit_cells</span><span class="p">,</span>      <span class="c1"># edge limit width in cells, 0 for default.</span>
                             <span class="nb">int</span><span class="p">(</span><span class="nb">bool</span><span class="p">(</span><span class="n">smooth</span><span class="p">)),</span>     <span class="c1"># pass smooth filter, 0 or 1.</span>
                             <span class="n">reference_file</span><span class="p">)</span>
            <span class="n">gxu</span><span class="o">.</span><span class="n">delete_files_by_root</span><span class="p">(</span><span class="n">reference_file</span><span class="p">)</span>

            <span class="c1"># prepped grid</span>
            <span class="n">properties</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">properties</span><span class="p">()</span>
            <span class="n">properties</span><span class="p">[</span><span class="s1">&#39;x0&#39;</span><span class="p">],</span> <span class="n">properties</span><span class="p">[</span><span class="s1">&#39;y0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">xy_from_index</span><span class="p">((</span><span class="n">grid</span><span class="o">.</span><span class="n">nx</span> <span class="o">-</span> <span class="n">xpg</span><span class="o">.</span><span class="n">n_cols</span><span class="p">())</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">,</span>
                                                                    <span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">ny</span> <span class="o">-</span> <span class="n">xpg</span><span class="o">.</span><span class="n">n_rows</span><span class="p">())</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">)</span>

            <span class="n">prep_grid</span> <span class="o">=</span> <span class="n">gxgrd</span><span class="o">.</span><span class="n">Grid</span><span class="o">.</span><span class="n">from_data_array</span><span class="p">(</span><span class="n">xpg</span><span class="p">,</span> <span class="n">properties</span><span class="o">=</span><span class="n">properties</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">feath</span><span class="p">:</span>
                <span class="n">_xx</span><span class="p">,</span> <span class="n">_xy</span> <span class="o">=</span> <span class="p">(</span><span class="n">xpg</span><span class="o">.</span><span class="n">n_cols</span><span class="p">()</span> <span class="o">-</span> <span class="n">grid</span><span class="o">.</span><span class="n">nx</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="n">xpg</span><span class="o">.</span><span class="n">n_rows</span><span class="p">()</span> <span class="o">-</span> <span class="n">grid</span><span class="o">.</span><span class="n">ny</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>
                <span class="n">prep_grid</span> <span class="o">=</span> <span class="n">gxgrdu</span><span class="o">.</span><span class="n">feather</span><span class="p">(</span><span class="n">prep_grid</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">_xx</span><span class="p">,</span> <span class="n">_xy</span><span class="p">))</span>

            <span class="k">return</span> <span class="n">prep_grid</span>

        <span class="c1"># lets do this...</span>

        <span class="n">gxc</span> <span class="o">=</span> <span class="n">gx</span><span class="o">.</span><span class="n">gx</span><span class="p">()</span>  <span class="c1"># for logging</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">gxgrd</span><span class="o">.</span><span class="n">Grid</span><span class="p">):</span>
            <span class="n">grid</span> <span class="o">=</span> <span class="n">gxgrd</span><span class="o">.</span><span class="n">Grid</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_source_grid</span> <span class="o">=</span> <span class="n">grid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_source_grid</span><span class="o">.</span><span class="n">name</span>

        <span class="k">if</span> <span class="n">grid</span><span class="o">.</span><span class="n">rot</span> <span class="o">!=</span> <span class="mf">0.</span><span class="p">:</span>
            <span class="c1"># TODO: add support for rotated grids</span>
            <span class="k">raise</span> <span class="n">GridFFTException</span><span class="p">(</span><span class="n">_t</span><span class="p">(</span><span class="s1">&#39;Rotated grids are not supported.&#39;</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">grid</span><span class="o">.</span><span class="n">dx</span> <span class="o">!=</span> <span class="n">grid</span><span class="o">.</span><span class="n">dy</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">GridFFTException</span><span class="p">(</span><span class="n">_t</span><span class="p">(</span><span class="s1">&#39;Cell size must be square&#39;</span><span class="p">))</span>

        <span class="n">gxc</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">_t</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">GridFFT from: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">file_name</span><span class="p">))</span>

        <span class="c1"># remove trend</span>
        <span class="n">method</span> <span class="o">=</span> <span class="n">_t</span><span class="p">(</span><span class="s1">&#39;edge&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">trend_edge</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">_t</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>
        <span class="n">gxc</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">_t</span><span class="p">(</span><span class="s1">&#39;Remove </span><span class="si">{}</span><span class="s1"> order trend determined from </span><span class="si">{}</span><span class="s1"> data ...&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">trend_order</span><span class="p">,</span> <span class="n">method</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_trend</span> <span class="o">=</span> <span class="n">gxapi</span><span class="o">.</span><span class="n">GXTR</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">trend_order</span><span class="p">)</span>
        <span class="n">tpg</span> <span class="o">=</span> <span class="n">gxapi</span><span class="o">.</span><span class="n">GXPG</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">ny</span><span class="p">,</span> <span class="n">grid</span><span class="o">.</span><span class="n">nx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_source_grid</span><span class="o">.</span><span class="n">gxtype</span><span class="p">)</span>
        <span class="n">gxapi</span><span class="o">.</span><span class="n">GXPGU</span><span class="o">.</span><span class="n">trend</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">gxpg</span><span class="p">(),</span> <span class="n">tpg</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trend</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                          <span class="n">trend_edge</span><span class="p">,</span>
                          <span class="n">grid</span><span class="o">.</span><span class="n">x0</span><span class="p">,</span> <span class="n">grid</span><span class="o">.</span><span class="n">y0</span><span class="p">,</span>
                          <span class="n">grid</span><span class="o">.</span><span class="n">dx</span><span class="p">,</span> <span class="n">grid</span><span class="o">.</span><span class="n">dy</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">fill_method</span> <span class="o">==</span> <span class="n">FILL_MAXIMUM_ENTROPY</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_prep_grid</span> <span class="o">=</span> <span class="n">max_entropy_fill</span><span class="p">(</span><span class="n">buffer_tolerance</span><span class="p">,</span> <span class="n">filter_length</span><span class="p">,</span> <span class="n">feather</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="c1"># minimum-curvature</span>

            <span class="n">gxc</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">_t</span><span class="p">(</span><span class="s1">&#39;Expand from (</span><span class="si">{}</span><span class="s1">, </span><span class="si">{}</span><span class="s1">)&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">nx</span><span class="p">,</span> <span class="n">grid</span><span class="o">.</span><span class="n">ny</span><span class="p">))</span>
            <span class="n">ppg</span> <span class="o">=</span> <span class="n">gxapi</span><span class="o">.</span><span class="n">GXPG</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">tpg</span><span class="o">.</span><span class="n">e_type</span><span class="p">())</span>
            <span class="n">gxapi</span><span class="o">.</span><span class="n">GXPGU</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">gxpg</span><span class="p">(),</span> <span class="n">ppg</span><span class="p">,</span> <span class="n">expand</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">gxc</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">_t</span><span class="p">(</span><span class="s1">&#39;         to (</span><span class="si">{}</span><span class="s1">, </span><span class="si">{}</span><span class="s1">)...&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ppg</span><span class="o">.</span><span class="n">n_cols</span><span class="p">(),</span> <span class="n">ppg</span><span class="o">.</span><span class="n">n_rows</span><span class="p">()))</span>
            <span class="n">props</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">properties</span><span class="p">()</span>
            <span class="n">xx</span><span class="p">,</span> <span class="n">xy</span> <span class="o">=</span> <span class="p">(</span><span class="n">ppg</span><span class="o">.</span><span class="n">n_cols</span><span class="p">()</span> <span class="o">-</span> <span class="n">grid</span><span class="o">.</span><span class="n">nx</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="n">ppg</span><span class="o">.</span><span class="n">n_rows</span><span class="p">()</span> <span class="o">-</span> <span class="n">grid</span><span class="o">.</span><span class="n">ny</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>
            <span class="n">props</span><span class="p">[</span><span class="s1">&#39;x0&#39;</span><span class="p">],</span> <span class="n">props</span><span class="p">[</span><span class="s1">&#39;y0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">xy_from_index</span><span class="p">(</span><span class="o">-</span><span class="n">xx</span><span class="p">,</span> <span class="o">-</span><span class="n">xy</span><span class="p">)</span>
            <span class="n">exp_grid</span> <span class="o">=</span> <span class="n">gxgrd</span><span class="o">.</span><span class="n">Grid</span><span class="o">.</span><span class="n">from_data_array</span><span class="p">(</span><span class="n">ppg</span><span class="p">,</span> <span class="n">properties</span><span class="o">=</span><span class="n">props</span><span class="p">)</span>

            <span class="n">gxc</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">_t</span><span class="p">(</span><span class="s1">&#39;Minimum-curvature surface fill...&#39;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_prep_grid</span> <span class="o">=</span> <span class="n">gxgrdu</span><span class="o">.</span><span class="n">feather</span><span class="p">(</span><span class="n">gxgrdu</span><span class="o">.</span><span class="n">flood</span><span class="p">(</span><span class="n">exp_grid</span><span class="p">),</span> <span class="nb">min</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="n">xy</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_prep_grid</span><span class="o">.</span><span class="n">gximg</span><span class="o">.</span><span class="n">set_tr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_trend</span><span class="p">)</span>

        <span class="c1"># fft</span>
        <span class="n">gxc</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">_t</span><span class="p">(</span><span class="s1">&#39;FFT...&#39;</span><span class="p">))</span>
        <span class="n">fpg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prep_grid</span><span class="o">.</span><span class="n">gxpg</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">fpg</span><span class="o">.</span><span class="n">re_allocate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_prep_grid</span><span class="o">.</span><span class="n">ny</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prep_grid</span><span class="o">.</span><span class="n">nx</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">gxapi</span><span class="o">.</span><span class="n">GXFFT2</span><span class="o">.</span><span class="n">trans_pg</span><span class="p">(</span><span class="n">fpg</span><span class="p">,</span> <span class="n">gxapi</span><span class="o">.</span><span class="n">FFT2_PG_FORWARD</span><span class="p">)</span>
        <span class="n">trn_file</span> <span class="o">=</span> <span class="n">gx</span><span class="o">.</span><span class="n">gx</span><span class="p">()</span><span class="o">.</span><span class="n">temp_file</span><span class="p">(</span><span class="s1">&#39;.trn(GRD)&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_source_transform</span> <span class="o">=</span> <span class="n">gxgrd</span><span class="o">.</span><span class="n">Grid</span><span class="o">.</span><span class="n">from_data_array</span><span class="p">(</span><span class="n">fpg</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="n">trn_file</span><span class="p">,</span>
                                                            <span class="n">properties</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_prep_grid</span><span class="o">.</span><span class="n">properties</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_source_transform</span><span class="o">.</span><span class="n">gximg</span><span class="o">.</span><span class="n">set_tr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_trend</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_filtered_transform</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_next</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ny2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_source_transform</span><span class="o">.</span><span class="n">ny</span> <span class="o">//</span> <span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_u</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_u2</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_source_spectrum</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_filtered_spectrum</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_source_average_spectral_density</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_filtered_average_spectral_density</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># track</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_open</span> <span class="o">=</span> <span class="n">gx</span><span class="o">.</span><span class="n">track_resource</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span></div>

<div class="viewcode-block" id="GridFFT.uv_row_from_tr"><a class="viewcode-back" href="../../../geosoft.gxpy.grid_fft.html#geosoft.gxpy.grid_fft.GridFFT.uv_row_from_tr">[docs]</a>    <span class="k">def</span> <span class="nf">uv_row_from_tr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        Returns (u, v) space row index of a transform row.</span>

<span class="sd">        .. versionadded:: 9.4</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ny2</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ny2</span> <span class="k">else</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ny2</span><span class="p">)</span></div>

<div class="viewcode-block" id="GridFFT.tr_row_from_uv"><a class="viewcode-back" href="../../../geosoft.gxpy.grid_fft.html#geosoft.gxpy.grid_fft.GridFFT.tr_row_from_uv">[docs]</a>    <span class="k">def</span> <span class="nf">tr_row_from_uv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns transform row index from (u, v) space row index.</span>

<span class="sd">        .. versionadded:: 9.4</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ny2</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ny2</span> <span class="k">else</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ny2</span><span class="p">)</span></div>

<div class="viewcode-block" id="GridFFT.read_uv_row"><a class="viewcode-back" href="../../../geosoft.gxpy.grid_fft.html#geosoft.gxpy.grid_fft.GridFFT.read_uv_row">[docs]</a>    <span class="k">def</span> <span class="nf">read_uv_row</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">trn</span><span class="o">=</span><span class="n">TRN_SOURCE</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read a row (constant wavenumber v) from (u, v) transform.</span>

<span class="sd">        :param row:     row number in (u, v) space, row 0 is minimum v</span>
<span class="sd">        :param trn:     `TRN_SOURCE` from the source transform (default) or `TRN_FILTERED`</span>
<span class="sd">        :return:        (u_array, v, real_array, imaginary_array)</span>

<span class="sd">        To calculate a wavenumber array: wavenumber = np.sqrt(u_array**2 + v**2).</span>

<span class="sd">        Upward continuation example:</span>

<span class="sd">        .. code::</span>

<span class="sd">            import geosoft.gxpy.gx as gx</span>
<span class="sd">            import geosoft.gxpy.grid_fft as gfft</span>

<span class="sd">            gxc = gx.GXpy(log=print)</span>

<span class="sd">            with gxfft.GridFFT(&#39;some_mag_grid_file.grd&#39;) as fft:</span>

<span class="sd">                # for each row v in (u, v)</span>
<span class="sd">                for vrow in range(fft.nv):</span>

<span class="sd">                    # read the row</span>
<span class="sd">                    u, v, r, i = fft.read_uv_row(vrow)</span>

<span class="sd">                    # angular wavenumber along the row</span>
<span class="sd">                    wn = np.sqrt(u**2 + v**2) * 2. * math.pi</span>

<span class="sd">                    # upward continue 500 grid distance units</span>
<span class="sd">                    continuation_filter = np.exp(wn * -500.)</span>
<span class="sd">                    r *= continuation_filter</span>
<span class="sd">                    i *= continuation_filter</span>

<span class="sd">                    # write the filtered result to the TRN_FILTERED transform</span>
<span class="sd">                    fft.write_uv_row(r, i, vrow, trn=gxfft.TRN_FILTERED)</span>

<span class="sd">                # create an output grid of the upward-continued result</span>
<span class="sd">                fft.result_grid(file_name=&#39;upward_continued_500.grd&#39;)</span>

<span class="sd">        .. seealso:: `write_uv_row()`</span>

<span class="sd">        .. versionadded:: 9.4</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">trn</span> <span class="o">==</span> <span class="n">TRN_SOURCE</span><span class="p">:</span>
            <span class="n">tr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_transform</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filtered_transform</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">tr</span><span class="o">.</span><span class="n">read_row</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tr_row_from_uv</span><span class="p">(</span><span class="n">row</span><span class="p">))</span><span class="o">.</span><span class="n">np</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_u</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">r</span><span class="p">))</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dv</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_u2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_u</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">v</span> <span class="o">=</span> <span class="p">(</span><span class="n">row</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ny2</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dv</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">i</span></div>

<div class="viewcode-block" id="GridFFT.write_uv_row"><a class="viewcode-back" href="../../../geosoft.gxpy.grid_fft.html#geosoft.gxpy.grid_fft.GridFFT.write_uv_row">[docs]</a>    <span class="k">def</span> <span class="nf">write_uv_row</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">trn</span><span class="o">=</span><span class="n">TRN_SOURCE</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write a row (constant wavenumber v) to the (u, v) transform.</span>

<span class="sd">        :param r:       reals as a numpy array length half the width of the transform (as returned from `read_row`).</span>
<span class="sd">        :param i:       imaginary as a numpy array, matches r.</span>
<span class="sd">        :param row:     row number in (u, v) space, row 0 is minimum v</span>
<span class="sd">        :param trn:     `TRN_SOURCE` from the source transform (default) or `TRN_FILTERED`</span>

<span class="sd">        .. seealso:: `read_uv_row()`</span>

<span class="sd">        .. versionadded:: 9.4</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">trn</span> <span class="o">==</span> <span class="n">TRN_SOURCE</span><span class="p">:</span>
            <span class="n">tr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_transform</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filtered_transform</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tr</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
        <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span>
        <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
        <span class="n">tr</span><span class="o">.</span><span class="n">write_row</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tr_row_from_uv</span><span class="p">(</span><span class="n">row</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">row</span> <span class="o">==</span> <span class="n">tr</span><span class="o">.</span><span class="n">ny</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">trn</span> <span class="o">==</span> <span class="n">TRN_SOURCE</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_source_transform</span> <span class="o">=</span> <span class="n">gxgrd</span><span class="o">.</span><span class="n">reopen</span><span class="p">(</span><span class="n">tr</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_filtered_transform</span> <span class="o">=</span> <span class="n">gxgrd</span><span class="o">.</span><span class="n">reopen</span><span class="p">(</span><span class="n">tr</span><span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">du</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Wavenumber increment in the grid X direction in (cycles / grid distance uom)&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_source_transform</span><span class="o">.</span><span class="n">dx</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_source_transform</span><span class="o">.</span><span class="n">nx</span> <span class="o">-</span> <span class="mi">2</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">dv</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Wavenumber increment in the grid Y direction in (cycles / grid distance uom).&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_source_transform</span><span class="o">.</span><span class="n">dy</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_source_transform</span><span class="o">.</span><span class="n">ny</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">nu</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Number of discrete wavenumbers in grid X direction.</span>

<span class="sd">        The transform is folded in the x direction, will be half the transform width + 1</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_source_transform</span><span class="o">.</span><span class="n">nx</span> <span class="o">//</span> <span class="mi">2</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">nv</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Number of discrete wavenumbers in the grid Y direction.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_source_transform</span><span class="o">.</span><span class="n">ny</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">u0</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; First u (X-direction) wavenumber, always 0. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="mf">0.</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">v0</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; First v (Y-direction) wavenumber. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nv</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dv</span>

<div class="viewcode-block" id="GridFFT.filter"><a class="viewcode-back" href="../../../geosoft.gxpy.grid_fft.html#geosoft.gxpy.grid_fft.GridFFT.filter">[docs]</a>    <span class="k">def</span> <span class="nf">filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">trn</span><span class="o">=</span><span class="n">TRN_SOURCE</span><span class="p">,</span>
               <span class="n">height</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
               <span class="n">mag_inclination</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
               <span class="n">mag_declination</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
               <span class="n">mag_strength</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Apply a pre-defined filter.</span>

<span class="sd">        See filter reference: https://github.com/GeosoftInc/gxc/blob/master/reference/con_files/magmap.con</span>
<span class="sd">        </span>
<span class="sd">        :param filters:         list of filters to apply.  Each filter can be a string, or a tuple with the first</span>
<span class="sd">                                item being the filter name followed by the filter parameters. See `magmap.con`</span>
<span class="sd">                                referenced above for the full list of filters.</span>
<span class="sd">        :param trn:             `TRN_SOURCE` apply to the source transform (default) or</span>
<span class="sd">                                `TRN_FILTERED` to apply to the current filtered transform.</span>

<span class="sd">        The following parameter are the default for magnetic filed filters like pole/equator reduction and</span>
<span class="sd">        aparent susceptibility.</span>

<span class="sd">        :param height:          survey ground clearance in grid distance units</span>
<span class="sd">        :param mag_inclination: magnetic field inclination</span>
<span class="sd">        :param mag_declination: magnetic field declination</span>
<span class="sd">        :param mag_strength:    total magnetic filed strength for converting magnetization to susceptibility.</span>

<span class="sd">        Example upward continuation 500 grid distance units and a first vertical derivative:</span>

<span class="sd">        .. code::</span>

<span class="sd">            import geosoft.gxpy.gx as gx</span>
<span class="sd">            import geosoft.gxpy.grid_fft as gfft</span>

<span class="sd">            gxc = gx.GXpy(log=print)</span>

<span class="sd">            with gxfft.GridFFT(&#39;some_mag_grid_file.grd&#39;) as fft:</span>

<span class="sd">                # apply the filer</span>
<span class="sd">                fft.filter([&#39;CNUP 500&#39;, &#39;DRVZ 1&#39;])  # equlavalent to `fft.filter([(&#39;CNUP&#39;, 500), (&#39;DRVZ&#39;, 1)])`</span>

<span class="sd">                # create an output grid of the upward-continued result</span>
<span class="sd">                fft.result_grid(file_name=&#39;upward_continued_500.grd&#39;)</span>

<span class="sd">        .. versionadded:: 9.4</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">trn</span> <span class="o">==</span> <span class="n">TRN_SOURCE</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filtered_transform</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">transform</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_source_transform</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">transform</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filtered_transform</span>
        <span class="n">tpg</span> <span class="o">=</span> <span class="n">transform</span><span class="o">.</span><span class="n">gxpg</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">transform</span><span class="o">.</span><span class="n">gximg</span><span class="o">.</span><span class="n">get_tr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_trend</span><span class="p">)</span>

        <span class="c1"># control file</span>
        <span class="n">con_file</span> <span class="o">=</span> <span class="n">gx</span><span class="o">.</span><span class="n">gx</span><span class="p">()</span><span class="o">.</span><span class="n">temp_file</span><span class="p">(</span><span class="s1">&#39;con&#39;</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">con_file</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">cf</span><span class="p">:</span>

            <span class="c1"># control-file header parameters:</span>
            <span class="n">cf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>      <span class="c1"># title not used</span>
            <span class="n">cf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> /</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">height</span><span class="p">))</span>
            <span class="n">cf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> /</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mag_inclination</span><span class="p">))</span>
            <span class="n">cf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> /</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mag_declination</span><span class="p">))</span>
            <span class="n">cf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> /</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mag_strength</span><span class="p">))</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filters</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">filters</span> <span class="o">=</span> <span class="p">[</span><span class="n">filters</span><span class="p">]</span>

            <span class="c1"># filters</span>
            <span class="k">if</span> <span class="n">filters</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">filters</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                        <span class="n">cf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> /</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
                            <span class="n">cf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>
                        <span class="n">cf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;/</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="c1"># filter</span>
        <span class="n">gxapi</span><span class="o">.</span><span class="n">GXFFT2</span><span class="o">.</span><span class="n">filter_pg</span><span class="p">(</span><span class="n">tpg</span><span class="p">,</span> <span class="n">con_file</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trend</span><span class="p">,</span>
                               <span class="bp">self</span><span class="o">.</span><span class="n">_source_grid</span><span class="o">.</span><span class="n">dx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_source_grid</span><span class="o">.</span><span class="n">dy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_source_grid</span><span class="o">.</span><span class="n">rot</span><span class="p">)</span>
        <span class="n">gxu</span><span class="o">.</span><span class="n">delete_file</span><span class="p">(</span><span class="n">con_file</span><span class="p">)</span>

        <span class="n">file_name</span> <span class="o">=</span> <span class="n">gx</span><span class="o">.</span><span class="n">gx</span><span class="p">()</span><span class="o">.</span><span class="n">temp_file</span><span class="p">(</span><span class="s1">&#39;.trn(GRD)&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_filtered_transform</span> <span class="o">=</span> <span class="n">gxgrd</span><span class="o">.</span><span class="n">Grid</span><span class="o">.</span><span class="n">from_data_array</span><span class="p">(</span><span class="n">tpg</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="n">file_name</span><span class="p">,</span>
                                                              <span class="n">properties</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_source_transform</span><span class="o">.</span><span class="n">properties</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_filtered_transform</span><span class="o">.</span><span class="n">gximg</span><span class="o">.</span><span class="n">set_tr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_trend</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_filtered_average_spectral_density</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_filtered_spectrum</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="GridFFT.radially_averaged_spectrum"><a class="viewcode-back" href="../../../geosoft.gxpy.grid_fft.html#geosoft.gxpy.grid_fft.GridFFT.radially_averaged_spectrum">[docs]</a>    <span class="k">def</span> <span class="nf">radially_averaged_spectrum</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trn</span><span class="o">=</span><span class="n">TRN_SOURCE</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Radially averaged spectrum as a Numpy array shaped (n_wavenumbers, 5).</span>

<span class="sd">        :param trn:     `TRN_SOURCE` (default) return spectrum of the source data, or `TRN_FILTERED` return spectrum</span>
<span class="sd">                        of the current filtered state.</span>

<span class="sd">        .. note:: Numpy array shaped (n_wavenumbers, 5), where each row contains:</span>
<span class="sd">            [wavenumber, sample_count, log_power, 3-point_depth, 5-point_depth], wavenumber in cycles per</span>
<span class="sd">            1000 * distance unit of measure (cycle/km for metres), and log_power is the natural log of</span>
<span class="sd">            the power.</span>

<span class="sd">            Point depths are calculated by dividing the local slope(3 points and 5 points) of the log_power by (4 * pi)</span>
<span class="sd">            (see Spector and Grant, 1970).</span>

<span class="sd">            For code clarity, the following index constants can be used to reference columns in the</span>
<span class="sd">            spectrum array:</span>

<span class="sd">                ============== ===</span>
<span class="sd">                I_WAVENUMBER     0</span>
<span class="sd">                I_SAMPLE_COUNT   1</span>
<span class="sd">                I_LOG_POWER      2</span>
<span class="sd">                I_DEPTH_3        3</span>
<span class="sd">                I_DEPTH_5        4</span>
<span class="sd">                ============== ===</span>

<span class="sd">        .. versionadded:: 9.4</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="n">trn</span> <span class="o">==</span> <span class="n">TRN_SOURCE</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_source_spectrum</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_source_spectrum</span>
            <span class="n">tr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_transform</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filtered_spectrum</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filtered_spectrum</span>
            <span class="n">tr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filtered_transform</span>

        <span class="c1"># spectrum            </span>
        <span class="n">spec_file</span> <span class="o">=</span> <span class="n">gx</span><span class="o">.</span><span class="n">gx</span><span class="p">()</span><span class="o">.</span><span class="n">temp_file</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">gxapi</span><span class="o">.</span><span class="n">GXFFT2</span><span class="o">.</span><span class="n">rad_spc</span><span class="p">(</span><span class="n">tr</span><span class="o">.</span><span class="n">gximg</span><span class="p">,</span> <span class="n">spec_file</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">geosoft</span><span class="o">.</span><span class="n">gxapi</span><span class="o">.</span><span class="n">GXAPIError</span><span class="p">:</span>
            <span class="n">tpg</span> <span class="o">=</span> <span class="n">gxapi</span><span class="o">.</span><span class="n">GXPG</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">tr</span><span class="o">.</span><span class="n">ny</span><span class="p">,</span> <span class="n">tr</span><span class="o">.</span><span class="n">nx</span><span class="p">,</span> <span class="n">gxapi</span><span class="o">.</span><span class="n">GS_FLOAT</span><span class="p">)</span>
            <span class="n">tpg</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">tr</span><span class="o">.</span><span class="n">gxpg</span><span class="p">())</span>
            <span class="k">with</span> <span class="n">gxgrd</span><span class="o">.</span><span class="n">Grid</span><span class="o">.</span><span class="n">from_data_array</span><span class="p">(</span><span class="n">tpg</span><span class="p">,</span> <span class="n">properties</span><span class="o">=</span><span class="n">tr</span><span class="o">.</span><span class="n">properties</span><span class="p">())</span> <span class="k">as</span> <span class="n">tgd</span><span class="p">:</span>
                <span class="n">tgd</span><span class="o">.</span><span class="n">delete_files</span><span class="p">()</span>
                <span class="n">gxapi</span><span class="o">.</span><span class="n">GXFFT2</span><span class="o">.</span><span class="n">rad_spc</span><span class="p">(</span><span class="n">tgd</span><span class="o">.</span><span class="n">gximg</span><span class="p">,</span> <span class="n">spec_file</span><span class="p">)</span>

        <span class="n">length</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">tr</span><span class="o">.</span><span class="n">nx</span><span class="p">,</span> <span class="n">tr</span><span class="o">.</span><span class="n">ny</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>
        <span class="n">spectrum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">length</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
        <span class="n">wavenumber</span> <span class="o">=</span> <span class="n">spectrum</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">n_sample</span> <span class="o">=</span> <span class="n">spectrum</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">log_power</span> <span class="o">=</span> <span class="n">spectrum</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span>
        <span class="n">depth_3</span> <span class="o">=</span> <span class="n">spectrum</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]</span>
        <span class="n">depth_5</span> <span class="o">=</span> <span class="n">spectrum</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">]</span>

        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">asd</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">spec_file</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">sl</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">sl</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">sl</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;/&#39;</span><span class="p">:</span>
                        <span class="k">if</span> <span class="s1">&#39;=&#39;</span> <span class="ow">in</span> <span class="n">sl</span><span class="p">:</span>
                            <span class="k">try</span><span class="p">:</span>
                                <span class="n">asd</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">sl</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
                            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                                <span class="n">asd</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">pv</span> <span class="o">=</span> <span class="n">sl</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                        <span class="n">wavenumber</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">pv</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                        <span class="n">n_sample</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">pv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                        <span class="n">log_power</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">pv</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">depth_3</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">pv</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
                        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                            <span class="n">depth_3</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">depth_5</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">pv</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
                        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                            <span class="n">depth_5</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">spectrum</span> <span class="o">=</span> <span class="n">spectrum</span><span class="p">[:</span><span class="n">i</span><span class="p">]</span>
        <span class="n">gxu</span><span class="o">.</span><span class="n">delete_file</span><span class="p">(</span><span class="n">spec_file</span><span class="p">)</span>

        <span class="c1"># add the average spectral density back into the log_power</span>
        <span class="n">spectrum</span><span class="p">[:,</span> <span class="n">I_LOG_POWER</span><span class="p">]</span> <span class="o">+=</span> <span class="n">asd</span>

        <span class="k">if</span> <span class="n">trn</span> <span class="o">==</span> <span class="n">TRN_SOURCE</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_source_spectrum</span> <span class="o">=</span> <span class="n">spectrum</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_source_average_spectral_density</span> <span class="o">=</span> <span class="n">asd</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_filtered_spectrum</span> <span class="o">=</span> <span class="n">spectrum</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_filtered_average_spectral_density</span> <span class="o">=</span> <span class="n">asd</span>

        <span class="k">return</span> <span class="n">spectrum</span></div>

<div class="viewcode-block" id="GridFFT.log_average_spectral_density"><a class="viewcode-back" href="../../../geosoft.gxpy.grid_fft.html#geosoft.gxpy.grid_fft.GridFFT.log_average_spectral_density">[docs]</a>    <span class="k">def</span> <span class="nf">log_average_spectral_density</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trn</span><span class="o">=</span><span class="n">TRN_SOURCE</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Log of the average spectral density of the transform.</span>
<span class="sd">        </span>
<span class="sd">        :param trn:  `TRN_SOURCE` (default) source data spectrum, or `TRN_FILTERED` current filtered transform.</span>

<span class="sd">        .. versionadded:: 9.4</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">trn</span> <span class="o">==</span> <span class="n">TRN_SOURCE</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_source_average_spectral_density</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_source_average_spectral_density</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filtered_average_spectral_density</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filtered_average_spectral_density</span>

        <span class="c1"># estimate from radial spectrum data</span>
        <span class="n">rspec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">radially_averaged_spectrum</span><span class="p">(</span><span class="n">trn</span><span class="p">)</span>
        <span class="n">tot_samples</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rspec</span><span class="p">[</span><span class="n">I_SAMPLE_COUNT</span><span class="p">])</span>
        <span class="n">tot_energy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">rspec</span><span class="p">[</span><span class="n">I_LOG_POWER</span><span class="p">]))</span>
        <span class="n">asd</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">tot_energy</span> <span class="o">/</span> <span class="n">tot_samples</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">trn</span> <span class="o">==</span> <span class="n">TRN_SOURCE</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_source_average_spectral_density</span> <span class="o">=</span> <span class="n">asd</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_filtered_average_spectral_density</span> <span class="o">=</span> <span class="n">asd</span>
            
        <span class="k">return</span> <span class="n">asd</span></div>

<div class="viewcode-block" id="GridFFT.spectrum_grid"><a class="viewcode-back" href="../../../geosoft.gxpy.grid_fft.html#geosoft.gxpy.grid_fft.GridFFT.spectrum_grid">[docs]</a>    <span class="k">def</span> <span class="nf">spectrum_grid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trn</span><span class="o">=</span><span class="n">TRN_SOURCE</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the 2D log(power) amplitude as a grid in wavenumber domain (u, v).</span>

<span class="sd">        Amplitude = log(real**2 + imaginary**2)</span>
<span class="sd">        </span>
<span class="sd">        :param trn:      `TRN_SOURCE` source spectrum (default) or `TRN_FILTERED` filtered spectrum</span>
<span class="sd">        :param file_name:   name for the grid file, default is a temporary grid.</span>
<span class="sd">        :param overwrite:   `True` to overwrite existing grid.</span>

<span class="sd">        :return: `geosoft.gxpy.grid.Grid` instance</span>
<span class="sd">        </span>
<span class="sd">        .. versionadded:: 9.4</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="n">trn</span> <span class="o">==</span> <span class="n">TRN_SOURCE</span><span class="p">:</span>
            <span class="n">tr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_source_transform</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filtered_transform</span>

        <span class="n">du</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">tr</span><span class="o">.</span><span class="n">dx</span> <span class="o">*</span> <span class="p">(</span><span class="n">tr</span><span class="o">.</span><span class="n">nx</span> <span class="o">-</span> <span class="mi">2</span><span class="p">))</span>
        <span class="n">dv</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">tr</span><span class="o">.</span><span class="n">dy</span> <span class="o">*</span> <span class="n">tr</span><span class="o">.</span><span class="n">ny</span><span class="p">)</span>
        <span class="n">props</span> <span class="o">=</span> <span class="n">tr</span><span class="o">.</span><span class="n">properties</span><span class="p">()</span>
        <span class="n">props</span><span class="p">[</span><span class="s1">&#39;nx&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tr</span><span class="o">.</span><span class="n">nx</span> <span class="o">//</span> <span class="mi">2</span> 
        <span class="n">props</span><span class="p">[</span><span class="s1">&#39;ny&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tr</span><span class="o">.</span><span class="n">ny</span>
        <span class="n">props</span><span class="p">[</span><span class="s1">&#39;x0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">props</span><span class="p">[</span><span class="s1">&#39;y0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">tr</span><span class="o">.</span><span class="n">ny</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">dv</span>
        <span class="n">props</span><span class="p">[</span><span class="s1">&#39;dx&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">du</span> 
        <span class="n">props</span><span class="p">[</span><span class="s1">&#39;dy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dv</span>
        <span class="n">nperr</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">sgrd</span> <span class="o">=</span> <span class="n">gxgrd</span><span class="o">.</span><span class="n">Grid</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">file_name</span><span class="o">=</span><span class="n">file_name</span><span class="p">,</span> <span class="n">properties</span><span class="o">=</span><span class="n">props</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="n">overwrite</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">nperr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">seterr</span><span class="p">(</span><span class="n">under</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">tr</span><span class="o">.</span><span class="n">ny</span><span class="p">):</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">tr</span><span class="o">.</span><span class="n">read_row</span><span class="p">(</span><span class="n">row</span><span class="p">)</span><span class="o">.</span><span class="n">np</span>
                <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="mf">1.0e-20</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="n">i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="mf">1.0e-20</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="n">sgrd</span><span class="o">.</span><span class="n">write_row</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">r</span> <span class="o">+</span> <span class="n">i</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">uv_row_from_tr</span><span class="p">(</span><span class="n">row</span><span class="p">))</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">np</span><span class="o">.</span><span class="n">seterr</span><span class="p">(</span><span class="o">**</span><span class="n">nperr</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">sgrd</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">source_grid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Source grid as a `geosoft.gxpy.grid.Grid` instance. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_source_grid</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">expanded_filled_grid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Expanded and filled grid as a `geosoft.gxpy.grid.Grid` instance. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prep_grid</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">source_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Folded descrete Fourier transform as a `geosoft.gxpy.grid.Grid` instance.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_source_transform</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">filtered_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Folded descrete Fourier transform after filters applied.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filtered_transform</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_filtered_transform</span> <span class="o">=</span> <span class="n">gxgrd</span><span class="o">.</span><span class="n">Grid</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">properties</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_source_transform</span><span class="o">.</span><span class="n">properties</span><span class="p">())</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filtered_transform</span>

<div class="viewcode-block" id="GridFFT.result_grid"><a class="viewcode-back" href="../../../geosoft.gxpy.grid_fft.html#geosoft.gxpy.grid_fft.GridFFT.result_grid">[docs]</a>    <span class="k">def</span> <span class="nf">result_grid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Produce a filter result grid.</span>

<span class="sd">        :param file_name:   result grid file, default greates a temporary grid</span>
<span class="sd">        :param overwrite:   `True` to overwrite an existing grid</span>
<span class="sd">        :return:            `geosoft.gxpy.grid.Grid` instance</span>

<span class="sd">        .. versionadded:: 9.4</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filtered_transform</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_source_transform</span> <span class="o">=</span> <span class="n">gxgrd</span><span class="o">.</span><span class="n">reopen</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_source_transform</span><span class="p">)</span>
            <span class="n">trn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_source_transform</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_filtered_transform</span> <span class="o">=</span> <span class="n">gxgrd</span><span class="o">.</span><span class="n">reopen</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filtered_transform</span><span class="p">)</span>
            <span class="n">trn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filtered_transform</span>
        <span class="n">tpg</span> <span class="o">=</span> <span class="n">trn</span><span class="o">.</span><span class="n">gxpg</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># fft result</span>
        <span class="n">gxapi</span><span class="o">.</span><span class="n">GXFFT2</span><span class="o">.</span><span class="n">trans_pg</span><span class="p">(</span><span class="n">tpg</span><span class="p">,</span> <span class="n">gxapi</span><span class="o">.</span><span class="n">FFT2_PG_INVERSE</span><span class="p">)</span>

        <span class="c1"># reduce</span>
        <span class="n">ix0</span> <span class="o">=</span> <span class="p">((</span><span class="n">tpg</span><span class="o">.</span><span class="n">n_cols</span><span class="p">()</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_source_grid</span><span class="o">.</span><span class="n">nx</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>
        <span class="n">iy0</span> <span class="o">=</span> <span class="p">(</span><span class="n">tpg</span><span class="o">.</span><span class="n">n_rows</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_source_grid</span><span class="o">.</span><span class="n">ny</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>
        <span class="n">rpg</span> <span class="o">=</span> <span class="n">gxapi</span><span class="o">.</span><span class="n">GXPG</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_source_grid</span><span class="o">.</span><span class="n">ny</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_source_grid</span><span class="o">.</span><span class="n">nx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_source_grid</span><span class="o">.</span><span class="n">gxtype</span><span class="p">)</span>
        <span class="n">rpg</span><span class="o">.</span><span class="n">copy_subset</span><span class="p">(</span><span class="n">tpg</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">iy0</span><span class="p">,</span> <span class="n">ix0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_source_grid</span><span class="o">.</span><span class="n">ny</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_source_grid</span><span class="o">.</span><span class="n">nx</span><span class="p">)</span>

        <span class="c1"># put back the trend, which may have been filtered</span>
        <span class="n">gxapi</span><span class="o">.</span><span class="n">GXIMG</span><span class="o">.</span><span class="n">get_tr</span><span class="p">(</span><span class="n">trn</span><span class="o">.</span><span class="n">gximg</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trend</span><span class="p">)</span>
        <span class="n">result_pg</span> <span class="o">=</span> <span class="n">gxapi</span><span class="o">.</span><span class="n">GXPG</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">rpg</span><span class="o">.</span><span class="n">n_rows</span><span class="p">(),</span> <span class="n">rpg</span><span class="o">.</span><span class="n">n_cols</span><span class="p">(),</span> <span class="n">rpg</span><span class="o">.</span><span class="n">e_type</span><span class="p">())</span>
        <span class="n">gxapi</span><span class="o">.</span><span class="n">GXPGU</span><span class="o">.</span><span class="n">trend</span><span class="p">(</span><span class="n">rpg</span><span class="p">,</span> <span class="n">result_pg</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trend</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
                          <span class="bp">self</span><span class="o">.</span><span class="n">_source_grid</span><span class="o">.</span><span class="n">x0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_source_grid</span><span class="o">.</span><span class="n">y0</span><span class="p">,</span>
                          <span class="bp">self</span><span class="o">.</span><span class="n">_source_grid</span><span class="o">.</span><span class="n">dx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_source_grid</span><span class="o">.</span><span class="n">dy</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">gxgrd</span><span class="o">.</span><span class="n">Grid</span><span class="o">.</span><span class="n">from_data_array</span><span class="p">(</span><span class="n">result_pg</span><span class="p">,</span> <span class="n">properties</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_source_grid</span><span class="o">.</span><span class="n">properties</span><span class="p">(),</span>
                                            <span class="n">file_name</span><span class="o">=</span><span class="n">file_name</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="n">overwrite</span><span class="p">)</span>

        <span class="c1"># mask against original grid</span>
        <span class="n">result</span><span class="o">.</span><span class="n">mask</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source_grid</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">result</span></div></div>
</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">Geosoft GX Python API 2022.1.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">geosoft.gxpy.grid_fft</a></li> 
      </ul>
    </div>

    <div class="footer" role="contentinfo">
        &#169; Copyright 2022, Geosoft Inc.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 3.2.1.
    </div>
<div class="footer">This page uses <a href="http://analytics.google.com/">
Google Analytics</a> to collect statistics. You can disable it by blocking
the JavaScript coming from www.google-analytics.com.
<script type="text/javascript">
  (function() {
    var ga = document.createElement('script');
    ga.src = ('https:' == document.location.protocol ?
              'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    ga.setAttribute('async', 'true');
    document.documentElement.firstChild.appendChild(ga);
  })();
</script>
</div>

  </body>
</html>