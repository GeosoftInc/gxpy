

<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>geosoft.gxpy.grid_utility &#8212; Geosoft GX Python API 2022.2.0 documentation</title>
    <link rel="stylesheet" href="../../../_static/maki.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
 
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-87443115-1']);
  _gaq.push(['_trackPageview']);
</script>

  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">Geosoft GX Python API 2022.2.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">geosoft.gxpy.grid_utility</a></li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Introduction</a></li>
    <li><a href="../../index.html">Module code</a></li>
</ul>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for geosoft.gxpy.grid_utility</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Geosoft grid and image utilities.</span>

<span class="sd">.. seealso:: `geosoft.gxpy.grid`, `geosoft.gxapi.GXIMG`, `geosoft.gxapi.GXIMU`</span>

<span class="sd">.. note::</span>

<span class="sd">    Regression tests provide usage examples:     </span>
<span class="sd">    `Tests &lt;https://github.com/GeosoftInc/gxpy/blob/master/geosoft/gxpy/tests/test_grid_utility.py&gt;`_</span>
<span class="sd">    </span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">math</span>

<span class="kn">import</span> <span class="nn">geosoft</span>
<span class="kn">import</span> <span class="nn">geosoft.gxapi</span> <span class="k">as</span> <span class="nn">gxapi</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">gx</span> <span class="k">as</span> <span class="n">gx</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">vv</span> <span class="k">as</span> <span class="n">gxvv</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">grid</span> <span class="k">as</span> <span class="n">gxgrd</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="nb">map</span> <span class="k">as</span> <span class="n">gxmap</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">view</span> <span class="k">as</span> <span class="n">gxv</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">group</span> <span class="k">as</span> <span class="n">gxgrp</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">gdb</span> <span class="k">as</span> <span class="n">gxgdb</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">geometry</span> <span class="k">as</span> <span class="n">gxgeo</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">utility</span> <span class="k">as</span> <span class="n">gxu</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">geometry_utility</span> <span class="k">as</span> <span class="n">gxgeou</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">grid_fft</span> <span class="k">as</span> <span class="n">gxfft</span>

<span class="n">__version__</span> <span class="o">=</span> <span class="n">geosoft</span><span class="o">.</span><span class="n">__version__</span>

<span class="n">BOOL_AND</span> <span class="o">=</span> <span class="n">gxapi</span><span class="o">.</span><span class="n">IMU_BOOL_OPT_AND</span>
<span class="n">BOOL_OR</span> <span class="o">=</span> <span class="n">gxapi</span><span class="o">.</span><span class="n">IMU_BOOL_OPT_OR</span>
<span class="n">BOOL_XOR</span> <span class="o">=</span> <span class="n">gxapi</span><span class="o">.</span><span class="n">IMU_BOOL_OPT_XOR</span>
<span class="n">BOOL_SIZE_GRID1</span> <span class="o">=</span> <span class="n">gxapi</span><span class="o">.</span><span class="n">IMU_BOOL_SIZING_0</span>
<span class="n">BOOL_SIZE_GRID2</span> <span class="o">=</span> <span class="n">gxapi</span><span class="o">.</span><span class="n">IMU_BOOL_SIZING_1</span>
<span class="n">BOOL_SIZE_MIN</span> <span class="o">=</span> <span class="n">gxapi</span><span class="o">.</span><span class="n">IMU_BOOL_SIZING_MIN</span>
<span class="n">BOOL_SIZE_MAX</span> <span class="o">=</span> <span class="n">gxapi</span><span class="o">.</span><span class="n">IMU_BOOL_SIZING_MAX</span>
<span class="n">BOOL_OVERLAP_AVERAGE</span> <span class="o">=</span> <span class="n">gxapi</span><span class="o">.</span><span class="n">IMU_BOOL_OLAP_AVE</span>
<span class="n">BOOL_OVERLAP_GRID1</span> <span class="o">=</span> <span class="n">gxapi</span><span class="o">.</span><span class="n">IMU_BOOL_OLAP_1</span>
<span class="n">BOOL_OVERLAP_GRID2</span> <span class="o">=</span> <span class="n">gxapi</span><span class="o">.</span><span class="n">IMU_BOOL_OLAP_2</span>

<span class="n">TREND_EDGE</span> <span class="o">=</span> <span class="n">gxapi</span><span class="o">.</span><span class="n">IMU_TREND_EDGE</span>
<span class="n">TREND_ALL</span> <span class="o">=</span> <span class="n">gxapi</span><span class="o">.</span><span class="n">IMU_TREND_ALL</span>
<span class="n">DERIVATIVE_X</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">DERIVATIVE_Y</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">DERIVATIVE_Z</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">DERIVATIVE_XY</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">DERIVATIVE_XYZ</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">TILT_ANGLE</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">RETURN_PPOINT</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">RETURN_LIST_OF_PPOINT</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">RETURN_GDB</span> <span class="o">=</span> <span class="mi">2</span>


<span class="k">def</span> <span class="nf">_t</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">geosoft</span><span class="o">.</span><span class="n">gxpy</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>


<div class="viewcode-block" id="GridUtilityException"><a class="viewcode-back" href="../../../geosoft.gxpy.grid_utility.html#geosoft.gxpy.grid_utility.GridUtilityException">[docs]</a><span class="k">class</span> <span class="nc">GridUtilityException</span><span class="p">(</span><span class="n">geosoft</span><span class="o">.</span><span class="n">GXRuntimeError</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Exceptions from `geosoft.gxpy.grid_utility`.</span>

<span class="sd">    .. versionadded:: 9.4</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="remove_trend"><a class="viewcode-back" href="../../../geosoft.gxpy.grid_utility.html#geosoft.gxpy.grid_utility.remove_trend">[docs]</a><span class="k">def</span> <span class="nf">remove_trend</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">TREND_EDGE</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate a polynomial trend surface and return trend-removed grid.</span>

<span class="sd">    :param grid:        `geosoft.gxpy.grid.Grid` instance, or a file name</span>
<span class="sd">    :param file_name:   trend-removed grid file name, if `None` a temporary grid is created.</span>
<span class="sd">    :param method:      base trend on `TREND_EDGE` for edge data or `TREND_ALL` for all data</span>
<span class="sd">    :param overwrite:   True to overwrite existing file_name</span>
<span class="sd">    :return:            `Grid` instance</span>
<span class="sd">    </span>
<span class="sd">    .. versionadded 9.4</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">gxgrd</span><span class="o">.</span><span class="n">Grid</span><span class="p">):</span>
        <span class="n">grid</span> <span class="o">=</span> <span class="n">gxgrd</span><span class="o">.</span><span class="n">Grid</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">gxgrd</span><span class="o">.</span><span class="n">FILE_READ</span><span class="p">)</span>

    <span class="c1"># need GS_DOUBLE grids</span>
    <span class="k">if</span> <span class="n">grid</span><span class="o">.</span><span class="n">gxtype</span> <span class="o">!=</span> <span class="n">gxapi</span><span class="o">.</span><span class="n">GS_DOUBLE</span><span class="p">:</span>
        <span class="n">ing</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">gx</span><span class="o">.</span><span class="n">gx</span><span class="p">()</span><span class="o">.</span><span class="n">temp_file</span><span class="p">(</span><span class="s1">&#39;.grd(GRD)&#39;</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="n">ing</span><span class="o">.</span><span class="n">delete_files</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ing</span> <span class="o">=</span> <span class="n">grid</span>

    <span class="k">if</span> <span class="n">file_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">file_name</span> <span class="o">=</span> <span class="n">gx</span><span class="o">.</span><span class="n">gx</span><span class="p">()</span><span class="o">.</span><span class="n">temp_file</span><span class="p">(</span><span class="s1">&#39;.grd(GRD)&#39;</span><span class="p">)</span>
    <span class="n">dtg</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">file_name</span><span class="o">=</span><span class="n">file_name</span><span class="p">,</span> <span class="n">properties</span><span class="o">=</span><span class="n">ing</span><span class="o">.</span><span class="n">properties</span><span class="p">(),</span> <span class="n">overwrite</span><span class="o">=</span><span class="n">overwrite</span><span class="p">)</span>
    <span class="n">gxapi</span><span class="o">.</span><span class="n">GXIMU</span><span class="o">.</span><span class="n">grid_trnd</span><span class="p">(</span><span class="n">ing</span><span class="o">.</span><span class="n">gximg</span><span class="p">,</span> <span class="n">dtg</span><span class="o">.</span><span class="n">gximg</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
                          <span class="n">gxapi</span><span class="o">.</span><span class="n">GXVM</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">gxapi</span><span class="o">.</span><span class="n">GS_REAL</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">dtg</span></div>


<div class="viewcode-block" id="derivative"><a class="viewcode-back" href="../../../geosoft.gxpy.grid_utility.html#geosoft.gxpy.grid_utility.derivative">[docs]</a><span class="k">def</span> <span class="nf">derivative</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">derivative_type</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fft</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return a derivative of a grid or a tilt-angle</span>

<span class="sd">    :param grid:            `geosoft.gxpy.grid.Grid` instance, or a file name</span>
<span class="sd">    :param derivative_type:  Which derivative to calculate, (grid_data_uom/distance):</span>
<span class="sd">    </span>
<span class="sd">        ========================== ====================================================================</span>
<span class="sd">        DERIVATIVE_X               in the grid X direction</span>
<span class="sd">        DERIVATIVE_Y               in the grid Y direction</span>
<span class="sd">        DERIVATIVE_Z               in the grid Z direction</span>
<span class="sd">        DERIVATIVE_XYZ             the total derivative sqrt(dx**2 + dy**2 + dz**2) (analytic signal)</span>
<span class="sd">        TILT_ANGLE                 tilt angle, atan2(dz, sqrt(dx**2 + dy**2)) (radians)</span>
<span class="sd">        ========================== ====================================================================</span>
<span class="sd">    </span>
<span class="sd">    :param file_name:   returned derivative file name, `None` for a temporary file</span>
<span class="sd">    :param overwrite:   True to overwrite existing file</span>
<span class="sd">    :param dtype:       dtype for the return grid, default is the same as the passed grid.</span>
<span class="sd">    :param fft:         `False` calculate Z derivative with a space-domain convolution rather than an FFT.</span>
<span class="sd">    :return:            `geosoft.gxpy.grid.Grid` instance that contains the derivative result</span>

<span class="sd">    .. note:: Derivative units_of_measure are grid_unit_of_measure / distance, except for the tilt angle,</span>
<span class="sd">        which is radians.</span>

<span class="sd">        Horizontal derivatives are calculated in the space domain based on the difference between</span>
<span class="sd">        neighboring cell values, and the Z derivative can be calculated using an FFT or a 5x5 space-domain</span>
<span class="sd">        convolution.  An FFT calculation will generally produce a better result and it will be able to</span>
<span class="sd">        work with longer wavelengths, but at the expense of speed and edge effects in cases of very powerful</span>
<span class="sd">        anomalies along the edge of a grid.</span>

<span class="sd">    .. versionadded 9.4</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">vertical_derivative</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">dt</span><span class="p">):</span>

        <span class="c1"># float64 grids for grid_vd</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">gxgrd</span><span class="o">.</span><span class="n">Grid</span><span class="p">):</span>
            <span class="n">g</span> <span class="o">=</span> <span class="n">gxgrd</span><span class="o">.</span><span class="n">Grid</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">gxgrd</span><span class="o">.</span><span class="n">FILE_READ</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">dtype</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">:</span>
            <span class="n">g</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">gx</span><span class="o">.</span><span class="n">gx</span><span class="p">()</span><span class="o">.</span><span class="n">temp_file</span><span class="p">(</span><span class="s1">&#39;.grd(GRD)&#39;</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">g</span><span class="o">.</span><span class="n">delete_files</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">fft</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">gxfft</span><span class="o">.</span><span class="n">GridFFT</span><span class="p">(</span><span class="n">g</span><span class="p">)</span> <span class="k">as</span> <span class="n">gfft</span><span class="p">:</span>
                <span class="n">gfft</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">filters</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;DRVZ 1&#39;</span><span class="p">])</span>
                <span class="n">dzg</span> <span class="o">=</span> <span class="n">gfft</span><span class="o">.</span><span class="n">result_grid</span><span class="p">(</span><span class="n">file_name</span><span class="o">=</span><span class="n">file_name</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="n">overwrite</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dzg</span> <span class="o">=</span> <span class="n">gxgrd</span><span class="o">.</span><span class="n">Grid</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">file_name</span><span class="o">=</span><span class="n">file_name</span><span class="p">,</span> <span class="n">properties</span><span class="o">=</span><span class="n">g</span><span class="o">.</span><span class="n">properties</span><span class="p">(),</span> <span class="n">overwrite</span><span class="o">=</span><span class="n">overwrite</span><span class="p">)</span>
            <span class="n">gxapi</span><span class="o">.</span><span class="n">GXIMU</span><span class="o">.</span><span class="n">grid_vd</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">gximg</span><span class="p">,</span> <span class="n">dzg</span><span class="o">.</span><span class="n">gximg</span><span class="p">)</span>
        <span class="n">dzg</span><span class="o">.</span><span class="n">unit_of_measure</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">unit_of_measure</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">g</span><span class="o">.</span><span class="n">coordinate_system</span><span class="o">.</span><span class="n">unit_of_measure</span>
        <span class="k">return</span> <span class="n">gxgrd</span><span class="o">.</span><span class="n">reopen</span><span class="p">(</span><span class="n">dzg</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dt</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">tilt_angle</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">fn</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">dx</span> <span class="o">=</span> <span class="n">derivative</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">DERIVATIVE_X</span><span class="p">)</span>
        <span class="n">dy</span> <span class="o">=</span> <span class="n">derivative</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">DERIVATIVE_Y</span><span class="p">)</span>
        <span class="n">dz</span> <span class="o">=</span> <span class="n">derivative</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">DERIVATIVE_Z</span><span class="p">,</span> <span class="n">fft</span><span class="o">=</span><span class="n">fft</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">expression</span><span class="p">((</span><span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">dz</span><span class="p">),</span> <span class="s1">&#39;atan2(g3,sqrt(g1**2+g2**2))&#39;</span><span class="p">,</span>
                            <span class="n">result_file_name</span><span class="o">=</span><span class="n">fn</span><span class="p">,</span>
                            <span class="n">overwrite</span><span class="o">=</span><span class="n">overwrite</span><span class="p">)</span>
        <span class="n">result</span><span class="o">.</span><span class="n">unit_of_measure</span> <span class="o">=</span> <span class="s1">&#39;radians&#39;</span>
        <span class="k">return</span> <span class="n">gxgrd</span><span class="o">.</span><span class="n">reopen</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">horizontal_gradient</span><span class="p">(</span><span class="n">g</span><span class="p">):</span>
        <span class="n">dx</span> <span class="o">=</span> <span class="n">derivative</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">DERIVATIVE_X</span><span class="p">)</span>
        <span class="n">dy</span> <span class="o">=</span> <span class="n">derivative</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">DERIVATIVE_Y</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">expression</span><span class="p">((</span><span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">),</span> <span class="s1">&#39;sqrt(g1**2+g2**2)&#39;</span><span class="p">,</span>
                            <span class="n">result_file_name</span><span class="o">=</span><span class="n">file_name</span><span class="p">,</span>
                            <span class="n">overwrite</span><span class="o">=</span><span class="n">overwrite</span><span class="p">)</span>
        <span class="n">result</span><span class="o">.</span><span class="n">unit_of_measure</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">unit_of_measure</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">g</span><span class="o">.</span><span class="n">coordinate_system</span><span class="o">.</span><span class="n">unit_of_measure</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">total_gradient</span><span class="p">(</span><span class="n">g</span><span class="p">):</span>
        <span class="n">dx</span> <span class="o">=</span> <span class="n">derivative</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">DERIVATIVE_X</span><span class="p">)</span>
        <span class="n">dy</span> <span class="o">=</span> <span class="n">derivative</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">DERIVATIVE_Y</span><span class="p">)</span>
        <span class="n">dz</span> <span class="o">=</span> <span class="n">derivative</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">DERIVATIVE_Z</span><span class="p">,</span> <span class="n">fft</span><span class="o">=</span><span class="n">fft</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">expression</span><span class="p">((</span><span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">dz</span><span class="p">),</span> <span class="s1">&#39;sqrt(g1**2+g2**2+g3**2)&#39;</span><span class="p">,</span>
                            <span class="n">result_file_name</span><span class="o">=</span><span class="n">file_name</span><span class="p">,</span>
                            <span class="n">overwrite</span><span class="o">=</span><span class="n">overwrite</span><span class="p">)</span>
        <span class="n">result</span><span class="o">.</span><span class="n">unit_of_measure</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">unit_of_measure</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">g</span><span class="o">.</span><span class="n">coordinate_system</span><span class="o">.</span><span class="n">unit_of_measure</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">if</span> <span class="n">derivative_type</span> <span class="o">==</span> <span class="n">DERIVATIVE_Z</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">vertical_derivative</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>

    <span class="c1"># need float32 grids for grid_filt</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">gxgrd</span><span class="o">.</span><span class="n">Grid</span><span class="p">):</span>
        <span class="n">grid</span> <span class="o">=</span> <span class="n">gxgrd</span><span class="o">.</span><span class="n">Grid</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">gxgrd</span><span class="o">.</span><span class="n">FILE_READ</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">dtype</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">return_dtype</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">dtype</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">return_dtype</span> <span class="o">=</span> <span class="n">dtype</span>

    <span class="k">if</span> <span class="n">grid</span><span class="o">.</span><span class="n">dtype</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">:</span>
        <span class="n">grid</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">gx</span><span class="o">.</span><span class="n">gx</span><span class="p">()</span><span class="o">.</span><span class="n">temp_file</span><span class="p">(</span><span class="s1">&#39;.grd(GRD)&#39;</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">delete_files</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">derivative_type</span> <span class="o">==</span> <span class="n">DERIVATIVE_XY</span><span class="p">:</span>
        <span class="n">rgrd</span> <span class="o">=</span> <span class="n">horizontal_gradient</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">rgrd</span><span class="o">.</span><span class="n">dtype</span> <span class="o">!=</span> <span class="n">return_dtype</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">gxgrd</span><span class="o">.</span><span class="n">reopen</span><span class="p">(</span><span class="n">rgrd</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">return_dtype</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">rgrd</span>

    <span class="k">if</span> <span class="n">derivative_type</span> <span class="o">==</span> <span class="n">DERIVATIVE_XYZ</span><span class="p">:</span>
        <span class="n">rgrd</span> <span class="o">=</span> <span class="n">total_gradient</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">rgrd</span><span class="o">.</span><span class="n">dtype</span> <span class="o">!=</span> <span class="n">return_dtype</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">gxgrd</span><span class="o">.</span><span class="n">reopen</span><span class="p">(</span><span class="n">rgrd</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">return_dtype</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">rgrd</span>

    <span class="k">if</span> <span class="n">derivative_type</span> <span class="o">==</span> <span class="n">TILT_ANGLE</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">file_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">file_name</span> <span class="o">=</span> <span class="n">gx</span><span class="o">.</span><span class="n">gx</span><span class="p">()</span><span class="o">.</span><span class="n">temp_file</span><span class="p">(</span><span class="s1">&#39;.grd(GRD)&#39;</span><span class="p">)</span>
        <span class="n">rgrd</span> <span class="o">=</span> <span class="n">tilt_angle</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">fn</span><span class="o">=</span><span class="n">file_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">rgrd</span><span class="o">.</span><span class="n">dtype</span> <span class="o">!=</span> <span class="n">return_dtype</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">gxgrd</span><span class="o">.</span><span class="n">reopen</span><span class="p">(</span><span class="n">rgrd</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">return_dtype</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">rgrd</span>

    <span class="c1"># dxy grid</span>
    <span class="k">if</span> <span class="n">file_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">file_name</span> <span class="o">=</span> <span class="n">gx</span><span class="o">.</span><span class="n">gx</span><span class="p">()</span><span class="o">.</span><span class="n">temp_file</span><span class="p">(</span><span class="s1">&#39;.grd(GRD)&#39;</span><span class="p">)</span>
    <span class="n">dxy</span> <span class="o">=</span> <span class="n">gxgrd</span><span class="o">.</span><span class="n">Grid</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">file_name</span><span class="o">=</span><span class="n">file_name</span><span class="p">,</span> <span class="n">properties</span><span class="o">=</span><span class="n">grid</span><span class="o">.</span><span class="n">properties</span><span class="p">(),</span> <span class="n">overwrite</span><span class="o">=</span><span class="n">overwrite</span><span class="p">)</span>

    <span class="c1"># filter</span>
    <span class="k">if</span> <span class="n">derivative_type</span> <span class="o">==</span> <span class="n">DERIVATIVE_X</span><span class="p">:</span>
        <span class="n">filter_vv</span> <span class="o">=</span> <span class="n">gxvv</span><span class="o">.</span><span class="n">GXvv</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="o">+</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="n">mult</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">grid</span><span class="o">.</span><span class="n">dx</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">filter_vv</span> <span class="o">=</span> <span class="n">gxvv</span><span class="o">.</span><span class="n">GXvv</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="n">mult</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">grid</span><span class="o">.</span><span class="n">dy</span>
    <span class="n">gxapi</span><span class="o">.</span><span class="n">GXIMU</span><span class="o">.</span><span class="n">grid_filt</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">gximg</span><span class="p">,</span> <span class="n">dxy</span><span class="o">.</span><span class="n">gximg</span><span class="p">,</span>
                          <span class="mi">1</span><span class="p">,</span> <span class="n">mult</span><span class="p">,</span>
                          <span class="n">gxapi</span><span class="o">.</span><span class="n">IMU_FILT_DUMMY_NO</span><span class="p">,</span>
                          <span class="n">gxapi</span><span class="o">.</span><span class="n">IMU_FILT_HZDRV_NO</span><span class="p">,</span>
                          <span class="n">gxapi</span><span class="o">.</span><span class="n">IMU_FILT_FILE_NO</span><span class="p">,</span>
                          <span class="s2">&quot;&quot;</span><span class="p">,</span>
                          <span class="n">filter_vv</span><span class="o">.</span><span class="n">gxvv</span><span class="p">)</span>
    <span class="n">dxy</span><span class="o">.</span><span class="n">unit_of_measure</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">unit_of_measure</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">grid</span><span class="o">.</span><span class="n">coordinate_system</span><span class="o">.</span><span class="n">unit_of_measure</span>
    <span class="k">return</span> <span class="n">gxgrd</span><span class="o">.</span><span class="n">reopen</span><span class="p">(</span><span class="n">dxy</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">return_dtype</span><span class="p">)</span></div>


<div class="viewcode-block" id="tilt_depth"><a class="viewcode-back" href="../../../geosoft.gxpy.grid_utility.html#geosoft.gxpy.grid_utility.tilt_depth">[docs]</a><span class="k">def</span> <span class="nf">tilt_depth</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">return_as</span><span class="o">=</span><span class="n">RETURN_PPOINT</span><span class="p">,</span> <span class="n">gdb</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fft</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return estimate of the depth sources of potential filed anomalies.</span>

<span class="sd">    :param grid:        `geosoft.gxpy.grid.Grid` instance or a grid file name. Ideally the grid should be RTP.</span>
<span class="sd">    :param resolution:  zero-contour sampling resolution, defaults to 4 times the grid cell size.</span>
<span class="sd">    :param return_as:   return results as:</span>

<span class="sd">        ===================== ====================================================================</span>
<span class="sd">        RETURN_PPOINT         return results as a single `geosoft.gxpy.geometry.PPoint` instance</span>
<span class="sd">        RETURN_LIST_OF_PPOINT return results as a list of `geosoft.gxpy.geometry.PPoint` instances</span>
<span class="sd">        RETURN_GDB            return result as a `geosoft.gxpy.gdb.Geosoft_gdb` instance</span>
<span class="sd">        ===================== ====================================================================</span>

<span class="sd">    :param gdb:         return database name, or a `geosoft.gxpy.gdv.Geosoft_database` instance. If not</span>
<span class="sd">                        specified and `return_as=RETURN_GDB`, a temporary database is created.</span>
<span class="sd">    :param overwrite:   True to overwrite existing gdb.</span>
<span class="sd">    :param fft:         `False` to use a space-domain convolution.  The default uses an FFT, which will</span>
<span class="sd">                        in general produce a cleaner and more accurate result, though it may be slower.</span>
<span class="sd">    :return:            depends on `return_as` setting</span>

<span class="sd">    .. note:: Given a TMI grid, or the vertical derivative of the gravity anomaly, calculate</span>
<span class="sd">        contact source depths using the tilt-depth method. The contact source depth is the</span>
<span class="sd">        reciprocol of the horizontal gradient of the tilt-derivative at the zero-contour of</span>
<span class="sd">        the tilt derivative.</span>

<span class="sd">    .. versionadded:: 9.4</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">gdb</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">return_as</span> <span class="o">=</span> <span class="n">RETURN_GDB</span>

    <span class="n">gxc</span> <span class="o">=</span> <span class="n">gx</span><span class="o">.</span><span class="n">gx</span><span class="p">()</span>
    <span class="n">gxc</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;Calculate tilt-angle...&#39;</span><span class="p">)</span>

    <span class="n">ta</span> <span class="o">=</span> <span class="n">derivative</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">TILT_ANGLE</span><span class="p">,</span> <span class="n">fft</span><span class="o">=</span><span class="n">fft</span><span class="p">)</span>
    <span class="n">gxc</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;Find zero contour of the tilt-angle...&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">resolution</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">resolution</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">ta</span><span class="o">.</span><span class="n">dx</span><span class="p">,</span> <span class="n">ta</span><span class="o">.</span><span class="n">dy</span><span class="p">)</span> <span class="o">*</span> <span class="mf">4.</span>
    <span class="n">gdb</span> <span class="o">=</span> <span class="n">contour_points</span><span class="p">(</span><span class="n">ta</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="n">resolution</span><span class="p">,</span> <span class="n">return_as</span><span class="o">=</span><span class="n">RETURN_GDB</span><span class="p">,</span> <span class="n">gdb</span><span class="o">=</span><span class="n">gdb</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="n">overwrite</span><span class="p">)</span>
    <span class="n">gxc</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;Calculate tilt-derivative...&#39;</span><span class="p">)</span>
    <span class="n">tad</span> <span class="o">=</span> <span class="n">derivative</span><span class="p">(</span><span class="n">ta</span><span class="p">,</span> <span class="n">DERIVATIVE_XY</span><span class="p">,</span> <span class="n">fft</span><span class="o">=</span><span class="n">fft</span><span class="p">)</span>

    <span class="c1"># get gradient of the TD at the zero locations</span>
    <span class="n">gxc</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;Calculate depth = reciprocal(tilt-derivative) at zero contour of the tilt-angle...&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">ln</span> <span class="ow">in</span> <span class="n">gdb</span><span class="o">.</span><span class="n">list_lines</span><span class="p">():</span>
        <span class="n">xyz</span><span class="p">,</span> <span class="n">chlist</span><span class="p">,</span> <span class="n">fid</span> <span class="o">=</span> <span class="n">gdb</span><span class="o">.</span><span class="n">read_line</span><span class="p">(</span><span class="n">ln</span><span class="p">,</span> <span class="n">channels</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="s1">&#39;Z&#39;</span><span class="p">))</span>
        <span class="n">zero_tad</span> <span class="o">=</span> <span class="n">sample</span><span class="p">(</span><span class="n">tad</span><span class="p">,</span> <span class="n">xyz</span><span class="p">)</span>
        <span class="n">zero_tad</span><span class="p">[</span><span class="n">zero_tad</span> <span class="o">==</span> <span class="mf">0.</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="n">np</span><span class="o">.</span><span class="n">reciprocal</span><span class="p">(</span><span class="n">zero_tad</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="n">zero_tad</span><span class="p">)</span>
        <span class="n">xyz</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">zero_tad</span>
        <span class="n">gdb</span><span class="o">.</span><span class="n">write_line</span><span class="p">(</span><span class="n">ln</span><span class="p">,</span> <span class="n">xyz</span><span class="p">,</span> <span class="n">chlist</span><span class="p">,</span> <span class="n">fid</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">return_as</span> <span class="o">==</span> <span class="n">RETURN_GDB</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">gdb</span>

    <span class="n">pplist</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">ln</span> <span class="ow">in</span> <span class="n">gdb</span><span class="o">.</span><span class="n">list_lines</span><span class="p">():</span>
        <span class="n">xyz</span> <span class="o">=</span> <span class="n">gdb</span><span class="o">.</span><span class="n">read_line</span><span class="p">(</span><span class="n">ln</span><span class="p">,</span> <span class="n">channels</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="s1">&#39;Z&#39;</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">pplist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gxgeo</span><span class="o">.</span><span class="n">PPoint</span><span class="p">(</span><span class="n">xyz</span><span class="p">,</span> <span class="n">coordinate_system</span><span class="o">=</span><span class="n">gdb</span><span class="o">.</span><span class="n">coordinate_system</span><span class="p">))</span>

    <span class="n">gdb</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">discard</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">return_as</span> <span class="o">==</span> <span class="n">RETURN_LIST_OF_PPOINT</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">pplist</span>

    <span class="k">return</span> <span class="n">gxgeo</span><span class="o">.</span><span class="n">PPoint</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">pplist</span><span class="p">)</span></div>


<div class="viewcode-block" id="sample"><a class="viewcode-back" href="../../../geosoft.gxpy.grid_utility.html#geosoft.gxpy.grid_utility.sample">[docs]</a><span class="k">def</span> <span class="nf">sample</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">xyz</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return grid values sampled at the point locations.</span>

<span class="sd">    :param grid:    `geosoft.gxpy.grid.Grid` instance or a grid file name.</span>
<span class="sd">    :param xyz:     `geosoft.gxpy.geometry.PPoint` instance, or a numpy array shapped (-1, 3) that holds</span>
<span class="sd">                    the desired (x, y, z) locations. If a PPoint instance is passed it will be reporjected to the</span>
<span class="sd">                    grid coordinate system if necessary.</span>
<span class="sd">    :return:        1-dimensional numpy array of grid data values that match the passes PPoint or XYZ.</span>

<span class="sd">    .. note:: Sampled data values use linear interpolation between grid points.</span>

<span class="sd">    .. versionadded:: 9.1</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">gxgrd</span><span class="o">.</span><span class="n">Grid</span><span class="p">):</span>
        <span class="n">grid</span> <span class="o">=</span> <span class="n">gxgrd</span><span class="o">.</span><span class="n">Grid</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">xyz</span><span class="p">,</span> <span class="n">gxgeo</span><span class="o">.</span><span class="n">Geometry</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">xyz</span><span class="o">.</span><span class="n">coordinate_system</span> <span class="o">!=</span> <span class="n">grid</span><span class="o">.</span><span class="n">coordinate_system</span><span class="p">:</span>
            <span class="n">xyz</span> <span class="o">=</span> <span class="n">gxgeo</span><span class="o">.</span><span class="n">PPoint</span><span class="p">(</span><span class="n">xyz</span><span class="p">,</span> <span class="n">coordinate_system</span><span class="o">=</span><span class="n">grid</span><span class="o">.</span><span class="n">coordinate_system</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">xyz</span><span class="o">.</span><span class="n">coordinate_system</span><span class="o">.</span><span class="n">is_oriented</span><span class="p">:</span>
            <span class="n">xyz</span> <span class="o">=</span> <span class="n">xyz</span><span class="o">.</span><span class="n">coordinate_system</span><span class="o">.</span><span class="n">oriented_from_xyz</span><span class="p">(</span><span class="n">xyz</span><span class="p">)</span>
        <span class="n">xyz</span> <span class="o">=</span> <span class="n">xyz</span><span class="o">.</span><span class="n">pp</span>

    <span class="n">vvx</span><span class="p">,</span> <span class="n">vvy</span><span class="p">,</span> <span class="n">vvz</span> <span class="o">=</span> <span class="n">gxvv</span><span class="o">.</span><span class="n">vvset_from_np</span><span class="p">(</span><span class="n">xyz</span><span class="p">)</span>
    <span class="n">gxapi</span><span class="o">.</span><span class="n">GXIMU</span><span class="o">.</span><span class="n">get_zvv</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">gximg</span><span class="p">,</span> <span class="n">vvx</span><span class="o">.</span><span class="n">gxvv</span><span class="p">,</span> <span class="n">vvy</span><span class="o">.</span><span class="n">gxvv</span><span class="p">,</span> <span class="n">vvz</span><span class="o">.</span><span class="n">gxvv</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">vvz</span><span class="o">.</span><span class="n">np</span></div>


<div class="viewcode-block" id="grid_mosaic"><a class="viewcode-back" href="../../../geosoft.gxpy.grid_utility.html#geosoft.gxpy.grid_utility.grid_mosaic">[docs]</a><span class="k">def</span> <span class="nf">grid_mosaic</span><span class="p">(</span><span class="n">mosaic</span><span class="p">,</span> <span class="n">grid_list</span><span class="p">,</span> <span class="n">type_decorate</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Combine a set of grids into a single grid.  Raises an error if the resulting grid is too large.</span>

<span class="sd">    :param mosaic:          name of the output grid, returned.  Decorate with &#39;(HGD)&#39; to get an HGD</span>
<span class="sd">    :param grid_list:       list of input grid names</span>
<span class="sd">    :param type_decorate:   decoration for input grids if not default</span>
<span class="sd">    :returns:               `geosoft.gxpy.grid.Grid` instance</span>

<span class="sd">    .. note:: If the coordinate systems are different the grids are</span>
<span class="sd">        reprojected to the coordinate system of the first grid.</span>

<span class="sd">    .. versionadded:: 9.4</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">props</span><span class="p">(</span><span class="n">gn</span><span class="p">,</span> <span class="n">repro</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">gxgrd</span><span class="o">.</span><span class="n">Grid</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">gn</span><span class="p">)</span> <span class="k">as</span> <span class="n">gg</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">repro</span><span class="p">:</span>
                <span class="n">gg</span><span class="o">.</span><span class="n">gximg</span><span class="o">.</span><span class="n">create_projected2</span><span class="p">(</span><span class="n">repro</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">repro</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">gg</span><span class="o">.</span><span class="n">properties</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">dimension</span><span class="p">(</span><span class="n">glist</span><span class="p">):</span>

        <span class="k">def</span> <span class="nf">dimg</span><span class="p">(</span><span class="n">_gd</span><span class="p">,</span> <span class="n">_rep</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
            <span class="n">prp</span> <span class="o">=</span> <span class="n">props</span><span class="p">(</span><span class="n">_gd</span><span class="p">,</span> <span class="n">_rep</span><span class="p">)</span>
            <span class="n">_x0</span> <span class="o">=</span> <span class="n">prp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;x0&#39;</span><span class="p">)</span>
            <span class="n">_y0</span> <span class="o">=</span> <span class="n">prp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;y0&#39;</span><span class="p">)</span>
            <span class="n">_xm</span> <span class="o">=</span> <span class="n">_x0</span> <span class="o">+</span> <span class="p">(</span><span class="n">prp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;nx&#39;</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">prp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;dx&#39;</span><span class="p">)</span>
            <span class="n">_ym</span> <span class="o">=</span> <span class="n">_y0</span> <span class="o">+</span> <span class="p">(</span><span class="n">prp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ny&#39;</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">prp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;dy&#39;</span><span class="p">)</span>
            <span class="n">_ipj</span> <span class="o">=</span> <span class="n">prp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;coordinate_system&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">gxipj</span>
            <span class="n">cell</span> <span class="o">=</span> <span class="n">prp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;dx&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">_x0</span><span class="p">,</span> <span class="n">_y0</span><span class="p">,</span> <span class="n">_xm</span><span class="p">,</span> <span class="n">_ym</span><span class="p">,</span> <span class="p">(</span><span class="n">_ipj</span><span class="p">,</span> <span class="n">cell</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">ndim</span><span class="p">(</span><span class="n">_x0</span><span class="p">,</span> <span class="n">_xm</span><span class="p">,</span> <span class="n">_dx</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">int</span><span class="p">((</span><span class="n">_xm</span> <span class="o">-</span> <span class="n">_x0</span> <span class="o">+</span> <span class="n">_dx</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)</span> <span class="o">/</span> <span class="n">_dx</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="n">dx0</span><span class="p">,</span> <span class="n">dy0</span><span class="p">,</span> <span class="n">dxm</span><span class="p">,</span> <span class="n">dym</span><span class="p">,</span> <span class="n">drepro</span> <span class="o">=</span> <span class="n">dimg</span><span class="p">(</span><span class="n">glist</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">gd</span> <span class="ow">in</span> <span class="n">glist</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="n">xx0</span><span class="p">,</span> <span class="n">yy0</span><span class="p">,</span> <span class="n">xxm</span><span class="p">,</span> <span class="n">yym</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="n">dimg</span><span class="p">(</span><span class="n">gd</span><span class="p">,</span> <span class="n">drepro</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">xx0</span> <span class="o">&lt;</span> <span class="n">dx0</span><span class="p">:</span>
                <span class="n">dx0</span> <span class="o">=</span> <span class="n">xx0</span>
            <span class="k">if</span> <span class="n">yy0</span> <span class="o">&lt;</span> <span class="n">dy0</span><span class="p">:</span>
                <span class="n">dy0</span> <span class="o">=</span> <span class="n">yy0</span>
            <span class="k">if</span> <span class="n">xxm</span> <span class="o">&gt;</span> <span class="n">dxm</span><span class="p">:</span>
                <span class="n">dxm</span> <span class="o">=</span> <span class="n">xxm</span>
            <span class="k">if</span> <span class="n">yym</span> <span class="o">&gt;</span> <span class="n">dym</span><span class="p">:</span>
                <span class="n">dym</span> <span class="o">=</span> <span class="n">yym</span>

        <span class="c1"># calculate new grid dimension</span>
        <span class="n">_p</span> <span class="o">=</span> <span class="n">props</span><span class="p">(</span><span class="n">glist</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">nnx</span> <span class="o">=</span> <span class="n">ndim</span><span class="p">(</span><span class="n">dx0</span><span class="p">,</span> <span class="n">dxm</span><span class="p">,</span> <span class="n">_p</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;dx&#39;</span><span class="p">))</span>
        <span class="n">nny</span> <span class="o">=</span> <span class="n">ndim</span><span class="p">(</span><span class="n">dy0</span><span class="p">,</span> <span class="n">dym</span><span class="p">,</span> <span class="n">_p</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;dy&#39;</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">dx0</span><span class="p">,</span> <span class="n">dy0</span><span class="p">,</span> <span class="n">nnx</span><span class="p">,</span> <span class="n">nny</span><span class="p">,</span> <span class="n">dxm</span><span class="p">,</span> <span class="n">dym</span>

    <span class="k">def</span> <span class="nf">locate</span><span class="p">(</span><span class="n">_x0</span><span class="p">,</span> <span class="n">_y0</span><span class="p">,</span> <span class="n">_p</span><span class="p">):</span>

        <span class="n">_dx</span> <span class="o">=</span> <span class="n">_p</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;dx&#39;</span><span class="p">)</span>
        <span class="n">_dy</span> <span class="o">=</span> <span class="n">_p</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;dy&#39;</span><span class="p">)</span>
        <span class="n">dsx</span> <span class="o">=</span> <span class="nb">round</span><span class="p">((</span><span class="n">p</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;x0&#39;</span><span class="p">)</span> <span class="o">-</span> <span class="n">_x0</span><span class="p">)</span> <span class="o">/</span> <span class="n">_dx</span><span class="p">)</span>
        <span class="n">dsy</span> <span class="o">=</span> <span class="nb">round</span><span class="p">((</span><span class="n">p</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;y0&#39;</span><span class="p">)</span> <span class="o">-</span> <span class="n">_y0</span><span class="p">)</span> <span class="o">/</span> <span class="n">_dy</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">dsx</span><span class="p">,</span> <span class="n">dsy</span>

    <span class="k">def</span> <span class="nf">paste</span><span class="p">(</span><span class="n">gn</span><span class="p">,</span> <span class="n">_mpg</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">gxgrd</span><span class="o">.</span><span class="n">Grid</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">gn</span><span class="p">)</span> <span class="k">as</span> <span class="n">_g</span><span class="p">:</span>
            <span class="n">_p</span> <span class="o">=</span> <span class="n">_g</span><span class="o">.</span><span class="n">properties</span><span class="p">()</span>
            <span class="n">_nx</span> <span class="o">=</span> <span class="n">_p</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;nx&#39;</span><span class="p">)</span>
            <span class="n">_ny</span> <span class="o">=</span> <span class="n">_p</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ny&#39;</span><span class="p">)</span>
            <span class="n">gpg</span> <span class="o">=</span> <span class="n">_g</span><span class="o">.</span><span class="n">gxpg</span><span class="p">()</span>
            <span class="n">destx</span><span class="p">,</span> <span class="n">desty</span> <span class="o">=</span> <span class="n">locate</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">_p</span><span class="p">)</span>
            <span class="n">gxc</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;    +</span><span class="si">{}</span><span class="s1"> nx,ny(</span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">_g</span><span class="p">,</span> <span class="n">_nx</span><span class="p">,</span> <span class="n">_ny</span><span class="p">))</span>
            <span class="n">gxc</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;     Copy (</span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="s1">) -&gt; (</span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="s1">) of (</span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">_nx</span><span class="p">,</span> <span class="n">_ny</span><span class="p">,</span> <span class="n">destx</span><span class="p">,</span> <span class="n">desty</span><span class="p">,</span> <span class="n">mnx</span><span class="p">,</span> <span class="n">mny</span><span class="p">))</span>
            <span class="n">_mpg</span><span class="o">.</span><span class="n">copy_subset</span><span class="p">(</span><span class="n">gpg</span><span class="p">,</span> <span class="n">desty</span><span class="p">,</span> <span class="n">destx</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">_ny</span><span class="p">,</span> <span class="n">_nx</span><span class="p">)</span>
            <span class="k">return</span>

    <span class="n">gxc</span> <span class="o">=</span> <span class="n">gx</span><span class="o">.</span><span class="n">gx</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">grid_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">GridUtilityException</span><span class="p">(</span><span class="n">_t</span><span class="p">(</span><span class="s1">&#39;At least one grid is required&#39;</span><span class="p">))</span>

    <span class="c1"># create list of grids, all matching on coordinate system of first grid</span>
    <span class="n">grids</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">grid_list</span><span class="p">)):</span>
        <span class="n">grids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gxgrd</span><span class="o">.</span><span class="n">decorate_name</span><span class="p">(</span><span class="n">grid_list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">type_decorate</span><span class="p">))</span>

    <span class="c1"># output grid</span>
    <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">nx</span><span class="p">,</span> <span class="n">ny</span><span class="p">,</span> <span class="n">xm</span><span class="p">,</span> <span class="n">ym</span> <span class="o">=</span> <span class="n">dimension</span><span class="p">(</span><span class="n">grids</span><span class="p">)</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">props</span><span class="p">(</span><span class="n">grids</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">p</span><span class="p">[</span><span class="s1">&#39;x0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">x0</span>
    <span class="n">p</span><span class="p">[</span><span class="s1">&#39;y0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">y0</span>
    <span class="n">p</span><span class="p">[</span><span class="s1">&#39;nx&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nx</span>
    <span class="n">p</span><span class="p">[</span><span class="s1">&#39;ny&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ny</span>
    <span class="n">gxc</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">gxc</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;Mosaic: dim(</span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="s1">) x(</span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="s1">) y(</span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="s1">), cell(</span><span class="si">{}</span><span class="s1">)...&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span> <span class="n">ny</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">xm</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">ym</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;dx&#39;</span><span class="p">)))</span>
    <span class="n">master</span> <span class="o">=</span> <span class="n">gxgrd</span><span class="o">.</span><span class="n">Grid</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">mosaic</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
    <span class="n">gxc</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;Memory image ready (</span><span class="si">{}</span><span class="s1">) dim(</span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="s1">) x0,y0(</span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span>
            <span class="nb">format</span><span class="p">(</span><span class="n">master</span><span class="p">,</span> <span class="n">master</span><span class="o">.</span><span class="n">nx</span><span class="p">,</span> <span class="n">master</span><span class="o">.</span><span class="n">ny</span><span class="p">,</span> <span class="n">master</span><span class="o">.</span><span class="n">x0</span><span class="p">,</span> <span class="n">master</span><span class="o">.</span><span class="n">y0</span><span class="p">))</span>

    <span class="c1"># paste grids onto master</span>
    <span class="n">mnx</span> <span class="o">=</span> <span class="n">master</span><span class="o">.</span><span class="n">nx</span>
    <span class="n">mny</span> <span class="o">=</span> <span class="n">master</span><span class="o">.</span><span class="n">ny</span>
    <span class="n">mpg</span> <span class="o">=</span> <span class="n">master</span><span class="o">.</span><span class="n">gxpg</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">grids</span><span class="p">:</span>
        <span class="n">paste</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">mpg</span><span class="p">)</span>

    <span class="n">gxc</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;Mosaic completed: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mosaic</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">master</span></div>


<div class="viewcode-block" id="grid_bool"><a class="viewcode-back" href="../../../geosoft.gxpy.grid_utility.html#geosoft.gxpy.grid_utility.grid_bool">[docs]</a><span class="k">def</span> <span class="nf">grid_bool</span><span class="p">(</span><span class="n">g1</span><span class="p">,</span> <span class="n">g2</span><span class="p">,</span> <span class="n">joined_grid</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">opt</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">olap</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Combine two grids into a single grid, with boolean logic to determine the result.</span>

<span class="sd">    :param g1:          Grids to merge</span>
<span class="sd">    :param g2:</span>
<span class="sd">    :param joined_grid: joined output grid name, overwritten if it exists. Default makes a temporary grid.</span>
<span class="sd">    :param opt:         option logic to determine output grid points:</span>

<span class="sd">        =============== =========================</span>
<span class="sd">        BOOL_AND        blank unless g1 and g2</span>
<span class="sd">        BOOL_OR         blank unless g1 or g2</span>
<span class="sd">        BOOL_XOR        blank where g1 and g2</span>
<span class="sd">        =============== =========================</span>

<span class="sd">    :param size:    size of the output grid, default is minimum size</span>

<span class="sd">        =============== =======================================</span>
<span class="sd">        BOOL_SIZE_GRID1 output size matches g1</span>
<span class="sd">        BOOL_SIZE_GRID2 output size matches g2</span>
<span class="sd">        BOOL_SIZE_MIN   output size minimised to non-blank area</span>
<span class="sd">        BOOL_SIZE_MAX   output size g1 + g2:</span>
<span class="sd">        =============== =======================================</span>

<span class="sd">    :param olap:    what to do with overlapping valid points, default uses grid 1</span>

<span class="sd">        ==================== ==================================</span>
<span class="sd">        BOOL_OVERLAP_AVERAGE averave values where grids overlap</span>
<span class="sd">        BOOL_OVERLAP_GRID1   use g1 where grids overlap</span>
<span class="sd">        BOOL_OVERLAP_GRID2   use g2 where grids overlap</span>
<span class="sd">        ==================== ==================================</span>

<span class="sd">    :returns:       `Grid` instance of the merged output grid, must be closed with a call to close().</span>

<span class="sd">    .. note:: If the grid coordinate systems differ, g2 is reprojected to the</span>
<span class="sd">        coordinate system og g1.</span>

<span class="sd">    .. versionadded:: 9.4</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">close_g1</span> <span class="o">=</span> <span class="n">close_g2</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">g1</span><span class="p">,</span> <span class="n">gxgrd</span><span class="o">.</span><span class="n">Grid</span><span class="p">):</span>
        <span class="n">g1</span> <span class="o">=</span> <span class="n">gxgrd</span><span class="o">.</span><span class="n">Grid</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">g1</span><span class="p">)</span>
        <span class="n">close_g1</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">g2</span><span class="p">,</span> <span class="n">gxgrd</span><span class="o">.</span><span class="n">Grid</span><span class="p">):</span>
        <span class="n">g2</span> <span class="o">=</span> <span class="n">gxgrd</span><span class="o">.</span><span class="n">Grid</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">g2</span><span class="p">)</span>
        <span class="n">close_g2</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">if</span> <span class="n">joined_grid</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">joined_grid</span> <span class="o">=</span> <span class="n">gx</span><span class="o">.</span><span class="n">gx</span><span class="p">()</span><span class="o">.</span><span class="n">temp_file</span><span class="p">(</span><span class="s1">&#39;.grd(GRD)&#39;</span><span class="p">)</span>

    <span class="n">gxapi</span><span class="o">.</span><span class="n">GXIMU</span><span class="o">.</span><span class="n">grid_bool</span><span class="p">(</span><span class="n">g1</span><span class="o">.</span><span class="n">gximg</span><span class="p">,</span> <span class="n">g2</span><span class="o">.</span><span class="n">gximg</span><span class="p">,</span> <span class="n">joined_grid</span><span class="p">,</span> <span class="n">opt</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">olap</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">close_g1</span><span class="p">:</span>
        <span class="n">g1</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">close_g2</span><span class="p">:</span>
        <span class="n">g2</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">gxgrd</span><span class="o">.</span><span class="n">Grid</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">joined_grid</span><span class="p">)</span></div>


<div class="viewcode-block" id="contour_points"><a class="viewcode-back" href="../../../geosoft.gxpy.grid_utility.html#geosoft.gxpy.grid_utility.contour_points">[docs]</a><span class="k">def</span> <span class="nf">contour_points</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">max_segments</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                   <span class="n">return_as</span><span class="o">=</span><span class="n">RETURN_LIST_OF_PPOINT</span><span class="p">,</span> <span class="n">gdb</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return a set of point segments that represent the spatial locations of contours threaded through the grid.</span>

<span class="sd">    :param grid:            grid file of `geosoft.gxpy.grid.Grid` instance</span>
<span class="sd">    :param value:           contour value</span>
<span class="sd">    :param max_segments:    maximum expected number of segments, raises error if there are more actual segments.</span>
<span class="sd">    :param resolution:      the separation between points along the contours. If not specified the minimum</span>
<span class="sd">                            grid cell size is used.  Set `resolution=0`, for use the locations as returned by the</span>
<span class="sd">                            contouring algorithm.</span>
<span class="sd">    :param return_as:       return results as:</span>

<span class="sd">        ===================== ====================================================================</span>
<span class="sd">        RETURN_PPOINT         return results as a single `geosoft.gxpy.geometry.PPoint` instance</span>
<span class="sd">        RETURN_LIST_OF_PPOINT return results as a list of `geosoft.gxpy.geometry.PPoint` instances</span>
<span class="sd">        RETURN_GDB            return result as a `geosoft.gxpy.gdb.Geosoft_gdb` instance</span>
<span class="sd">        ===================== ====================================================================</span>

<span class="sd">    :param gdb:         return database name, or a `geosoft.gxpy.gdv.Geosoft_database` instance. If not</span>
<span class="sd">                        specified and `return_as=RETURN_GDB`, a temporary database is created.</span>
<span class="sd">    :param overwrite:   `True` to overwrite gdb if it exists.</span>
<span class="sd">    :return:            depends on `return_as` setting</span>

<span class="sd">    .. note::   Contours through 3D oriented grids will be oriented in 3D. Grids that are not 3D oriented</span>
<span class="sd">        will have a z value 0.0.</span>

<span class="sd">    .. versionadded:: 9.4</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">gxgrd</span><span class="o">.</span><span class="n">Grid</span><span class="p">):</span>
        <span class="n">extent</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">extent</span>
        <span class="k">with</span> <span class="n">grid</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span> <span class="k">as</span> <span class="n">g</span><span class="p">:</span>
            <span class="n">temp_grid</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">file_name</span>
            <span class="n">grid</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">file_name_decorated</span>
            <span class="k">if</span> <span class="n">resolution</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">resolution</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">dx</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="n">dy</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">gxgrd</span><span class="o">.</span><span class="n">Grid</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span> <span class="k">as</span> <span class="n">g</span><span class="p">:</span>
            <span class="n">extent</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">extent</span>
            <span class="k">if</span> <span class="n">resolution</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">resolution</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">dx</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="n">dy</span><span class="p">)</span>
        <span class="n">temp_grid</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># create a contour group for this value, export to a shape file</span>
    <span class="k">with</span> <span class="n">gxmap</span><span class="o">.</span><span class="n">Map</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">data_area</span><span class="o">=</span><span class="n">extent</span><span class="o">.</span><span class="n">extent_xy</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">gmap</span><span class="p">:</span>
        <span class="n">map_file</span> <span class="o">=</span> <span class="n">gmap</span><span class="o">.</span><span class="n">file_name</span>
        <span class="k">with</span> <span class="n">gxv</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">gmap</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">v</span><span class="p">:</span>
            <span class="n">gxgrp</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="n">grid</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;,0,0&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span>
                                                    <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,,,0&#39;</span><span class="p">))</span>
        <span class="n">shp_file</span> <span class="o">=</span> <span class="n">gx</span><span class="o">.</span><span class="n">gx</span><span class="p">()</span><span class="o">.</span><span class="n">temp_file</span><span class="p">(</span><span class="s1">&#39;shp&#39;</span><span class="p">)</span>
        <span class="n">gmap</span><span class="o">.</span><span class="n">gxmap</span><span class="o">.</span><span class="n">export_all_in_view</span><span class="p">(</span><span class="n">shp_file</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span>
                                      <span class="n">gxapi</span><span class="o">.</span><span class="n">MAP_EXPORT_BITS_24</span><span class="p">,</span>
                                      <span class="n">gxapi</span><span class="o">.</span><span class="n">MAP_EXPORT_METHOD_STANDARD</span><span class="p">,</span>
                                      <span class="n">gxapi</span><span class="o">.</span><span class="n">MAP_EXPORT_FORMAT_SHP</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">shp_file</span> <span class="o">=</span> <span class="n">shp_file</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;_lnz.shp&#39;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">shp_file</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">GridUtilityException</span><span class="p">(</span><span class="n">_t</span><span class="p">(</span><span class="s1">&#39;The grid data does not intersect value </span><span class="si">{}</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">gdb</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">return_as</span> <span class="o">=</span> <span class="n">RETURN_GDB</span>

    <span class="c1"># import shape to database</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gdb</span><span class="p">,</span> <span class="n">gxgdb</span><span class="o">.</span><span class="n">Geosoft_gdb</span><span class="p">):</span>
        <span class="n">gdb</span> <span class="o">=</span> <span class="n">gxgdb</span><span class="o">.</span><span class="n">Geosoft_gdb</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">gdb</span><span class="p">,</span> <span class="n">max_lines</span><span class="o">=</span><span class="n">max_segments</span><span class="p">,</span> <span class="n">max_channels</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="n">overwrite</span><span class="p">)</span>

    <span class="n">gis</span> <span class="o">=</span> <span class="n">gxapi</span><span class="o">.</span><span class="n">GXGIS</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">shp_file</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">gxapi</span><span class="o">.</span><span class="n">GIS_TYPE_ARCVIEW</span><span class="p">)</span>
    <span class="n">gis</span><span class="o">.</span><span class="n">load_shapes_gdb</span><span class="p">(</span><span class="n">gdb</span><span class="o">.</span><span class="n">gxdb</span><span class="p">)</span>
    <span class="n">gdb</span><span class="o">.</span><span class="n">coordinate_system</span> <span class="o">=</span> <span class="n">extent</span><span class="o">.</span><span class="n">coordinate_system</span>

    <span class="c1"># discard the temp files</span>
    <span class="n">gxu</span><span class="o">.</span><span class="n">delete_files_by_root</span><span class="p">(</span><span class="n">temp_grid</span><span class="p">)</span>
    <span class="n">gxu</span><span class="o">.</span><span class="n">delete_files_by_root</span><span class="p">(</span><span class="n">map_file</span><span class="p">)</span>
    <span class="n">gxu</span><span class="o">.</span><span class="n">delete_files_by_root</span><span class="p">(</span><span class="n">shp_file</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">])</span>

    <span class="c1"># resample to resolution</span>
    <span class="k">if</span> <span class="n">resolution</span> <span class="o">&gt;</span> <span class="mf">0.</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">ln</span> <span class="ow">in</span> <span class="n">gdb</span><span class="o">.</span><span class="n">list_lines</span><span class="p">():</span>
            <span class="n">xyz</span><span class="p">,</span> <span class="n">chlist</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">gdb</span><span class="o">.</span><span class="n">read_line</span><span class="p">(</span><span class="n">ln</span><span class="p">,</span> <span class="n">channels</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="s1">&#39;Z&#39;</span><span class="p">))</span>
            <span class="n">xyz</span> <span class="o">=</span> <span class="n">gxgeou</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">xyz</span><span class="p">,</span> <span class="n">resolution</span><span class="p">)</span>
            <span class="n">gdb</span><span class="o">.</span><span class="n">write_line</span><span class="p">(</span><span class="n">ln</span><span class="p">,</span> <span class="n">xyz</span><span class="p">,</span> <span class="n">chlist</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">return_as</span> <span class="o">==</span> <span class="n">RETURN_GDB</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">gdb</span>

    <span class="c1"># make points from segments</span>
    <span class="n">pplist</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">ln</span> <span class="ow">in</span> <span class="n">gdb</span><span class="o">.</span><span class="n">list_lines</span><span class="p">():</span>
        <span class="n">xyz</span> <span class="o">=</span> <span class="n">gdb</span><span class="o">.</span><span class="n">read_line</span><span class="p">(</span><span class="n">ln</span><span class="p">,</span> <span class="n">channels</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="s1">&#39;Z&#39;</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">xyz</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="k">if</span> <span class="n">resolution</span> <span class="o">&gt;</span> <span class="mf">0.</span><span class="p">:</span>
            <span class="n">xyz</span> <span class="o">=</span> <span class="n">gxgeou</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">xyz</span><span class="p">,</span> <span class="n">resolution</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">extent</span><span class="o">.</span><span class="n">coordinate_system</span><span class="o">.</span><span class="n">is_oriented</span><span class="p">:</span>
            <span class="n">xyz</span> <span class="o">=</span> <span class="n">extent</span><span class="o">.</span><span class="n">coordinate_system</span><span class="o">.</span><span class="n">xyz_from_oriented</span><span class="p">(</span><span class="n">xyz</span><span class="p">)</span>
        <span class="n">pplist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gxgeo</span><span class="o">.</span><span class="n">PPoint</span><span class="p">(</span><span class="n">xyz</span><span class="p">,</span> <span class="n">coordinate_system</span><span class="o">=</span><span class="n">extent</span><span class="o">.</span><span class="n">coordinate_system</span><span class="p">))</span>

    <span class="c1"># discard the database</span>
    <span class="n">gdb</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">discard</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">return_as</span> <span class="o">==</span> <span class="n">RETURN_PPOINT</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">gxgeo</span><span class="o">.</span><span class="n">PPoint</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">pplist</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">pplist</span></div>


<div class="viewcode-block" id="calculate_slope_standard_deviation"><a class="viewcode-back" href="../../../geosoft.gxpy.grid_utility.html#geosoft.gxpy.grid_utility.calculate_slope_standard_deviation">[docs]</a><span class="k">def</span> <span class="nf">calculate_slope_standard_deviation</span><span class="p">(</span><span class="n">grid</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the standard deviation of the slopes.</span>

<span class="sd">    :param grid: `geosoft.gxpy.grid.Grid` instance, or a grid file name</span>
<span class="sd">    :returns:    Standard deviation of grid slopes</span>

<span class="sd">    .. Note:: This method calculates the standard deviation of the horizontal</span>
<span class="sd">        differences in the X and Y directions for the supplied</span>
<span class="sd">        image.  This is useful for shading routines.  A good</span>
<span class="sd">        default scaling factor is 2.5 / standard deviation.</span>

<span class="sd">        The image will be sub-sampled to a statistically meaningful number.</span>

<span class="sd">        The cell sizes are used to determine the slopes.</span>

<span class="sd">    .. versionadded:: 9.4</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">close_g</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">gxgrd</span><span class="o">.</span><span class="n">Grid</span><span class="p">):</span>
        <span class="n">grid</span> <span class="o">=</span> <span class="n">gxgrd</span><span class="o">.</span><span class="n">Grid</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span>
        <span class="n">close_g</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">gxapi</span><span class="o">.</span><span class="n">GXIMU</span><span class="o">.</span><span class="n">slope_standard_deviation</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">gximg</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">close_g</span><span class="p">:</span>
            <span class="n">grid</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>


<div class="viewcode-block" id="flood"><a class="viewcode-back" href="../../../geosoft.gxpy.grid_utility.html#geosoft.gxpy.grid_utility.flood">[docs]</a><span class="k">def</span> <span class="nf">flood</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">tolerance</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_iterations</span><span class="o">=</span><span class="mi">250</span><span class="p">,</span> <span class="n">pass_tol</span><span class="o">=</span><span class="mf">99.</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Flood blank areas in a grid based on a minimum-curvature surface.</span>

<span class="sd">    :param grid:            `geosoft.gxpy.grid.Grid` instance, or a grid file name</span>
<span class="sd">    :param file_name:       flooded grid file name, temporary created if `None`.</span>
<span class="sd">    :param overwrite:       `True` to overwrite existing file</span>
<span class="sd">    :param tolerance:       data fit tolerance, default is 0.001 times the data standard deviation</span>
<span class="sd">    :param max_iterations:  maximum iterations for fiting the surface</span>
<span class="sd">    :param pass_tol:        percentage of data that needs to pass the tolerance test when definint</span>
<span class="sd">                            the minimum-curfacture surface. The default is 99%.</span>
<span class="sd">    :return:                `geosoft.gxpy.grid.Grid` instance of a flooded grid.</span>

<span class="sd">    .. seealso:: `geosoft.gxpy.grid.Grid.minimum_curvature`</span>

<span class="sd">    .. versionadded:: 9.4</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">pg_rows</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;=</span> <span class="n">grid</span><span class="o">.</span><span class="n">ny</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">pg</span><span class="o">.</span><span class="n">read_row</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">rvv</span><span class="o">.</span><span class="n">gxvv</span><span class="p">)</span>
        <span class="n">xyv</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">n</span>
        <span class="n">xyv</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">rvv</span><span class="o">.</span><span class="n">np</span>
        <span class="k">return</span> <span class="n">xyv</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">gxgrd</span><span class="o">.</span><span class="n">Grid</span><span class="p">):</span>
        <span class="n">grid</span> <span class="o">=</span> <span class="n">gxgrd</span><span class="o">.</span><span class="n">Grid</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span>

    <span class="n">pg</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">gxpg</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">rvv</span> <span class="o">=</span> <span class="n">gxvv</span><span class="o">.</span><span class="n">GXvv</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="n">grid</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
    <span class="n">rvv</span><span class="o">.</span><span class="n">length</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">nx</span>
    <span class="n">xyv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">grid</span><span class="o">.</span><span class="n">nx</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
    <span class="n">xyv</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">nx</span><span class="p">)]</span>
    <span class="n">bkd</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">nx</span><span class="p">,</span> <span class="n">grid</span><span class="o">.</span><span class="n">ny</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">tolerance</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">tolerance</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">statistics</span><span class="p">()[</span><span class="s1">&#39;sd&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.001</span>
    <span class="n">filled_grid</span> <span class="o">=</span> <span class="n">gxgrd</span><span class="o">.</span><span class="n">Grid</span><span class="o">.</span><span class="n">minimum_curvature</span><span class="p">(</span><span class="n">pg_rows</span><span class="p">,</span>
                                               <span class="n">file_name</span><span class="o">=</span><span class="n">file_name</span><span class="p">,</span>
                                               <span class="n">overwrite</span><span class="o">=</span><span class="n">overwrite</span><span class="p">,</span>
                                               <span class="n">cs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                               <span class="n">area</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">grid</span><span class="o">.</span><span class="n">nx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">grid</span><span class="o">.</span><span class="n">ny</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span>
                                               <span class="n">bkd</span><span class="o">=</span><span class="n">bkd</span><span class="p">,</span>
                                               <span class="n">itrmax</span><span class="o">=</span><span class="n">max_iterations</span><span class="p">,</span>
                                               <span class="n">pastol</span><span class="o">=</span><span class="n">pass_tol</span><span class="p">,</span>
                                               <span class="n">tol</span><span class="o">=</span><span class="n">tolerance</span><span class="p">,</span>
                                               <span class="n">icgr</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>
                                               <span class="n">max_segments</span><span class="o">=</span><span class="n">grid</span><span class="o">.</span><span class="n">ny</span><span class="p">)</span>
    <span class="n">filled_grid</span><span class="o">.</span><span class="n">set_properties</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">properties</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">filled_grid</span></div>


<div class="viewcode-block" id="feather"><a class="viewcode-back" href="../../../geosoft.gxpy.grid_utility.html#geosoft.gxpy.grid_utility.feather">[docs]</a><span class="k">def</span> <span class="nf">feather</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">edge_value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Feather the edge of a grid to a constant value at the edge.</span>

<span class="sd">    :param grid:        `geosoft.gxpy.grid.Grid` instance, or a file name</span>
<span class="sd">    :param file_name:   feathered grid file name, temporary created if `None`.</span>
<span class="sd">    :param overwrite:   `True` to overwrite existing file</span>
<span class="sd">    :param width:       feather width in cells around the grid, must be &lt;= half the grid dimension</span>
<span class="sd">    :param edge_value:  edge value, default is the data mean</span>
<span class="sd">    :return:            feathered grid `geosoft.gxpy.grid.Grid`</span>

<span class="sd">    .. versionadded:: 9.4</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_feather</span><span class="p">(</span><span class="n">dlen</span><span class="p">,</span> <span class="n">w</span><span class="p">):</span>
        <span class="n">ff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">dlen</span><span class="p">)</span>
        <span class="n">e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="n">w</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">w</span><span class="p">)])</span> <span class="o">*</span> <span class="mf">0.5</span> <span class="o">+</span> <span class="mf">0.5</span>
        <span class="n">ff</span><span class="p">[</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">e</span><span class="p">):]</span> <span class="o">=</span> <span class="n">e</span>
        <span class="n">ff</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">e</span><span class="p">)]</span> <span class="o">=</span> <span class="n">e</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">ff</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">gxgrd</span><span class="o">.</span><span class="n">Grid</span><span class="p">):</span>
        <span class="n">grid</span> <span class="o">=</span> <span class="n">gxgrd</span><span class="o">.</span><span class="n">Grid</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">width</span> <span class="o">&gt;</span> <span class="n">grid</span><span class="o">.</span><span class="n">nx</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">width</span> <span class="o">&gt;</span> <span class="n">grid</span><span class="o">.</span><span class="n">ny</span> <span class="o">//</span> <span class="mi">2</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">GridUtilityException</span><span class="p">(</span><span class="n">_t</span><span class="p">(</span><span class="s1">&#39;Width </span><span class="si">{}</span><span class="s1"> must be less than half the dimension (</span><span class="si">{}</span><span class="s1">, </span><span class="si">{}</span><span class="s1">)&#39;</span><span class="p">)</span>
                                   <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">grid</span><span class="o">.</span><span class="n">nx</span><span class="p">,</span> <span class="n">grid</span><span class="o">.</span><span class="n">ny</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">edge_value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">edge_value</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">statistics</span><span class="p">()[</span><span class="s1">&#39;mean&#39;</span><span class="p">]</span>

    <span class="n">pg</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">gxpg</span><span class="p">()</span>
    <span class="n">pgf</span> <span class="o">=</span> <span class="n">gxapi</span><span class="o">.</span><span class="n">GXPG</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">pg</span><span class="o">.</span><span class="n">n_rows</span><span class="p">(),</span> <span class="n">pg</span><span class="o">.</span><span class="n">n_cols</span><span class="p">(),</span> <span class="n">pg</span><span class="o">.</span><span class="n">e_type</span><span class="p">())</span>
    <span class="n">vv</span> <span class="o">=</span> <span class="n">gxvv</span><span class="o">.</span><span class="n">GXvv</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="n">gxu</span><span class="o">.</span><span class="n">dtype_gx</span><span class="p">(</span><span class="n">pg</span><span class="o">.</span><span class="n">e_type</span><span class="p">()))</span>

    <span class="n">f</span> <span class="o">=</span> <span class="n">_feather</span><span class="p">(</span><span class="n">pg</span><span class="o">.</span><span class="n">n_cols</span><span class="p">(),</span> <span class="n">width</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">pg</span><span class="o">.</span><span class="n">n_rows</span><span class="p">()):</span>
        <span class="n">pg</span><span class="o">.</span><span class="n">read_row</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">vv</span><span class="o">.</span><span class="n">gxvv</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="p">(</span><span class="n">vv</span><span class="o">.</span><span class="n">np</span> <span class="o">-</span> <span class="n">edge_value</span><span class="p">)</span> <span class="o">*</span> <span class="n">f</span> <span class="o">+</span> <span class="n">edge_value</span>
        <span class="n">pgf</span><span class="o">.</span><span class="n">write_row</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">gxvv</span><span class="o">.</span><span class="n">GXvv</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="o">.</span><span class="n">gxvv</span><span class="p">)</span>

    <span class="n">f</span> <span class="o">=</span> <span class="n">_feather</span><span class="p">(</span><span class="n">pg</span><span class="o">.</span><span class="n">n_rows</span><span class="p">(),</span> <span class="n">width</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">pg</span><span class="o">.</span><span class="n">n_cols</span><span class="p">()):</span>
        <span class="n">pgf</span><span class="o">.</span><span class="n">read_col</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">vv</span><span class="o">.</span><span class="n">gxvv</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="p">(</span><span class="n">vv</span><span class="o">.</span><span class="n">np</span> <span class="o">-</span> <span class="n">edge_value</span><span class="p">)</span> <span class="o">*</span> <span class="n">f</span> <span class="o">+</span> <span class="n">edge_value</span>
        <span class="n">pgf</span><span class="o">.</span><span class="n">write_col</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">gxvv</span><span class="o">.</span><span class="n">GXvv</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="o">.</span><span class="n">gxvv</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">gxgrd</span><span class="o">.</span><span class="n">Grid</span><span class="o">.</span><span class="n">from_data_array</span><span class="p">(</span><span class="n">pgf</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="n">file_name</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="n">overwrite</span><span class="p">,</span> <span class="n">properties</span><span class="o">=</span><span class="n">grid</span><span class="o">.</span><span class="n">properties</span><span class="p">())</span></div>


<div class="viewcode-block" id="expression"><a class="viewcode-back" href="../../../geosoft.gxpy.grid_utility.html#geosoft.gxpy.grid_utility.expression">[docs]</a><span class="k">def</span> <span class="nf">expression</span><span class="p">(</span><span class="n">grids</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">result_file_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Apply an expressing to grids.</span>

<span class="sd">    :param grids:       dictionary of named grid operands, or a list of grids (see example below). If a list</span>
<span class="sd">                        is provided the operand names will be &#39;g1&#39;, &#39;g2&#39;, &#39;g3&#39;, etc...</span>
<span class="sd">    :param expr:        expression string to apply, conforms to Python/C math expression syntax. The expression</span>
<span class="sd">                        can have multiple lines, each line terminated by a &#39;;&#39; character.</span>
<span class="sd">    :param result_file_name:    optional result grid file name, if `None` a temporary grid is created.</span>
<span class="sd">    :param overwrite:   True to overwrite existing grid</span>
<span class="sd">    :return:            `Grid` instance that contains the resuilt of the expression.</span>

<span class="sd">    *Example*</span>

<span class="sd">    .. code::</span>

<span class="sd">        import geosoft.gxpy.grid as gxgrd</span>

<span class="sd">        # add using file names</span>
<span class="sd">        sum = gxgrd.expression((&#39;some_grid&#39;, &#39;some_other_grid&#39;), &#39;g1+g2&#39;)</span>

<span class="sd">        # add using Grid instances</span>
<span class="sd">        grid_1 = gxgrd.Grid.open(&#39;some_grid&#39;)</span>
<span class="sd">        grid_2 = gxgrd.Grid.open(&#39;some_other_grid&#39;)</span>
<span class="sd">        sum = gxgrd.expression((grid_1, grid_2), &#39;g1+g2&#39;)</span>

<span class="sd">        # add using named operands</span>
<span class="sd">        sum = gxgrd.expression({&#39;a&#39;: grid_1, &#39;b&#39;: grid_2}, &#39;a+b&#39;)</span>

<span class="sd">    .. versionadded 9.4</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">exp</span> <span class="o">=</span> <span class="n">gxapi</span><span class="o">.</span><span class="n">GXIEXP</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>

    <span class="c1"># build default operands dict from list of grids</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">grids</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">gd</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">grids</span><span class="p">:</span>
            <span class="n">gd</span><span class="p">[</span><span class="s1">&#39;g</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span> <span class="o">=</span> <span class="n">g</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">grids</span> <span class="o">=</span> <span class="n">gd</span>

    <span class="c1"># add grids to the expression</span>
    <span class="n">properties</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">delete_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">grids</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">gxgrd</span><span class="o">.</span><span class="n">Grid</span><span class="p">):</span>
            <span class="n">g</span> <span class="o">=</span> <span class="n">gxgrd</span><span class="o">.</span><span class="n">Grid</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">g</span><span class="o">.</span><span class="n">dtype</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">:</span>
            <span class="n">g</span> <span class="o">=</span> <span class="n">gxgrd</span><span class="o">.</span><span class="n">Grid</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">gx</span><span class="o">.</span><span class="n">gx</span><span class="p">()</span><span class="o">.</span><span class="n">temp_file</span><span class="p">(</span><span class="s1">&#39;.grd(GRD)&#39;</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
            <span class="n">delete_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
        <span class="n">exp</span><span class="o">.</span><span class="n">add_grid</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">gximg</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">properties</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">properties</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">properties</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">result_file_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">result_file_name</span> <span class="o">=</span> <span class="n">gx</span><span class="o">.</span><span class="n">gx</span><span class="p">()</span><span class="o">.</span><span class="n">temp_file</span><span class="p">(</span><span class="s1">&#39;.grd(GRD)&#39;</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">gxgrd</span><span class="o">.</span><span class="n">Grid</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">file_name</span><span class="o">=</span><span class="n">result_file_name</span><span class="p">,</span> <span class="n">properties</span><span class="o">=</span><span class="n">properties</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="n">overwrite</span><span class="p">)</span>
    <span class="n">exp</span><span class="o">.</span><span class="n">add_grid</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">gximg</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">)</span>

    <span class="c1"># apply expression</span>
    <span class="n">expr</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;_=&#39;</span> <span class="o">+</span> <span class="n">expr</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">expr</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;;&#39;</span><span class="p">:</span>
        <span class="n">expr</span> <span class="o">=</span> <span class="n">expr</span> <span class="o">+</span> <span class="s1">&#39;;&#39;</span>
    <span class="n">exp</span><span class="o">.</span><span class="n">do_formula</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

    <span class="c1"># delete temporary grids</span>
    <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">delete_list</span><span class="p">:</span>
        <span class="n">g</span><span class="o">.</span><span class="n">delete_files</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">gxgrd</span><span class="o">.</span><span class="n">reopen</span><span class="p">(</span><span class="n">result</span><span class="p">)</span></div>
</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">Geosoft GX Python API 2022.2.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">geosoft.gxpy.grid_utility</a></li> 
      </ul>
    </div>

    <div class="footer" role="contentinfo">
        &#169; Copyright 2022, Geosoft Inc.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 3.2.1.
    </div>
<div class="footer">This page uses <a href="http://analytics.google.com/">
Google Analytics</a> to collect statistics. You can disable it by blocking
the JavaScript coming from www.google-analytics.com.
<script type="text/javascript">
  (function() {
    var ga = document.createElement('script');
    ga.src = ('https:' == document.location.protocol ?
              'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    ga.setAttribute('async', 'true');
    document.documentElement.firstChild.appendChild(ga);
  })();
</script>
</div>

  </body>
</html>