

<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>geosoft.gxpy.grid &#8212; Geosoft GX Python API 2023.2.0 documentation</title>
    <link rel="stylesheet" href="../../../_static/maki.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
 
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-87443115-1']);
  _gaq.push(['_trackPageview']);
</script>

  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">Geosoft GX Python API 2023.2.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">geosoft.gxpy.grid</a></li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Introduction</a></li>
    <li><a href="../../index.html">Module code</a></li>
</ul>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for geosoft.gxpy.grid</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Geosoft grid and image handling, including all</span>
<span class="sd">`supported file formats &lt;https://geosoftgxdev.atlassian.net/wiki/display/GXDEV92/Grid+File+Name+Decorations&gt;`_ .</span>

<span class="sd">:Classes:</span>
<span class="sd">    :`Grid`: grid dataset</span>

<span class="sd">:Constants:</span>
<span class="sd">   :FILE_READ:       0 open for read, files are not changed</span>
<span class="sd">   :FILE_READWRITE:  1 open for read and write, files can be changed</span>
<span class="sd">   :FILE_NEW:        2 new grid file, accompanied by `overwrite=` parameter</span>

<span class="sd">.. seealso:: :mod:`geosoft.gxpy.grid_utility`, :mod:`geosoft.gxpy.grid_fft`,</span>
<span class="sd">    :class:`geosoft.gxapi.GXIMG`, :class:`geosoft.gxapi.GXIMU`</span>

<span class="sd">.. note::</span>

<span class="sd">    Regression tests provide usage examples:     </span>
<span class="sd">    `Tests &lt;https://github.com/GeosoftInc/gxpy/blob/master/geosoft/gxpy/tests/test_grid.py&gt;`_</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">math</span>

<span class="kn">import</span> <span class="nn">geosoft</span>
<span class="kn">import</span> <span class="nn">geosoft.gxapi</span> <span class="k">as</span> <span class="nn">gxapi</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">gx</span> <span class="k">as</span> <span class="n">gx</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">coordinate_system</span> <span class="k">as</span> <span class="n">gxcs</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">vv</span> <span class="k">as</span> <span class="n">gxvv</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">utility</span> <span class="k">as</span> <span class="n">gxu</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">agg</span> <span class="k">as</span> <span class="n">gxagg</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">geometry</span> <span class="k">as</span> <span class="n">gxgm</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="nb">map</span> <span class="k">as</span> <span class="n">gxmap</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">grid_utility</span> <span class="k">as</span> <span class="n">gxgrdu</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">view</span> <span class="k">as</span> <span class="n">gxview</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">gdb</span> <span class="k">as</span> <span class="n">gxgdb</span>

<span class="n">__version__</span> <span class="o">=</span> <span class="n">geosoft</span><span class="o">.</span><span class="n">__version__</span>


<span class="n">FILE_READ</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">FILE_READWRITE</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">FILE_NEW</span> <span class="o">=</span> <span class="mi">2</span>


<span class="k">def</span> <span class="nf">_t</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">geosoft</span><span class="o">.</span><span class="n">gxpy</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>


<div class="viewcode-block" id="GridException"><a class="viewcode-back" href="../../../geosoft.gxpy.grid.html#geosoft.gxpy.grid.GridException">[docs]</a><span class="k">class</span> <span class="nc">GridException</span><span class="p">(</span><span class="n">geosoft</span><span class="o">.</span><span class="n">GXRuntimeError</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Exceptions from :mod:`geosoft.gxpy.grid`.</span>

<span class="sd">    .. versionadded:: 9.1</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="reopen"><a class="viewcode-back" href="../../../geosoft.gxpy.grid.html#geosoft.gxpy.grid.reopen">[docs]</a><span class="k">def</span> <span class="nf">reopen</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">FILE_READWRITE</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reopen a grid to access the grid as an existing grid.</span>
<span class="sd">    </span>
<span class="sd">    Some gxapi.GXIMU methods will not work with grids open as new grids. This method closes</span>
<span class="sd">    the grid and reopens in the specific mode</span>
<span class="sd">    </span>
<span class="sd">    :param g:       `Grid` instance</span>
<span class="sd">    :param dtype:   data type, None to match the data type of the grid being reopened</span>
<span class="sd">    :param mode:    `FILE_READWRITE` (default) or `FILE_READ`</span>
<span class="sd">    :return:        new `Grid` instance</span>
<span class="sd">    </span>
<span class="sd">    .. versionadded:: 9.4</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">dtype</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">dtype</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">dtype</span>
    <span class="n">dfn</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">file_name_decorated</span>
    <span class="n">delete_set</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">remove_on_close</span>
    <span class="n">g</span><span class="o">.</span><span class="n">delete_files</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">g</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">Grid</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">dfn</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">delete_set</span><span class="p">:</span>
        <span class="n">g</span><span class="o">.</span><span class="n">delete_files</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">g</span></div>


<div class="viewcode-block" id="name_parts"><a class="viewcode-back" href="../../../geosoft.gxpy.grid.html#geosoft.gxpy.grid.name_parts">[docs]</a><span class="k">def</span> <span class="nf">name_parts</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return folder, undecorated file name + ext, file root, ext, decorations.</span>

<span class="sd">    If extension is not specified, &quot;.grd&quot; assumed</span>

<span class="sd">    For example:</span>

<span class="sd">    .. code::</span>

<span class="sd">        &gt;&gt;&gt; import geosoft.gxpy.grid as gxgrd</span>
<span class="sd">        &gt;&gt;&gt; namep = gxgrd.name_parts(&quot;f:/someFolder/name.grd(GRD;TYPE=SHORT)&quot;)</span>
<span class="sd">        &gt;&gt;&gt; print(namep)</span>
<span class="sd">        (&#39;f:/someFolder/&#39;,&#39;name.grd&#39;,&#39;name&#39;,&#39;.grd&#39;,&#39;(GRD;TYPE=SHORT)&#39;)</span>

<span class="sd">    .. versionadded:: 9.1</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="n">fn</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="n">root</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>

    <span class="k">if</span> <span class="s1">&#39;(&#39;</span> <span class="ow">in</span> <span class="n">ext</span><span class="p">:</span>
        <span class="n">ext</span><span class="p">,</span> <span class="n">dec</span> <span class="o">=</span> <span class="n">ext</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;)&#39;</span> <span class="ow">in</span> <span class="n">dec</span><span class="p">:</span>
            <span class="n">dec</span> <span class="o">=</span> <span class="n">dec</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;)&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">dec</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">ext</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">dec</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">dec</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;GRD&#39;</span><span class="p">):</span>
            <span class="n">ext</span> <span class="o">=</span> <span class="s1">&#39;.grd&#39;</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">root</span> <span class="o">+</span> <span class="n">ext</span>

    <span class="k">return</span> <span class="n">fn</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">ext</span><span class="p">,</span> <span class="n">dec</span></div>


<div class="viewcode-block" id="decorate_name"><a class="viewcode-back" href="../../../geosoft.gxpy.grid.html#geosoft.gxpy.grid.decorate_name">[docs]</a><span class="k">def</span> <span class="nf">decorate_name</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">decorations</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Properly decorate a grid name.</span>

<span class="sd">    :param name:        file name</span>
<span class="sd">    :param decorations: file decorations, semicolon delimited</span>
<span class="sd">    :returns:           decorated file name</span>

<span class="sd">    .. versionadded:: 9.1</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="n">root</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="n">dec</span> <span class="o">=</span> <span class="n">decorations</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">dec</span><span class="p">:</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">decorations</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">)</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s1">&#39;)&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">end</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">d</span><span class="p">[:</span><span class="n">end</span><span class="p">]</span>
        <span class="n">ext</span> <span class="o">=</span> <span class="n">ext</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="s1">&#39;</span><span class="si">{}{}</span><span class="s1">(</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">ext</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">ext</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;.grd&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;</span><span class="si">{}{}</span><span class="s1">(GRD)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">ext</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">name</span></div>


<div class="viewcode-block" id="delete_files"><a class="viewcode-back" href="../../../geosoft.gxpy.grid.html#geosoft.gxpy.grid.delete_files">[docs]</a><span class="k">def</span> <span class="nf">delete_files</span><span class="p">(</span><span class="n">file_name</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Delete all files associates with this grid name.</span>

<span class="sd">    :param file_name: name of the grid file</span>

<span class="sd">    .. versionadded:: 9.2</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">file_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

        <span class="n">fn</span> <span class="o">=</span> <span class="n">name_parts</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
        <span class="n">file_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fn</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">fn</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">ext</span> <span class="o">=</span> <span class="n">fn</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">gxu</span><span class="o">.</span><span class="n">delete_file</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
        <span class="n">gxu</span><span class="o">.</span><span class="n">delete_file</span><span class="p">(</span><span class="n">file_name</span> <span class="o">+</span> <span class="s1">&#39;.gi&#39;</span><span class="p">)</span>
        <span class="n">gxu</span><span class="o">.</span><span class="n">delete_file</span><span class="p">(</span><span class="n">file_name</span> <span class="o">+</span> <span class="s1">&#39;.xml&#39;</span><span class="p">)</span>

        <span class="c1"># remove shaded files associated with this grid</span>
        <span class="n">file_s</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fn</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">fn</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;_s.grd&#39;</span>
        <span class="n">gxu</span><span class="o">.</span><span class="n">delete_file</span><span class="p">(</span><span class="n">file_s</span><span class="p">)</span>
        <span class="n">gxu</span><span class="o">.</span><span class="n">delete_file</span><span class="p">(</span><span class="n">file_s</span> <span class="o">+</span> <span class="s1">&#39;.gi&#39;</span><span class="p">)</span>
        <span class="n">gxu</span><span class="o">.</span><span class="n">delete_file</span><span class="p">(</span><span class="n">file_s</span> <span class="o">+</span> <span class="s1">&#39;.xml&#39;</span><span class="p">)</span>

        <span class="c1"># hgd files</span>
        <span class="k">if</span> <span class="n">ext</span> <span class="o">==</span> <span class="s1">&#39;.hgd&#39;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">16</span><span class="p">):</span>
                <span class="n">gxu</span><span class="o">.</span><span class="n">delete_file</span><span class="p">(</span><span class="n">file_name</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span></div>


<span class="k">def</span> <span class="nf">_transform_color_int_to_rgba</span><span class="p">(</span><span class="n">np_values</span><span class="p">):</span>
    <span class="n">np_values</span><span class="p">[</span><span class="n">np_values</span> <span class="o">==</span> <span class="n">gxapi</span><span class="o">.</span><span class="n">iDUMMY</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">right_shift</span><span class="p">(</span><span class="n">np_values</span><span class="p">,</span> <span class="mi">24</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
    <span class="n">b</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">right_shift</span><span class="p">(</span><span class="n">np_values</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
    <span class="n">g</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">right_shift</span><span class="p">(</span><span class="n">np_values</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="p">(</span><span class="n">np_values</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
    <span class="c1"># the values for color grids actually do not contain alphas but just</span>
    <span class="c1"># 0 or 1 to indicate if the color is valid or not</span>
    <span class="n">a</span><span class="p">[</span><span class="n">a</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">255</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">])</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>


<div class="viewcode-block" id="Grid"><a class="viewcode-back" href="../../../geosoft.gxpy.grid.html#geosoft.gxpy.grid.Grid">[docs]</a><span class="k">class</span> <span class="nc">Grid</span><span class="p">(</span><span class="n">gxgm</span><span class="o">.</span><span class="n">Geometry</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Grid and image class.</span>

<span class="sd">    :Constructors:</span>

<span class="sd">        ========================= ==============================================================</span>
<span class="sd">        :meth:`open`              open an existing grid/image</span>
<span class="sd">        :meth:`new`               create a new grid/image</span>
<span class="sd">        :meth:`copy`              create a copy</span>
<span class="sd">        :meth:`index_window`      create a windowed grid based on grid indexes</span>
<span class="sd">        :meth:`from_data_array`   create a new grid from a 2d data array</span>
<span class="sd">        :meth:`minimum_curvature` create by fitting a minimum-curvature surface to located data.</span>
<span class="sd">        ========================= ==============================================================</span>

<span class="sd">    A grid instance supports iteration that yields (x, y, z, grid_value) by points along rows.</span>
<span class="sd">    For example, the following prints the x, y, z, grid_value of every non-dummy point in a grid:</span>

<span class="sd">    .. code::</span>

<span class="sd">        import geosoft.gxpy.grid as gxgrd</span>

<span class="sd">        with gxgrd.Grid.open(&#39;some.grd&#39;) ad g:</span>
<span class="sd">            for x, y, z, v in g:</span>
<span class="sd">                if v is not None:</span>
<span class="sd">                    print(x, y, z, v)</span>

<span class="sd">    Specific grid cell values can be indexed (null grid values are None):</span>

<span class="sd">    .. code::</span>

<span class="sd">        import geosoft.gxpy.grid as gxgrd</span>

<span class="sd">        with gxgrd.Grid.open(&#39;some.grd&#39;) as g:</span>
<span class="sd">            for ix in range(g.nx):</span>
<span class="sd">                for iy in range(g.ny):</span>
<span class="sd">                    x, y, z, v = g[ix, iy]</span>
<span class="sd">                    if v is not None:</span>
<span class="sd">                        print(x, y, z, v)</span>

<span class="sd">    .. versionadded:: 9.1</span>

<span class="sd">    .. versionchanged:: 9.2.1 added iterator support</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_delete_files</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">_file_name</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_type</span><span class="p">,</span> <span class="n">_value</span><span class="p">,</span> <span class="n">_traceback</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="fm">__del__</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_close&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_close</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_close</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pop</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>

        <span class="k">def</span> <span class="nf">flush_hgd</span><span class="p">(</span><span class="n">hgd_temp</span><span class="p">):</span>

            <span class="c1"># convert tempory grid to an HGD file</span>
            <span class="n">img</span> <span class="o">=</span> <span class="n">gxapi</span><span class="o">.</span><span class="n">GXIMG</span><span class="o">.</span><span class="n">create_file</span><span class="p">(</span><span class="n">gxapi</span><span class="o">.</span><span class="n">GS_TYPE_DEFAULT</span><span class="p">,</span>
                                          <span class="n">decorate_name</span><span class="p">(</span><span class="n">hgd_temp</span><span class="p">,</span> <span class="s1">&#39;GRD&#39;</span><span class="p">),</span>
                                          <span class="n">gxapi</span><span class="o">.</span><span class="n">IMG_FILE_READONLY</span><span class="p">)</span>
            <span class="n">gxapi</span><span class="o">.</span><span class="n">GXHGD</span><span class="o">.</span><span class="n">h_create_img</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">decorate_name</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hgd_name</span><span class="p">,</span> <span class="s1">&#39;HGD&#39;</span><span class="p">))</span>
            <span class="n">img</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_open&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_open</span><span class="p">:</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">_img</span> <span class="o">=</span> <span class="kc">None</span>

                <span class="n">grid_file_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file_name</span>
                <span class="n">file_name_decorated</span> <span class="o">=</span> <span class="n">decorate_name</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_file_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_decoration</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_decoration</span> <span class="k">else</span> <span class="kc">None</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hgd</span><span class="p">:</span>

                    <span class="n">flush_hgd</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_file_name</span><span class="p">)</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metadata_changed</span><span class="p">:</span>
                        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_file_name</span> <span class="o">+</span> <span class="s1">&#39;.xml&#39;</span><span class="p">,</span> <span class="s1">&#39;w+&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">gxu</span><span class="o">.</span><span class="n">xml_from_dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span><span class="p">))</span>
                        <span class="k">if</span> <span class="n">file_name_decorated</span><span class="p">:</span>
                            <span class="n">gxapi</span><span class="o">.</span><span class="n">GXIMG</span><span class="o">.</span><span class="n">sync</span><span class="p">(</span><span class="n">file_name_decorated</span><span class="p">)</span>
                    <span class="n">delete_files</span><span class="p">(</span><span class="n">grid_file_name</span><span class="p">)</span>

                <span class="k">else</span><span class="p">:</span>

                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_delete_files</span><span class="p">:</span>
                        <span class="n">delete_files</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_file_name</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mode</span> <span class="o">!=</span> <span class="n">FILE_READ</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">file_name_decorated</span><span class="p">:</span>
                            <span class="k">try</span><span class="p">:</span>
                                <span class="n">gxapi</span><span class="o">.</span><span class="n">GXIMG</span><span class="o">.</span><span class="n">sync</span><span class="p">(</span><span class="n">file_name_decorated</span><span class="p">)</span>
                            <span class="k">except</span> <span class="p">(</span><span class="n">geosoft</span><span class="o">.</span><span class="n">GXRuntimeError</span><span class="p">,</span> <span class="n">geosoft</span><span class="o">.</span><span class="n">gxapi</span><span class="o">.</span><span class="n">GXAPIError</span><span class="p">):</span>
                                <span class="c1"># Locked files, extremely large files (e.g. GXF) etc. could cause errors with the</span>
                                <span class="c1"># command above. TODO: Do we even need it? The code below overwrites it anyway?</span>
                                <span class="k">pass</span>

                        <span class="k">if</span> <span class="n">grid_file_name</span><span class="p">:</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metadata_changed</span><span class="p">:</span>
                                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">grid_file_name</span> <span class="o">+</span> <span class="s1">&#39;.xml&#39;</span><span class="p">,</span> <span class="s1">&#39;w+&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">gxu</span><span class="o">.</span><span class="n">xml_from_dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span><span class="p">))</span>

                <span class="k">if</span> <span class="n">pop</span><span class="p">:</span>
                    <span class="n">gx</span><span class="o">.</span><span class="n">pop_resource</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_open</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_open</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_buffer_np</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_buffer_x</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_buffer_y</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_cs</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_gxpg</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">(</span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;&lt;class Grid&gt;: memory (</span><span class="si">{}</span><span class="s1">, </span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ny</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;&lt;class Grid&gt;: </span><span class="si">{}</span><span class="s1"> (</span><span class="si">{}</span><span class="s1">, </span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_name_decorated</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ny</span><span class="p">)</span>

<div class="viewcode-block" id="Grid.__init__"><a class="viewcode-back" href="../../../geosoft.gxpy.grid.html#geosoft.gxpy.grid.Grid.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">in_memory</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">kx</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_delete_files</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_readonly</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_decoration</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

        <span class="k">if</span> <span class="s1">&#39;name&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">file_name</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">file_name</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;_grid_&#39;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_hgd</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hgd_name</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_metadata_changed</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_metadata_root</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_img</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_buffered_row</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_buffer_np</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_buffered_xy</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_buffer_x</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_buffer_y</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cs</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_gxpg</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># build a file name</span>
        <span class="k">if</span> <span class="n">in_memory</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_file_name</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">file_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">file_name</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
                <span class="n">file_name</span> <span class="o">=</span> <span class="n">gx</span><span class="o">.</span><span class="n">gx</span><span class="p">()</span><span class="o">.</span><span class="n">temp_file</span><span class="p">(</span><span class="s1">&#39;.grd(GRD)&#39;</span><span class="p">)</span>
            <span class="n">path</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">ext</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_decoration</span> <span class="o">=</span> <span class="n">name_parts</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_file_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">file_name</span><span class="p">)</span>

            <span class="c1"># for an HGD file work with a temporary grid, save to HGD on closing</span>
            <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="n">FILE_NEW</span> <span class="ow">and</span> <span class="n">ext</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;.hgd&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_hgd</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_hgd_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file_name</span>
                <span class="n">file_name</span> <span class="o">=</span> <span class="n">gx</span><span class="o">.</span><span class="n">gx</span><span class="p">()</span><span class="o">.</span><span class="n">temp_file</span><span class="p">(</span><span class="s1">&#39;.grd(GRD)&#39;</span><span class="p">)</span>
                <span class="n">path</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">ext</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_decoration</span> <span class="o">=</span> <span class="n">name_parts</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_file_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">file_name</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="n">FILE_NEW</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">dtype</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span>
            <span class="n">gxtype</span> <span class="o">=</span> <span class="n">gxu</span><span class="o">.</span><span class="n">gx_dtype</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">in_memory</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_img</span> <span class="o">=</span> <span class="n">gxapi</span><span class="o">.</span><span class="n">GXIMG</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">gxtype</span><span class="p">,</span> <span class="n">kx</span><span class="p">,</span> <span class="n">dim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dim</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="c1"># Need to set the kx otherwise it will be 0 and some routines (e.g. IMU stats calc) could cause aborts</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_img</span><span class="o">.</span><span class="n">opt_kx</span><span class="p">(</span><span class="n">kx</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>    
                <span class="k">if</span> <span class="ow">not</span> <span class="n">overwrite</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_file_name</span><span class="p">):</span>
                        <span class="k">raise</span> <span class="n">GridException</span><span class="p">(</span><span class="n">_t</span><span class="p">(</span><span class="s1">&#39;Cannot overwrite existing grid </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_name</span><span class="p">)))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_img</span> <span class="o">=</span> <span class="n">gxapi</span><span class="o">.</span><span class="n">GXIMG</span><span class="o">.</span><span class="n">create_new_file</span><span class="p">(</span><span class="n">gxtype</span><span class="p">,</span>
                                                        <span class="n">kx</span><span class="p">,</span> <span class="n">dim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dim</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                                        <span class="n">decorate_name</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_file_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_decoration</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># open an existing grid</span>

            <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="n">FILE_READ</span><span class="p">:</span>
                <span class="n">open_mode</span> <span class="o">=</span> <span class="n">gxapi</span><span class="o">.</span><span class="n">IMG_FILE_READONLY</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_readonly</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">mode</span> <span class="o">=</span> <span class="n">FILE_READWRITE</span>
                <span class="n">open_mode</span> <span class="o">=</span> <span class="n">gxapi</span><span class="o">.</span><span class="n">IMG_FILE_READORWRITE</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_readonly</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="c1"># always open in default type unless float or double specifically requested</span>
            <span class="n">gxtype</span> <span class="o">=</span> <span class="n">gxapi</span><span class="o">.</span><span class="n">GS_TYPE_DEFAULT</span>
            <span class="k">if</span> <span class="n">dtype</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">gxtype_from_dtype</span> <span class="o">=</span> <span class="n">gxu</span><span class="o">.</span><span class="n">gx_dtype</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">gxtype_from_dtype</span> <span class="ow">in</span> <span class="p">(</span><span class="n">gxapi</span><span class="o">.</span><span class="n">GS_FLOAT</span><span class="p">,</span> <span class="n">gxapi</span><span class="o">.</span><span class="n">GS_DOUBLE</span><span class="p">):</span>
                    <span class="n">gxtype</span> <span class="o">=</span> <span class="n">gxtype_from_dtype</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_img</span> <span class="o">=</span> <span class="n">gxapi</span><span class="o">.</span><span class="n">GXIMG</span><span class="o">.</span><span class="n">create_file</span><span class="p">(</span><span class="n">gxtype</span><span class="p">,</span>
                                                <span class="bp">self</span><span class="o">.</span><span class="n">file_name_decorated</span><span class="p">,</span>
                                                <span class="n">open_mode</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">dtype</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">dtype</span> <span class="o">=</span> <span class="n">gxu</span><span class="o">.</span><span class="n">dtype_gx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_img</span><span class="o">.</span><span class="n">e_type</span><span class="p">())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_mode</span> <span class="o">=</span> <span class="n">mode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_next</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_next_row</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_next_col</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_gxtype</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_img</span><span class="o">.</span><span class="n">e_type</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dtype</span> <span class="o">=</span> <span class="n">dtype</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dummy</span> <span class="o">=</span> <span class="n">gxu</span><span class="o">.</span><span class="n">gx_dummy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dtype</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_is_int</span> <span class="o">=</span> <span class="n">gxu</span><span class="o">.</span><span class="n">is_int</span><span class="p">(</span><span class="n">gxu</span><span class="o">.</span><span class="n">gx_dtype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cos_rot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sin_rot</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rot</span>  <span class="c1"># this sets _cos_rot and _sin_rot</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_open</span> <span class="o">=</span> <span class="n">gx</span><span class="o">.</span><span class="n">track_resource</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file_name</span><span class="p">)</span></div>

<div class="viewcode-block" id="Grid.open"><a class="viewcode-back" href="../../../geosoft.gxpy.grid.html#geosoft.gxpy.grid.Grid.open">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">open</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">FILE_READ</span><span class="p">,</span>
             <span class="n">coordinate_system</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cell_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">expand</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Open an existing grid file.</span>

<span class="sd">        :param file_name:   name of the grid file, with decorations. See `supported file formats</span>
<span class="sd">                            &lt;https://geosoftgxdev.atlassian.net/wiki/display/GXDEV92/Grid+File+Name+Decorations&gt;`_)</span>
<span class="sd">        :param dtype:       numpy data type, which will be the grid data type.</span>
<span class="sd">        :param mode:        open mode:</span>

<span class="sd">            =================  ================================================</span>
<span class="sd">            FILE_READ          only read the file, properties cannot be changed</span>
<span class="sd">            FILE_READWRITE     grid stays the same, but properties may change</span>
<span class="sd">            =================  ================================================</span>

<span class="sd">        :param coordinate_system:   desired coordinate system. The grid will be reprojected if necessary.</span>
<span class="sd">        :param cell_size:           desired cell size, defaults to the current cell size.</span>
<span class="sd">        :param expand:              if reprojecting or resampling the are can be expanded by this percentage</span>
<span class="sd">                                    to allow for curved edges in the new coordinate system space.  The default</span>
<span class="sd">                                    expands by 1%. Set to 0 to prevent expansion.</span>

<span class="sd">        If reprojecting or setting the cell size different from the original grid, the mode must be FILE_READ.</span>

<span class="sd">        If reprojecting without setting the cell size a default cell size will be calculated in the new</span>
<span class="sd">        coordinate system that is nominally equivalent to the current cell size.</span>

<span class="sd">        .. versionadded:: 9.1</span>

<span class="sd">        .. versionchanged:: 9.4     added reprojection support</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">grd</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">)</span>

        <span class="c1"># determine if we need to reproject or resample</span>
        <span class="n">repro</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">coordinate_system</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">coordinate_system</span><span class="p">,</span> <span class="n">gxcs</span><span class="o">.</span><span class="n">Coordinate_system</span><span class="p">):</span>
                <span class="n">coordinate_system</span> <span class="o">=</span> <span class="n">gxcs</span><span class="o">.</span><span class="n">Coordinate_system</span><span class="p">(</span><span class="n">coordinate_system</span><span class="p">)</span>
            <span class="n">repro</span> <span class="o">=</span> <span class="n">coordinate_system</span> <span class="o">!=</span> <span class="n">grd</span><span class="o">.</span><span class="n">coordinate_system</span>

        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">repro</span> <span class="ow">and</span> <span class="n">cell_size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">((</span><span class="n">cell_size</span> <span class="o">!=</span> <span class="n">grd</span><span class="o">.</span><span class="n">dx</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">cell_size</span> <span class="o">!=</span> <span class="n">grd</span><span class="o">.</span><span class="n">dy</span><span class="p">)):</span>
            <span class="n">repro</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="n">repro</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">mode</span> <span class="o">!=</span> <span class="n">FILE_READ</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">GridException</span><span class="p">(</span><span class="n">_t</span><span class="p">(</span><span class="s1">&#39;Mode must be FILE_READ to reproject or resample a grid.&#39;</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">cell_size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">cell_size</span> <span class="o">=</span> <span class="n">gxapi</span><span class="o">.</span><span class="n">rDUMMY</span>
            <span class="k">if</span> <span class="n">expand</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">expand</span> <span class="o">=</span> <span class="n">gxapi</span><span class="o">.</span><span class="n">rDUMMY</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">coordinate_system</span><span class="p">:</span>
                <span class="n">coordinate_system</span> <span class="o">=</span> <span class="n">grd</span><span class="o">.</span><span class="n">coordinate_system</span>
            <span class="n">grd</span><span class="o">.</span><span class="n">gximg</span><span class="o">.</span><span class="n">create_projected3</span><span class="p">(</span><span class="n">coordinate_system</span><span class="o">.</span><span class="n">gxipj</span><span class="p">,</span> <span class="n">cell_size</span><span class="p">,</span> <span class="n">expand</span><span class="p">)</span>
            <span class="n">grd</span><span class="o">.</span><span class="n">_cs</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">grd</span><span class="o">.</span><span class="n">_cos_rot</span> <span class="o">=</span> <span class="mf">1.0</span>
            <span class="n">grd</span><span class="o">.</span><span class="n">_sin_rot</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="k">return</span> <span class="n">grd</span></div>

<div class="viewcode-block" id="Grid.new"><a class="viewcode-back" href="../../../geosoft.gxpy.grid.html#geosoft.gxpy.grid.Grid.new">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">new</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">properties</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">in_memory</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a new grid file.</span>

<span class="sd">        :param file_name:   name of the grid file, None for a temporary grid. See `supported file formats</span>
<span class="sd">                            &lt;https://geosoftgxdev.atlassian.net/wiki/display/GXDEV92/Grid+File+Name+Decorations&gt;`_)</span>
<span class="sd">        :param in_memory:   Creates an in-memory grid (file_name will be ignored)</span>
<span class="sd">        :param properties:  dictionary of grid properties, see :meth:`properties`</span>
<span class="sd">        :param overwrite:   True to overwrite existing file</span>

<span class="sd">        .. versionadded:: 9.1</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">properties</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">GridException</span><span class="p">(</span><span class="n">_t</span><span class="p">(</span><span class="s2">&quot;Missing properties dictionary.&quot;</span><span class="p">))</span>

        <span class="c1"># set basic grid properties</span>
        <span class="n">dtype</span> <span class="o">=</span> <span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;dtype&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">nx</span> <span class="o">=</span> <span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;nx&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">ny</span> <span class="o">=</span> <span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ny&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">nx</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">ny</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">GridException</span><span class="p">(</span><span class="n">_t</span><span class="p">(</span><span class="s1">&#39;Grid dimension (</span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="s1">) must be &gt; 0&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span> <span class="n">ny</span><span class="p">))</span>

        <span class="n">grd</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">in_memory</span><span class="o">=</span><span class="n">in_memory</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">FILE_NEW</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span> <span class="n">ny</span><span class="p">),</span> <span class="n">overwrite</span><span class="o">=</span><span class="n">overwrite</span><span class="p">)</span>
        <span class="n">grd</span><span class="o">.</span><span class="n">set_properties</span><span class="p">(</span><span class="n">properties</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">grd</span></div>

<div class="viewcode-block" id="Grid.minimum_curvature"><a class="viewcode-back" href="../../../geosoft.gxpy.grid.html#geosoft.gxpy.grid.Grid.minimum_curvature">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">minimum_curvature</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span>
                          <span class="n">unit_of_measure</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                          <span class="n">file_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                          <span class="n">max_segments</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
                          <span class="n">coordinate_system</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                          <span class="n">cs</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                          <span class="n">area</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
                          <span class="n">bclip</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                          <span class="n">logopt</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                          <span class="n">logmin</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                          <span class="n">idsf</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                          <span class="n">bkd</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                          <span class="n">srd</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                          <span class="n">iwt</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                          <span class="n">edgclp</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                          <span class="n">tol</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                          <span class="n">pastol</span><span class="o">=</span><span class="s1">&#39;100&#39;</span><span class="p">,</span>
                          <span class="n">itrmax</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                          <span class="n">ti</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                          <span class="n">icgr</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a minimum-curvature surface grid from (x, y, value) located data.</span>

<span class="sd">        Reference: Smith and Wessel, 1990, Gridding with continuous curvature splines in tension.</span>

<span class="sd">        :param data:        list of [(x, y, value), ...] or a callback that returns lists, or a tuple</span>
<span class="sd">                            (gdb, value_channel, x_channel, y_channel) where x_channel and y_channel, if not</span>
<span class="sd">                            specified, default to the current database (x, y) channels.  See below.</span>
<span class="sd">        :param unit_of_measure: string unit of measurement descriptor.</span>
<span class="sd">        :param file_name:   name of the grid file, None for a temporary grid. See `supported file formats</span>
<span class="sd">                            &lt;https://geosoftgxdev.atlassian.net/wiki/display/GXDEV92/Grid+File+Name+Decorations&gt;`_)</span>
<span class="sd">        :param overwrite:   True to overwrite existing file</span>
<span class="sd">        :param max_segments:   Maximum number of line segments if using a callback, defaults to 1000.</span>
<span class="sd">        :param coordinate_system:   coordinate system</span>

<span class="sd">        Gridding parameters follow the nomenclature of the rangrid.con file:</span>
<span class="sd">        https://github.com/GeosoftInc/gxc/blob/master/reference/con_files/rangrid.con</span>

<span class="sd">        :param cs:      The grid cell size in reference system units.</span>
<span class="sd">        :param area:    (xmin, ymin, xmax, ymax) - grid area, default is the data limits</span>
<span class="sd">        :param bclip:   0 to use all data (default), 1 to only use data in the dat area.</span>
<span class="sd">        :param logopt:  1 for log(value) minimum cliped to log(logmin); 2 for `logmin + log(value/logmin)` for</span>
<span class="sd">                        postive `value`, `-logmin - log(-value/logmin` for negative `value`</span>
<span class="sd">        :param logmin:  see `logopt`, default is 1.</span>
<span class="sd">        :param idsf:    low-pass desampling factor in cells, default is 1. Effectively a low-pass filter that</span>
<span class="sd">                        can smooth noisy data that has clustered locations.</span>
<span class="sd">        :param bkd:     Blanking distance. All grid cells farther than the blanking</span>
<span class="sd">                        distance from a valid point will be blanked in the output grid.</span>
<span class="sd">                        The default is the nominal sample interval, i.e. sqrt(area/#data).</span>
<span class="sd">                        This parameter should normally be set to just greater than the maximum</span>
<span class="sd">                        sampling interval through which interpolation is desired.</span>
<span class="sd">                        If there are too many holes in the resulting grid,</span>
<span class="sd">                        increase appropriately.</span>
<span class="sd">        :param srd:     The maximum search radius to use for establishing the starting</span>
<span class="sd">                        values for the coarse grid.  The default is four times the coarse</span>
<span class="sd">                        grid size defined by `icgr`.  If no data is found within the maximum</span>
<span class="sd">                        search radius, the mean of the data is used as the starting value.</span>
<span class="sd">                        If the search radius is too small, the starting grid can be a poor</span>
<span class="sd">                        approximation of the desired grid, resulting in excessive processing</span>
<span class="sd">                        time.  If too large, too much time will be consumed establishing</span>
<span class="sd">                        the original coarse grid.</span>
<span class="sd">        :param iwt:     The weighting power to use to establish the coarse starting grid.</span>
<span class="sd">                        The default is 2, for inverse distance squared.  There is little</span>
<span class="sd">                        reason to change this from the default.</span>
<span class="sd">        :param edgclp:  Edge clipping parameter, the number of grid cells to extend beyond</span>
<span class="sd">                        the outside limits of the data. The default (-1) is not to apply</span>
<span class="sd">                        edge clipping to the blanking distanced grid.</span>
<span class="sd">                        Use this parameter to ensure the grid does not extend too far</span>
<span class="sd">                        beyond the actual data limits, which can occur when using a large</span>
<span class="sd">                        blanking distance with widely spaced data.</span>
<span class="sd">        :param tol:     The tolerance required for each grid cell. The default is 0.1</span>
<span class="sd">                        percent of the range of the data. Decrease for a more accurate grid.</span>
<span class="sd">        :param pastol:  The percentage of points that must meet the tolerance. The</span>
<span class="sd">                        iteration process will stop when the percentage of points change</span>
<span class="sd">                        by higher than this required percentage in iteration. The default</span>
<span class="sd">                        is 100.0 percent. Decrease for rough data to reduce minimum curvature</span>
<span class="sd">                        overshoot, and increase for a to make the grid surface more accurately</span>
<span class="sd">                        match the data. Overshoot can also be controlled by increasing tension (ti).</span>
<span class="sd">        :param itrmax:  Maximum number of iterations to use in solving the minimum curvature</span>
<span class="sd">                        function.  The default is 200 iterations.  Increase for a more</span>
<span class="sd">                        accurate grid.  A value of 1000 is typically sufficient for maximum accuracy.</span>
<span class="sd">        :param ti:      The degree of internal tension ( between 0 and 1 ).</span>
<span class="sd">                        The default is no tension (0.0) which produces a true minimum</span>
<span class="sd">                        curvature surface.  Increasing tension can prevent overshooting of</span>
<span class="sd">                        valid data in sparse areas at the expense of increased local curvature</span>
<span class="sd">                        near data points.</span>
<span class="sd">        :param icgr:    The course grid size relative to the final grid size.  Allowable</span>
<span class="sd">                        factors are 16,8,4,2 or 1.  The default is 8.  The optimum is a</span>
<span class="sd">                        factor close to half the nominal data spacing, although in most</span>
<span class="sd">                        situations the default is fine.  This parameter effects the</span>
<span class="sd">                        length of time it takes to find a solution.</span>

<span class="sd">        **The** `data` **parameter:**</span>

<span class="sd">        The data can be provided to the gridding algorithm either as a list array, a callback function that</span>
<span class="sd">        returns list array segments, or a `geosoft.gxpy.gdb.Geosoft_database` instance. In the case of a list or</span>
<span class="sd">        a callback, a temporary database is constructed internally.</span>

<span class="sd">        A callback is passed a sequence number, 0, 1, 2, ... and is expected to return a list array with each call</span>
<span class="sd">        or None when there is no more data.  See the example below. When a callback is used, the `max_segments`</span>
<span class="sd">        parameter sets the maximum number of lines for the temporary database as each return from the</span>
<span class="sd">        callback will create a new line in the internal temporary database.</span>

<span class="sd">        If a database instance is passed it must be the first item in a tuple of 2 or 4 items:</span>
<span class="sd">        (gdb_instance, value_channel) or (gdb_instance, value_channel, x_channel, y_channel).</span>
<span class="sd">        In the first case the default spatial (x, y) channels in the database are assumed.</span>

<span class="sd">        Examples:</span>

<span class="sd">        .. code::</span>

<span class="sd">            import numpy as np</span>
<span class="sd">            import geosoft.gxpy.grid as gxgrd</span>

<span class="sd">            # simple data array</span>
<span class="sd">            xyv = [(45., 10., 100), (60., 25., 77.), (50., 8., 80.)]</span>
<span class="sd">            grid = gxgrd.Grid.minimum_curvature(xyv)</span>

<span class="sd">            # or a numpy array</span>
<span class="sd">            grid = gxgrd.Grid.minimum_curvature(np.array(xyv))</span>

<span class="sd">            # a database, grid to a cell size of 100</span>
<span class="sd">            import geosoft.gxpy.gdb as gxgdb</span>
<span class="sd">            gdb = gxgdb.Geosoft_database.open(&#39;some_mag_data.gdb&#39;)</span>
<span class="sd">            grid = gxgrd.Grid.minimum_curvature((gdb, &#39;tmi&#39;), cs=100)</span>

<span class="sd">            # a callback, used for very large data, or to feed data efficiently from some other source.</span>
<span class="sd">            nxyv = np.array([[(45., 10., 100), (60., 25., 77.), (50., 8., 81.), (55., 11., 66.)],</span>
<span class="sd">                             [(20., 15., 108), (25.,  5., 77.), (33., 9., np.nan), (28., 2., 22.)],</span>
<span class="sd">                             [(35., 18., 110), (40., 31., 77.), (13., 4., 83.), (44., 4., 7.)]])</span>
<span class="sd">            def feed_data(n):</span>
<span class="sd">                if n &gt;= len(nxyv):</span>
<span class="sd">                    return None</span>
<span class="sd">                return nxyv[n]</span>
<span class="sd">            grid = gxgrd.Grid.minimum_curvature(feed_data, cs=1.)</span>

<span class="sd">        .. versionadded:: 9.4</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">gdb_from_callback</span><span class="p">(</span><span class="n">callback</span><span class="p">):</span>
            <span class="n">_gdb</span> <span class="o">=</span> <span class="n">gxgdb</span><span class="o">.</span><span class="n">Geosoft_gdb</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">max_lines</span><span class="o">=</span><span class="n">max_segments</span><span class="p">)</span>
            <span class="n">channels</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;v&#39;</span><span class="p">)</span>
            <span class="n">il</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">xyz_list</span> <span class="o">=</span> <span class="n">callback</span><span class="p">(</span><span class="n">il</span><span class="p">)</span>
            <span class="k">while</span> <span class="n">xyz_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">_gdb</span><span class="o">.</span><span class="n">write_line</span><span class="p">(</span><span class="s1">&#39;L</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">il</span><span class="p">),</span> <span class="n">xyz_list</span><span class="p">,</span> <span class="n">channels</span><span class="o">=</span><span class="n">channels</span><span class="p">)</span>
                <span class="n">il</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">xyz_list</span> <span class="o">=</span> <span class="n">callback</span><span class="p">(</span><span class="n">il</span><span class="p">)</span>
            <span class="n">_gdb</span><span class="o">.</span><span class="n">xyz_channels</span> <span class="o">=</span> <span class="n">channels</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">_gdb</span>

        <span class="k">def</span> <span class="nf">gdb_from_data</span><span class="p">(</span><span class="n">_d</span><span class="p">):</span>
            <span class="k">def</span> <span class="nf">_data</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">_d</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">None</span>
            <span class="k">return</span> <span class="n">gdb_from_callback</span><span class="p">(</span><span class="n">_data</span><span class="p">)</span>

        <span class="c1"># create a database from the data</span>
        <span class="n">xc</span><span class="p">,</span> <span class="n">yc</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">)</span>
        <span class="n">discard</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">callable</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
            <span class="n">gdb</span> <span class="o">=</span> <span class="n">gdb_from_callback</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="n">vc</span> <span class="o">=</span> <span class="s1">&#39;v&#39;</span>
            <span class="n">discard</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="n">gdb</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">vc</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                <span class="n">xc</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">yc</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">xc</span><span class="p">,</span> <span class="n">yc</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">gdb</span><span class="o">.</span><span class="n">xyz_channels</span>
            <span class="n">discard</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">gdb</span> <span class="o">=</span> <span class="n">gdb_from_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="n">vc</span> <span class="o">=</span> <span class="s1">&#39;v&#39;</span>

        <span class="k">if</span> <span class="n">tol</span> <span class="ow">and</span> <span class="nb">float</span><span class="p">(</span><span class="n">tol</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mf">0.</span><span class="p">:</span>
            <span class="n">tol</span> <span class="o">=</span> <span class="mf">1.0e-25</span>

        <span class="c1"># parameter control file</span>
        <span class="n">con_file</span> <span class="o">=</span> <span class="n">gx</span><span class="o">.</span><span class="n">gx</span><span class="p">()</span><span class="o">.</span><span class="n">temp_file</span><span class="p">(</span><span class="s1">&#39;con&#39;</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">con_file</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> / cs</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cs</span><span class="p">))</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="s1"> / xmin, ymin, xmax, ymax, bclip</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span>
                    <span class="nb">format</span><span class="p">(</span><span class="n">area</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">area</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">area</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">area</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">bclip</span><span class="p">))</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;,,,</span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="s1"> / ,,, logopt, logmin</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logopt</span><span class="p">,</span> <span class="n">logmin</span><span class="p">))</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="s1"> / idsf, bkd, srd, iwt, edgeclp</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">idsf</span><span class="p">,</span> <span class="n">bkd</span><span class="p">,</span> <span class="n">srd</span><span class="p">,</span> <span class="n">iwt</span><span class="p">,</span> <span class="n">edgclp</span><span class="p">))</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="s1"> / tol, pastol, itrmax, ti, icgr</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tol</span><span class="p">,</span> <span class="n">pastol</span><span class="p">,</span> <span class="n">itrmax</span><span class="p">,</span> <span class="n">ti</span><span class="p">,</span> <span class="n">icgr</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">file_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">file_name</span> <span class="o">=</span> <span class="n">gx</span><span class="o">.</span><span class="n">gx</span><span class="p">()</span><span class="o">.</span><span class="n">temp_file</span><span class="p">(</span><span class="s1">&#39;grd(GRD)&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">file_name</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">overwrite</span><span class="p">:</span>
                <span class="n">gxu</span><span class="o">.</span><span class="n">delete_files_by_root</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">GridException</span><span class="p">(</span><span class="n">_t</span><span class="p">(</span><span class="s1">&#39;Cannot overwrite existing file: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">file_name</span><span class="p">))</span>

        <span class="n">gxapi</span><span class="o">.</span><span class="n">GXRGRD</span><span class="o">.</span><span class="n">run2</span><span class="p">(</span><span class="n">gdb</span><span class="o">.</span><span class="n">gxdb</span><span class="p">,</span> <span class="n">xc</span><span class="p">,</span> <span class="n">yc</span><span class="p">,</span> <span class="n">vc</span><span class="p">,</span> <span class="n">con_file</span><span class="p">,</span> <span class="n">file_name</span><span class="p">)</span>

        <span class="n">grd</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">FILE_READWRITE</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">coordinate_system</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">coordinate_system</span> <span class="o">=</span> <span class="n">gdb</span><span class="o">.</span><span class="n">coordinate_system</span>
        <span class="n">grd</span><span class="o">.</span><span class="n">coordinate_system</span> <span class="o">=</span> <span class="n">coordinate_system</span>
        <span class="k">if</span> <span class="n">unit_of_measure</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">unit_of_measure</span> <span class="o">=</span> <span class="n">gxgdb</span><span class="o">.</span><span class="n">Channel</span><span class="p">(</span><span class="n">gdb</span><span class="p">,</span> <span class="n">vc</span><span class="p">)</span><span class="o">.</span><span class="n">unit_of_measure</span>
        <span class="n">grd</span><span class="o">.</span><span class="n">unit_of_measure</span> <span class="o">=</span> <span class="n">unit_of_measure</span>

        <span class="n">log_file</span> <span class="o">=</span> <span class="s1">&#39;rangrid.log&#39;</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">log_file</span><span class="p">):</span>
            <span class="n">gxu</span><span class="o">.</span><span class="n">delete_file</span><span class="p">(</span><span class="n">log_file</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">discard</span><span class="p">:</span>
            <span class="n">gdb</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">discard</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">grd</span></div>

    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="fm">__next__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_next</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nx</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">ny</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_next</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">raise</span> <span class="ne">StopIteration</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_next</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_next</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">return</span> <span class="n">v</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">ix</span> <span class="o">=</span> <span class="n">item</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">nx</span>
            <span class="n">iy</span> <span class="o">=</span> <span class="n">item</span> <span class="o">//</span> <span class="bp">self</span><span class="o">.</span><span class="n">nx</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ix</span><span class="p">,</span> <span class="n">iy</span> <span class="o">=</span> <span class="n">item</span>

        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xyz</span><span class="p">((</span><span class="n">ix</span><span class="p">,</span> <span class="n">iy</span><span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffered_row</span> <span class="o">!=</span> <span class="n">iy</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_buffered_row</span> <span class="o">=</span> <span class="n">iy</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_buffer_np</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_row</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_buffered_row</span><span class="p">)</span><span class="o">.</span><span class="n">np</span>

        <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer_np</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_int</span><span class="p">:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">v</span> <span class="o">==</span> <span class="n">gxapi</span><span class="o">.</span><span class="n">iDUMMY</span><span class="p">:</span>
                <span class="n">v</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
            <span class="n">v</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">v</span>

<div class="viewcode-block" id="Grid.gxpg"><a class="viewcode-back" href="../../../geosoft.gxpy.grid.html#geosoft.gxpy.grid.Grid.gxpg">[docs]</a>    <span class="k">def</span> <span class="nf">gxpg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a copy of the `geosoft.gxapi.GXPG` instance for the grid.</span>

<span class="sd">        :param copy:    `True` to return a copy of the grids pager. The default is `False`, which</span>
<span class="sd">                        returns the shared grid pager, such that changes to the pager change the grid</span>
<span class="sd">                        and the pager is invalid when thr grid is closed or loses context.</span>

<span class="sd">        .. versionadded:: 9.1</span>

<span class="sd">        .. versionchanged:: 9.4 added `copy` parameter</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gxpg</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_gxpg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_img</span><span class="o">.</span><span class="n">geth_pg</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">copy</span><span class="p">:</span>
            <span class="n">pg</span> <span class="o">=</span> <span class="n">gxapi</span><span class="o">.</span><span class="n">GXPG</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_gxpg</span><span class="o">.</span><span class="n">n_rows</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gxpg</span><span class="o">.</span><span class="n">n_cols</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gxpg</span><span class="o">.</span><span class="n">e_type</span><span class="p">())</span>
            <span class="n">pg</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_gxpg</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">pg</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gxpg</span></div>

<div class="viewcode-block" id="Grid.get_value"><a class="viewcode-back" href="../../../geosoft.gxpy.grid.html#geosoft.gxpy.grid.Grid.get_value">[docs]</a>    <span class="k">def</span> <span class="nf">get_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a grid value at a point as a float.  For scalar data the point value will</span>
<span class="sd">        be interpolated between neighbors.  For color data the nearest value is returned</span>
<span class="sd">        as a color int.</span>
<span class="sd">        </span>
<span class="sd">        :param x: X location on the grid plane </span>
<span class="sd">        :param y: Y location on the grid plane</span>
<span class="sd">        :returns: grid value, or None if outside of grid area</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">gxu</span><span class="o">.</span><span class="n">dummy_none</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gximg</span><span class="o">.</span><span class="n">get_z</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span></div>

<div class="viewcode-block" id="Grid.copy"><a class="viewcode-back" href="../../../geosoft.gxpy.grid.html#geosoft.gxpy.grid.Grid.copy">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">grd</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">in_memory</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">FILE_READWRITE</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a new Grid instance as a copy of an existing grid.</span>

<span class="sd">        :param grd:         :class:`Grid` instance to save as a new grid, or a grid file name</span>
<span class="sd">        :param file_name:   name of the new grid (file with optional decorations). If not specified a temporary file</span>
<span class="sd">                            is created.</span>
<span class="sd">        :param dtype:       numpy data type, None to use type of the parent grid</span>
<span class="sd">        :param overwrite:   True to overwrite if the file exists, False to not overwrite.</span>
<span class="sd">        :param in_memory:   True to create a grin in memory.</span>
<span class="sd">        :param mode:        `open` mode for working with the copy.</span>

<span class="sd">        .. versionadded:: 9.2</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">grd</span><span class="p">,</span> <span class="n">Grid</span><span class="p">):</span>
            <span class="n">grd</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">grd</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">FILE_READ</span><span class="p">)</span>
            <span class="n">close_grid</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">close_grid</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="n">p</span> <span class="o">=</span> <span class="n">grd</span><span class="o">.</span><span class="n">properties</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">dtype</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">p</span><span class="p">[</span><span class="s1">&#39;dtype&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dtype</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">in_memory</span> <span class="ow">and</span> <span class="n">file_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">path0</span><span class="p">,</span> <span class="n">base_file0</span><span class="p">,</span> <span class="n">root0</span><span class="p">,</span> <span class="n">ext0</span><span class="p">,</span> <span class="n">dec0</span> <span class="o">=</span> <span class="n">name_parts</span><span class="p">(</span><span class="n">grd</span><span class="o">.</span><span class="n">file_name_decorated</span><span class="p">)</span>
            <span class="n">path1</span><span class="p">,</span> <span class="n">base_file1</span><span class="p">,</span> <span class="n">root1</span><span class="p">,</span> <span class="n">ext1</span><span class="p">,</span> <span class="n">dec1</span> <span class="o">=</span> <span class="n">name_parts</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">ext1</span><span class="p">:</span>
                <span class="n">ext1</span> <span class="o">=</span> <span class="n">ext0</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">ext1</span> <span class="o">==</span> <span class="n">ext0</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">dec1</span><span class="p">:</span>
                <span class="n">dec1</span> <span class="o">=</span> <span class="n">dec0</span>
            <span class="n">file_name</span> <span class="o">=</span> <span class="n">decorate_name</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path1</span><span class="p">,</span> <span class="n">root1</span><span class="p">)</span> <span class="o">+</span> <span class="n">ext1</span><span class="p">,</span> <span class="n">dec1</span><span class="p">)</span>

        <span class="n">copy</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="n">overwrite</span><span class="p">,</span> <span class="n">in_memory</span><span class="o">=</span><span class="n">in_memory</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">file_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">file_name</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">file_name_decorated</span>
        <span class="n">grd</span><span class="o">.</span><span class="n">gximg</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">copy</span><span class="o">.</span><span class="n">gximg</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">close_grid</span><span class="p">:</span>
            <span class="n">grd</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">in_memory</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">copy</span>

        <span class="n">copy</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">)</span></div>

<div class="viewcode-block" id="Grid.index_window"><a class="viewcode-back" href="../../../geosoft.gxpy.grid.html#geosoft.gxpy.grid.Grid.index_window">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">index_window</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">grd</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">x0</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">y0</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">nx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ny</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a windowed instance of a grid.</span>
<span class="sd">        </span>
<span class="sd">        :param grd:         :class:`Grid` instance</span>
<span class="sd">        :param name:        name for the windowed_grid, default is constructed from input grid</span>
<span class="sd">        :param x0:          integer index of the first X point</span>
<span class="sd">        :param y0:          integer index of the first Y point</span>
<span class="sd">        :param nx:          number of points in x</span>
<span class="sd">        :param ny:          number of points in y</span>
<span class="sd">        :param overwrite:   True to overwrite existing file, default is False</span>

<span class="sd">        .. versionadded:: 9.2</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">grd</span><span class="p">,</span> <span class="n">Grid</span><span class="p">):</span>
            <span class="n">grd</span> <span class="o">=</span> <span class="n">Grid</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">grd</span><span class="p">)</span>

        <span class="n">gnx</span> <span class="o">=</span> <span class="n">grd</span><span class="o">.</span><span class="n">nx</span>
        <span class="n">gny</span> <span class="o">=</span> <span class="n">grd</span><span class="o">.</span><span class="n">ny</span>
        <span class="k">if</span> <span class="n">nx</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">nx</span> <span class="o">=</span> <span class="n">gnx</span> <span class="o">-</span> <span class="n">x0</span>
        <span class="k">if</span> <span class="n">ny</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ny</span> <span class="o">=</span> <span class="n">gny</span> <span class="o">-</span> <span class="n">y0</span>
        <span class="n">mx</span> <span class="o">=</span> <span class="n">x0</span> <span class="o">+</span> <span class="n">nx</span>
        <span class="n">my</span> <span class="o">=</span> <span class="n">y0</span> <span class="o">+</span> <span class="n">ny</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">x0</span> <span class="o">&gt;=</span> <span class="n">gnx</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">y0</span> <span class="o">&gt;=</span> <span class="n">gny</span><span class="p">)</span> <span class="ow">or</span>
                <span class="p">(</span><span class="n">x0</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">y0</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span>
                <span class="p">(</span><span class="n">nx</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">ny</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span>
                <span class="p">(</span><span class="n">mx</span> <span class="o">&gt;</span> <span class="n">gnx</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">my</span> <span class="o">&gt;</span> <span class="n">gny</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="n">GridException</span><span class="p">(</span><span class="n">_t</span><span class="p">(</span><span class="s1">&#39;Window x0,y0,mx,my(</span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="s1">) out of bounds (</span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="p">)</span><span class="o">.</span>
                                <span class="nb">format</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">mx</span><span class="p">,</span> <span class="n">my</span><span class="p">,</span> <span class="n">gnx</span><span class="p">,</span> <span class="n">gny</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">path</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">ext</span><span class="p">,</span> <span class="n">dec</span> <span class="o">=</span> <span class="n">name_parts</span><span class="p">(</span><span class="n">grd</span><span class="o">.</span><span class="n">file_name_decorated</span><span class="p">)</span>
            <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">_(</span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="s1">)(</span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="s1">)</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">nx</span><span class="p">,</span> <span class="n">ny</span><span class="p">,</span> <span class="n">ext</span><span class="p">)</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">decorate_name</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">dec</span><span class="p">)</span>
            <span class="n">overwrite</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># create new grid</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">grd</span><span class="o">.</span><span class="n">properties</span><span class="p">()</span>
        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;nx&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nx</span>
        <span class="n">p</span><span class="p">[</span><span class="s1">&#39;ny&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ny</span>
        <span class="k">if</span> <span class="n">grd</span><span class="o">.</span><span class="n">rot</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">p</span><span class="p">[</span><span class="s1">&#39;x0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">grd</span><span class="o">.</span><span class="n">x0</span> <span class="o">+</span> <span class="n">grd</span><span class="o">.</span><span class="n">dx</span> <span class="o">*</span> <span class="n">x0</span>
            <span class="n">p</span><span class="p">[</span><span class="s1">&#39;y0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">grd</span><span class="o">.</span><span class="n">y0</span> <span class="o">+</span> <span class="n">grd</span><span class="o">.</span><span class="n">dy</span> <span class="o">*</span> <span class="n">y0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dx</span> <span class="o">=</span> <span class="n">grd</span><span class="o">.</span><span class="n">dx</span> <span class="o">*</span> <span class="n">x0</span>
            <span class="n">dy</span> <span class="o">=</span> <span class="n">grd</span><span class="o">.</span><span class="n">dy</span> <span class="o">*</span> <span class="n">y0</span>
            <span class="n">cos</span><span class="p">,</span> <span class="n">sin</span> <span class="o">=</span> <span class="n">grd</span><span class="o">.</span><span class="n">rotation_cos_sine</span>
            <span class="n">p</span><span class="p">[</span><span class="s1">&#39;x0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">grd</span><span class="o">.</span><span class="n">x0</span> <span class="o">-</span> <span class="n">dx</span> <span class="o">*</span> <span class="n">cos</span> <span class="o">-</span> <span class="n">dy</span> <span class="o">*</span> <span class="n">sin</span>
            <span class="n">p</span><span class="p">[</span><span class="s1">&#39;y0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">grd</span><span class="o">.</span><span class="n">y0</span> <span class="o">-</span> <span class="n">dy</span> <span class="o">*</span> <span class="n">cos</span> <span class="o">+</span> <span class="n">dx</span> <span class="o">*</span> <span class="n">sin</span>

        <span class="n">window_grid</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="n">overwrite</span><span class="p">)</span>
        <span class="n">source_pager</span> <span class="o">=</span> <span class="n">grd</span><span class="o">.</span><span class="n">gxpg</span><span class="p">(</span><span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">window_pager</span> <span class="o">=</span> <span class="n">window_grid</span><span class="o">.</span><span class="n">gxpg</span><span class="p">(</span><span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">window_pager</span><span class="o">.</span><span class="n">copy_subset</span><span class="p">(</span><span class="n">source_pager</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">ny</span><span class="p">,</span> <span class="n">nx</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">window_grid</span></div>

<div class="viewcode-block" id="Grid.from_data_array"><a class="viewcode-back" href="../../../geosoft.gxpy.grid.html#geosoft.gxpy.grid.Grid.from_data_array">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_data_array</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">properties</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create grid from a 2D data array or `geosoft.gxapi.GXPG`.</span>

<span class="sd">        :param data:        2D numpy data array, a 2d list, ir a `geosoft.gxapi.GXPG`.</span>
<span class="sd">        :param file_name:   name of the file, default creates a temporary file name</span>
<span class="sd">        :param properties:  grid properties as a dictionary</span>
<span class="sd">        :param overwrite:   `True` to overwrite existing grid.</span>
<span class="sd">        :returns:           :class:`Grid` instance</span>

<span class="sd">        .. versionadded:: 9.1</span>

<span class="sd">        .. versionchanged:: 9.4 - support for default temporary file name and creation from a GXPG.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">gxapi</span><span class="o">.</span><span class="n">GXPG</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">n_slices</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">GridException</span><span class="p">(</span><span class="n">_t</span><span class="p">(</span><span class="s1">&#39;Pager must be 2D&#39;</span><span class="p">))</span>
            <span class="n">nx</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">n_cols</span><span class="p">()</span>
            <span class="n">ny</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">n_rows</span><span class="p">()</span>
            <span class="n">dtype</span> <span class="o">=</span> <span class="n">gxu</span><span class="o">.</span><span class="n">dtype_gx</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">e_type</span><span class="p">())</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="n">ny</span><span class="p">,</span> <span class="n">nx</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span>
            <span class="n">dtype</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">dtype</span>

        <span class="k">if</span> <span class="n">properties</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">properties</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">properties</span><span class="p">[</span><span class="s1">&#39;nx&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nx</span>
        <span class="n">properties</span><span class="p">[</span><span class="s1">&#39;ny&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ny</span>
        <span class="n">properties</span><span class="p">[</span><span class="s1">&#39;dtype&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dtype</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">file_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">file_name</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">file_name</span> <span class="o">=</span> <span class="n">gx</span><span class="o">.</span><span class="n">gx</span><span class="p">()</span><span class="o">.</span><span class="n">temp_file</span><span class="p">(</span><span class="s1">&#39;.grd(GRD)&#39;</span><span class="p">)</span>

        <span class="n">grd</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">properties</span><span class="o">=</span><span class="n">properties</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="n">overwrite</span><span class="p">)</span>
        <span class="n">grd</span><span class="o">.</span><span class="n">write_rows</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">reopen</span><span class="p">(</span><span class="n">grd</span><span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_crooked_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;True if this grid follows a crooked path section.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">coordinate_system</span><span class="o">.</span><span class="n">gxipj</span><span class="o">.</span><span class="n">get_orientation</span><span class="p">()</span> <span class="o">==</span> <span class="n">gxapi</span><span class="o">.</span><span class="n">IPJ_ORIENT_SECTION_CROOKED</span>

<div class="viewcode-block" id="Grid.crooked_path"><a class="viewcode-back" href="../../../geosoft.gxpy.grid.html#geosoft.gxpy.grid.Grid.crooked_path">[docs]</a>    <span class="k">def</span> <span class="nf">crooked_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the `CrookedPath` instance for a crooked-path grid.</span>

<span class="sd">        .. versionadded::9.4</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_crooked_path</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">GridException</span><span class="p">(</span><span class="n">_t</span><span class="p">(</span><span class="s2">&quot;This is not a crooked-path section grid.&quot;</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">gxview</span><span class="o">.</span><span class="n">CrookedPath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coordinate_system</span><span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">rotation_cos_sine</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns grid rotation (cosine, sine).</span>

<span class="sd">        .. versionadded:: 9.3.1</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cos_rot</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sin_rot</span>

<div class="viewcode-block" id="Grid.delete_files"><a class="viewcode-back" href="../../../geosoft.gxpy.grid.html#geosoft.gxpy.grid.Grid.delete_files">[docs]</a>    <span class="k">def</span> <span class="nf">delete_files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">delete</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Delete the files associated with this grid when deleting the grid object.</span>
<span class="sd">        Note that files are not deleted until all references to this object are</span>
<span class="sd">        deleted and garbage collection is performed.</span>

<span class="sd">        :param delete: set to False to reverse a previous delete request</span>

<span class="sd">        .. versionadded:: 9.1</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_delete_files</span> <span class="o">=</span> <span class="n">delete</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">remove_on_close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Remove files on close setting, can be set.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_delete_files</span>
    
    <span class="nd">@remove_on_close</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">remove_on_close</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tf</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_delete_files</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">tf</span><span class="p">)</span>

<div class="viewcode-block" id="Grid.close"><a class="viewcode-back" href="../../../geosoft.gxpy.grid.html#geosoft.gxpy.grid.Grid.close">[docs]</a>    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">discard</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Close the grid and release all instance resources.</span>

<span class="sd">        :param discard: `True` to discard associated files on close</span>

<span class="sd">        .. versionchanged:: 9.4 added `discard` parameter</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">discard</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">delete_files</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_close</span><span class="p">()</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">dummy_value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return the grid data dummy value.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dummy</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">gximg</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; The `geosoft.gxapi.GXIMG` instance handle.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_img</span>

    <span class="k">def</span> <span class="nf">_init_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span> <span class="o">=</span> <span class="n">gxu</span><span class="o">.</span><span class="n">geosoft_metadata</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_file_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_metadata_root</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span><span class="o">.</span><span class="n">items</span><span class="p">())[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the grid metadata as a dictionary.  Can be set, in which case</span>
<span class="sd">        the dictionary items passed will be added to, or replace existing metadata.</span>
<span class="sd">        </span>
<span class="sd">        .. seealso::</span>
<span class="sd">            `Geosoft metadata schema &lt;https://geosoftgxdev.atlassian.net/wiki/display/GXDEV92/Geosoft+Metadata+Schema&gt;`_     </span>

<span class="sd">        .. versionadded:: 9.2</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init_metadata</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_metadata_root</span><span class="p">]</span>

    <span class="nd">@metadata</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">meta</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init_metadata</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_metadata_root</span><span class="p">]</span> <span class="o">=</span> <span class="n">gxu</span><span class="o">.</span><span class="n">merge_dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_metadata_root</span><span class="p">],</span> <span class="n">meta</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_metadata_changed</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">unit_of_measure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Units of measurement (a string) for the grid data, can be set.</span>
<span class="sd">        </span>
<span class="sd">        .. versionadded:: 9.2</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">uom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;geosoft&#39;</span><span class="p">][</span><span class="s1">&#39;dataset&#39;</span><span class="p">][</span><span class="s1">&#39;geo:unitofmeasurement&#39;</span><span class="p">][</span><span class="s1">&#39;#text&#39;</span><span class="p">]</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
            <span class="n">uom</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">return</span> <span class="n">uom</span>

    <span class="nd">@unit_of_measure</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">unit_of_measure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uom</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;geosoft&#39;</span><span class="p">:</span>
                             <span class="p">{</span><span class="s1">&#39;@xmlns&#39;</span><span class="p">:</span> <span class="s1">&#39;http://www.geosoft.com/schema/geo&#39;</span><span class="p">,</span>
                              <span class="s1">&#39;dataset&#39;</span><span class="p">:</span>
                                  <span class="p">{</span><span class="s1">&#39;geo:unitofmeasurement&#39;</span><span class="p">:</span>
                                       <span class="p">{</span><span class="s1">&#39;@xmlns:geo&#39;</span><span class="p">:</span> <span class="s1">&#39;http://www.geosoft.com/schema/geo&#39;</span><span class="p">,</span>
                                        <span class="s1">&#39;#text&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">uom</span><span class="p">)}}}}</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">dtype</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        numpy data type for the grid</span>

<span class="sd">        .. versionadded:: 9.2</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dtype</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">gxtype</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Geosoft data type for the grid</span>

<span class="sd">        .. versionadded:: 9.2</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gxtype</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_int</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; returns True if base grid type is integer, which includes color integers&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_int</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">nx</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        grid x dimension (number of columns)</span>

<span class="sd">        .. versionadded:: 9.2</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_img</span><span class="o">.</span><span class="n">nx</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">ny</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        grid y dimension (number of rows)</span>

<span class="sd">        .. versionadded:: 9.2</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_img</span><span class="o">.</span><span class="n">ny</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">x0</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        grid origin x location in the plane coordinate system</span>

<span class="sd">        .. versionadded:: 9.2</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_img</span><span class="o">.</span><span class="n">query_double</span><span class="p">(</span><span class="n">gxapi</span><span class="o">.</span><span class="n">IMG_QUERY_rXO</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">y0</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        grid origin y location in the plane coordinate system</span>

<span class="sd">        .. versionadded:: 9.2</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_img</span><span class="o">.</span><span class="n">query_double</span><span class="p">(</span><span class="n">gxapi</span><span class="o">.</span><span class="n">IMG_QUERY_rYO</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">dx</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        separation between grid points in the grid x direction</span>

<span class="sd">        .. versionadded:: 9.2</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_img</span><span class="o">.</span><span class="n">query_double</span><span class="p">(</span><span class="n">gxapi</span><span class="o">.</span><span class="n">IMG_QUERY_rDX</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">dy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        separation between grid points in the grid y direction</span>

<span class="sd">        .. versionadded:: 9.2</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_img</span><span class="o">.</span><span class="n">query_double</span><span class="p">(</span><span class="n">gxapi</span><span class="o">.</span><span class="n">IMG_QUERY_rDY</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">rot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        grid rotation angle, degrees azimuth</span>
<span class="sd">        </span>
<span class="sd">        Note that grid rotations in the gxapi GXIMG are degrees clockwise, which is the opposite of</span>
<span class="sd">        degree azimuth, used here.  All horizontal plane angles in the Python gxpy module are degrees</span>
<span class="sd">        azimuth for consistency.</span>

<span class="sd">        .. versionadded:: 9.2</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">_img</span><span class="o">.</span><span class="n">query_double</span><span class="p">(</span><span class="n">gxapi</span><span class="o">.</span><span class="n">IMG_QUERY_rROT</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_color</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; returns True if grid contains colors. is_int will also be True&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_img</span><span class="o">.</span><span class="n">is_colour</span><span class="p">())</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">file_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        grid file name without decorations</span>

<span class="sd">        .. versionadded:: 9.2</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hgd</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hgd_name</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file_name</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">file_name_decorated</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        grid file name with decorations</span>

<span class="sd">        .. versionadded:: 9.2</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hgd</span><span class="p">:</span>
            <span class="n">decor</span> <span class="o">=</span> <span class="s1">&#39;HGD&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">decor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_decoration</span>
        <span class="k">return</span> <span class="n">decorate_name</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_name</span><span class="p">,</span> <span class="n">decor</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Grid name, usually the file name without path or extension.</span>
<span class="sd">        </span>
<span class="sd">        .. versionadded:: 9.2</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;None&#39;</span>
        <span class="n">basename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">basename</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">gridtype</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        grid type (e.g. &#39;GRD&#39;, &#39;HGD&#39; etc. &#39;MEMORY&#39; for in-memory grid)</span>

<span class="sd">        .. versionadded:: 9.2</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;MEMORY&#39;</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">ext</span><span class="p">,</span> <span class="n">dec</span> <span class="o">=</span> <span class="n">name_parts</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_file_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dec</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">dec</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ext</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">decoration</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        grid descriptive decoration</span>

<span class="sd">        .. versionadded:: 9.2</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_decoration</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">coordinate_system</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        grid coordinate system as a :class:`geosoft.gxpy.coordinate_system.Coordinate_system` instance.</span>

<span class="sd">        Can be set from any :class:`geosoft.gxpy.coordinate_system.Coordinate_system` constructor.</span>

<span class="sd">        .. versionadded:: 9.2</span>

<span class="sd">        .. versionchanged:: 9.3</span>
<span class="sd">            added ability to set directly</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ipj</span> <span class="o">=</span> <span class="n">gxapi</span><span class="o">.</span><span class="n">GXIPJ</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_img</span><span class="o">.</span><span class="n">get_ipj</span><span class="p">(</span><span class="n">ipj</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cs</span> <span class="o">=</span> <span class="n">gxcs</span><span class="o">.</span><span class="n">Coordinate_system</span><span class="p">(</span><span class="n">ipj</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cs</span>

    <span class="nd">@coordinate_system</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">coordinate_system</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cs</span> <span class="o">=</span> <span class="n">gxcs</span><span class="o">.</span><span class="n">Coordinate_system</span><span class="p">(</span><span class="n">cs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_img</span><span class="o">.</span><span class="n">set_ipj</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cs</span><span class="o">.</span><span class="n">gxipj</span><span class="p">)</span>

<div class="viewcode-block" id="Grid.properties"><a class="viewcode-back" href="../../../geosoft.gxpy.grid.html#geosoft.gxpy.grid.Grid.properties">[docs]</a>    <span class="k">def</span> <span class="nf">properties</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the grid properties dictionary</span>

<span class="sd">        :returns: dictionary of all grid properties</span>

<span class="sd">        .. versionadded:: 9.1</span>

<span class="sd">        .. versionchanged:: 9.4 added &#39;unit_of_measure&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">properties</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;nx&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">nx</span><span class="p">,</span>
                      <span class="s1">&#39;ny&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">ny</span><span class="p">,</span>
                      <span class="s1">&#39;x0&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">x0</span><span class="p">,</span>
                      <span class="s1">&#39;y0&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">y0</span><span class="p">,</span>
                      <span class="s1">&#39;dx&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dx</span><span class="p">,</span>
                      <span class="s1">&#39;dy&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dy</span><span class="p">,</span>
                      <span class="s1">&#39;rot&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">rot</span><span class="p">,</span>
                      <span class="s1">&#39;is_color&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_color</span><span class="p">,</span>
                      <span class="s1">&#39;dtype&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span>
                      <span class="s1">&#39;gridtype&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">gridtype</span><span class="p">,</span>
                      <span class="s1">&#39;decoration&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_decoration</span><span class="p">,</span>
                      <span class="s1">&#39;unit_of_measure&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit_of_measure</span><span class="p">,</span>
                      <span class="s1">&#39;coordinate_system&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">coordinate_system</span><span class="p">}</span>

        <span class="k">return</span> <span class="n">properties</span></div>

<div class="viewcode-block" id="Grid.statistics"><a class="viewcode-back" href="../../../geosoft.gxpy.grid.html#geosoft.gxpy.grid.Grid.statistics">[docs]</a>    <span class="k">def</span> <span class="nf">statistics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gxst</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate and return current grid data statistics as a dictionary.</span>

<span class="sd">        :param gxst:    gxapi.GXST instance, to which stats will be accumulated, or None.</span>

<span class="sd">        :returns: dictionary of grid data statistics:</span>

<span class="sd">        =============== ============================</span>
<span class="sd">        min             minimum</span>
<span class="sd">        max             maximum</span>
<span class="sd">        mean            mean</span>
<span class="sd">        geometric_mean  geometric mean</span>
<span class="sd">        variance        variance</span>
<span class="sd">        sd              standard deviation</span>
<span class="sd">        skew            skew</span>
<span class="sd">        kurtosis        kurtosis</span>
<span class="sd">        sum             sum of all data</span>
<span class="sd">        sum_power_2     sum of data**2</span>
<span class="sd">        sum_power_3     sum of data**3</span>
<span class="sd">        sum_power_4     sum of data**4</span>
<span class="sd">        num_data        number of valid data values</span>
<span class="sd">        num_dummy       number of dummy values</span>
<span class="sd">        =============== ============================</span>

<span class="sd">        .. versionadded:: 9.4</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">get_st</span><span class="p">(</span><span class="n">what</span><span class="p">):</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">gxst</span><span class="o">.</span><span class="n">get_info</span><span class="p">(</span><span class="n">what</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">v</span> <span class="o">==</span> <span class="n">gxapi</span><span class="o">.</span><span class="n">rDUMMY</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="k">return</span> <span class="n">v</span>

        <span class="k">if</span> <span class="n">gxst</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">gxst</span> <span class="o">=</span> <span class="n">gxapi</span><span class="o">.</span><span class="n">GXST</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>
        <span class="n">vv</span> <span class="o">=</span> <span class="n">gxvv</span><span class="o">.</span><span class="n">GXvv</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">iv</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gximg</span><span class="o">.</span><span class="n">nv</span><span class="p">()):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gximg</span><span class="o">.</span><span class="n">read_v</span><span class="p">(</span><span class="n">iv</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">vv</span><span class="o">.</span><span class="n">gxvv</span><span class="p">)</span>
            <span class="n">gxst</span><span class="o">.</span><span class="n">data_vv</span><span class="p">(</span><span class="n">vv</span><span class="o">.</span><span class="n">gxvv</span><span class="p">)</span>

        <span class="n">st</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;min&#39;</span><span class="p">:</span> <span class="n">get_st</span><span class="p">(</span><span class="n">gxapi</span><span class="o">.</span><span class="n">ST_MIN</span><span class="p">),</span>
              <span class="s1">&#39;max&#39;</span><span class="p">:</span> <span class="n">get_st</span><span class="p">(</span><span class="n">gxapi</span><span class="o">.</span><span class="n">ST_MAX</span><span class="p">),</span>
              <span class="s1">&#39;mean&#39;</span><span class="p">:</span> <span class="n">get_st</span><span class="p">(</span><span class="n">gxapi</span><span class="o">.</span><span class="n">ST_MEAN</span><span class="p">),</span>
              <span class="s1">&#39;geometric_mean&#39;</span><span class="p">:</span> <span class="n">get_st</span><span class="p">(</span><span class="n">gxapi</span><span class="o">.</span><span class="n">ST_GEOMEAN</span><span class="p">),</span>
              <span class="s1">&#39;variance&#39;</span><span class="p">:</span> <span class="n">get_st</span><span class="p">(</span><span class="n">gxapi</span><span class="o">.</span><span class="n">ST_VARIANCE</span><span class="p">),</span>
              <span class="s1">&#39;sd&#39;</span><span class="p">:</span> <span class="n">get_st</span><span class="p">(</span><span class="n">gxapi</span><span class="o">.</span><span class="n">ST_STDDEV</span><span class="p">),</span>
              <span class="s1">&#39;skew&#39;</span><span class="p">:</span> <span class="n">get_st</span><span class="p">(</span><span class="n">gxapi</span><span class="o">.</span><span class="n">ST_SKEW</span><span class="p">),</span>
              <span class="s1">&#39;kurtosis&#39;</span><span class="p">:</span> <span class="n">get_st</span><span class="p">(</span><span class="n">gxapi</span><span class="o">.</span><span class="n">ST_KURTOSIS</span><span class="p">),</span>
              <span class="s1">&#39;sum&#39;</span><span class="p">:</span> <span class="n">get_st</span><span class="p">(</span><span class="n">gxapi</span><span class="o">.</span><span class="n">ST_SUM</span><span class="p">),</span>
              <span class="s1">&#39;sum_power_2&#39;</span><span class="p">:</span> <span class="n">get_st</span><span class="p">(</span><span class="n">gxapi</span><span class="o">.</span><span class="n">ST_SUM2</span><span class="p">),</span>
              <span class="s1">&#39;sum_power_3&#39;</span><span class="p">:</span> <span class="n">get_st</span><span class="p">(</span><span class="n">gxapi</span><span class="o">.</span><span class="n">ST_SUM3</span><span class="p">),</span>
              <span class="s1">&#39;sum_power_4&#39;</span><span class="p">:</span> <span class="n">get_st</span><span class="p">(</span><span class="n">gxapi</span><span class="o">.</span><span class="n">ST_SUM4</span><span class="p">),</span>
              <span class="s1">&#39;num_data&#39;</span><span class="p">:</span> <span class="n">get_st</span><span class="p">(</span><span class="n">gxapi</span><span class="o">.</span><span class="n">ST_ITEMS</span><span class="p">),</span>
              <span class="s1">&#39;num_dummy&#39;</span><span class="p">:</span> <span class="n">get_st</span><span class="p">(</span><span class="n">gxapi</span><span class="o">.</span><span class="n">ST_DUMMIES</span><span class="p">)</span>
              <span class="p">}</span>

        <span class="k">return</span> <span class="n">st</span></div>

    <span class="nd">@x0</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">x0</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_img</span><span class="o">.</span><span class="n">set_info</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dy</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y0</span><span class="p">,</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">rot</span><span class="p">)</span>

    <span class="nd">@y0</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">y0</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_img</span><span class="o">.</span><span class="n">set_info</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x0</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">rot</span><span class="p">)</span>

    <span class="nd">@dx</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">dx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_img</span><span class="o">.</span><span class="n">set_info</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y0</span><span class="p">,</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">rot</span><span class="p">)</span>

    <span class="nd">@dy</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">dy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_img</span><span class="o">.</span><span class="n">set_info</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dx</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y0</span><span class="p">,</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">rot</span><span class="p">)</span>

    <span class="nd">@rot</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">rot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_img</span><span class="o">.</span><span class="n">set_info</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y0</span><span class="p">,</span> <span class="o">-</span><span class="n">v</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cos_rot</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sin_rot</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>

<div class="viewcode-block" id="Grid.set_properties"><a class="viewcode-back" href="../../../geosoft.gxpy.grid.html#geosoft.gxpy.grid.Grid.set_properties">[docs]</a>    <span class="k">def</span> <span class="nf">set_properties</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">properties</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set grid properties from a properties dict.  Settable property keys are:</span>

<span class="sd">            ==================== ============================================</span>
<span class="sd">            &#39;x0&#39;                 grid X origin location (default 0.0)</span>
<span class="sd">            &#39;y0&#39;                 grid Y origin location (0.0)</span>
<span class="sd">            &#39;dx&#39;                 grid X point separation (1.0)</span>
<span class="sd">            &#39;dy&#39;                 grid Y point separation (1.0)</span>
<span class="sd">            &#39;rot&#39;                grid rotation angle in degrees azimuth (0.0)</span>
<span class="sd">            &#39;unit_of_measure&#39;    unit of measure for the grid data</span>
<span class="sd">            &#39;coordinate_system&#39;  coordinate system (unchanged)</span>
<span class="sd">            ==================== ============================================</span>

<span class="sd">        Not all keys need be passed, though typically one will get the properties from</span>
<span class="sd">        the grid and modify those that need to change and pass the properties back.</span>

<span class="sd">        :param properties: properties dictionary</span>

<span class="sd">        .. versionadded:: 9.1</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_readonly</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">GridException</span><span class="p">(</span><span class="n">_t</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> opened as read-only, cannot set properties.&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_name_decorated</span><span class="p">))</span>

        <span class="n">dx</span> <span class="o">=</span> <span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;dx&#39;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="n">dy</span> <span class="o">=</span> <span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;dy&#39;</span><span class="p">,</span> <span class="n">dx</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_img</span><span class="o">.</span><span class="n">set_info</span><span class="p">(</span><span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span>
                           <span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;x0&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
                           <span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;y0&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
                           <span class="o">-</span><span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;rot&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rot</span>  <span class="c1"># calculates cos and sin</span>

        <span class="n">uom</span> <span class="o">=</span> <span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;unit_of_measure&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">uom</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">unit_of_measure</span> <span class="o">=</span> <span class="n">uom</span>

        <span class="n">cs</span> <span class="o">=</span> <span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;coordinate_system&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cs</span><span class="p">,</span> <span class="n">gxcs</span><span class="o">.</span><span class="n">Coordinate_system</span><span class="p">):</span>
                <span class="n">cs</span> <span class="o">=</span> <span class="n">gxcs</span><span class="o">.</span><span class="n">Coordinate_system</span><span class="p">(</span><span class="n">cs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_img</span><span class="o">.</span><span class="n">set_ipj</span><span class="p">(</span><span class="n">cs</span><span class="o">.</span><span class="n">gxipj</span><span class="p">)</span></div>

<div class="viewcode-block" id="Grid.write_rows"><a class="viewcode-back" href="../../../geosoft.gxpy.grid.html#geosoft.gxpy.grid.Grid.write_rows">[docs]</a>    <span class="k">def</span> <span class="nf">write_rows</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">ix0</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">iy0</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write data to a grid by rows.</span>

<span class="sd">        :param data:    array of data to write, numpy, list or `geosoft.gxapi.GXPG`</span>
<span class="sd">        :param ix0:     grid X index of first point</span>
<span class="sd">        :param iy0:     grid Y index of first point, top index if writing rows top to bottom</span>
<span class="sd">        :param order:   1: bottom to top; -1: top to bottom</span>

<span class="sd">        .. versionadded:: 9.1</span>

<span class="sd">        .. versionchanged:: 9.4 accepts list or GXPG</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">gxapi</span><span class="o">.</span><span class="n">GXPG</span><span class="p">):</span>
            <span class="n">nx</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">n_cols</span><span class="p">()</span>
            <span class="n">ny</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">n_rows</span><span class="p">()</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="n">ny</span><span class="p">,</span> <span class="n">nx</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span>

        <span class="k">if</span> <span class="p">((</span><span class="n">nx</span> <span class="o">-</span> <span class="n">ix0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">nx</span><span class="p">)</span> <span class="ow">or</span> <span class="p">((</span><span class="n">ny</span> <span class="o">-</span> <span class="n">iy0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">ny</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">GridException</span><span class="p">(</span><span class="n">_t</span><span class="p">(</span><span class="s1">&#39;Data size exceeds grid size.&#39;</span><span class="p">))</span>

        <span class="n">dvv</span> <span class="o">=</span> <span class="n">gxvv</span><span class="o">.</span><span class="n">GXvv</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
        <span class="n">dvv</span><span class="o">.</span><span class="n">length</span> <span class="o">=</span> <span class="n">nx</span>
        <span class="n">iy</span> <span class="o">=</span> <span class="n">iy0</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ny</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">gxapi</span><span class="o">.</span><span class="n">GXPG</span><span class="p">):</span>
                <span class="n">data</span><span class="o">.</span><span class="n">read_row</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">dvv</span><span class="o">.</span><span class="n">gxvv</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">dvv</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_img</span><span class="o">.</span><span class="n">write_y</span><span class="p">(</span><span class="n">iy</span><span class="p">,</span> <span class="n">ix0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">dvv</span><span class="o">.</span><span class="n">gxvv</span><span class="p">)</span>
            <span class="n">iy</span> <span class="o">+=</span> <span class="n">order</span></div>

<div class="viewcode-block" id="Grid.read_row"><a class="viewcode-back" href="../../../geosoft.gxpy.grid.html#geosoft.gxpy.grid.Grid.read_row">[docs]</a>    <span class="k">def</span> <span class="nf">read_row</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :param row:     row to read, if not specified the next row is read starting from row 0</span>
<span class="sd">        :param start:   the first point in the row, default is 0</span>
<span class="sd">        :param length:  number of points to read, the default is to the end of the row.</span>
<span class="sd">        :return:        :class:`geosoft.gxvv.GXvv` instance</span>

<span class="sd">        .. versionadded:: 9.1</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">row</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_next_row</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_next_row</span> <span class="o">=</span> <span class="n">row</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_next_row</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">ny</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_next_row</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="n">row</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ny</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">GridException</span><span class="p">(</span><span class="n">_t</span><span class="p">(</span><span class="s1">&#39;Attempt to read row </span><span class="si">{}</span><span class="s1"> past the last row </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ny</span><span class="p">)))</span>
        <span class="n">vv</span> <span class="o">=</span> <span class="n">gxvv</span><span class="o">.</span><span class="n">GXvv</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">length</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">length</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_img</span><span class="o">.</span><span class="n">read_y</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">vv</span><span class="o">.</span><span class="n">gxvv</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">vv</span></div>

<div class="viewcode-block" id="Grid.read_column"><a class="viewcode-back" href="../../../geosoft.gxpy.grid.html#geosoft.gxpy.grid.Grid.read_column">[docs]</a>    <span class="k">def</span> <span class="nf">read_column</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :param column:  column to read, if not specified the next column is read starting from column 0</span>
<span class="sd">        :param start:   the first point in the column, default is 0</span>
<span class="sd">        :param length:  number of points to read, the default is to the end of the col.</span>
<span class="sd">        :return:        :class:`geosoft.gxvv.GXvv` instance</span>

<span class="sd">        .. versionadded:: 9.1</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">column</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">column</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_next_col</span>
        <span class="k">if</span> <span class="n">column</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nx</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">GridException</span><span class="p">(</span><span class="n">_t</span><span class="p">(</span><span class="s1">&#39;Attempt to read column </span><span class="si">{}</span><span class="s1"> past the last column </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ny</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_next_col</span> <span class="o">=</span> <span class="n">column</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_next_col</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">nx</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_next_col</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">vv</span> <span class="o">=</span> <span class="n">gxvv</span><span class="o">.</span><span class="n">GXvv</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_img</span><span class="o">.</span><span class="n">read_x</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">vv</span><span class="o">.</span><span class="n">gxvv</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">vv</span></div>

<div class="viewcode-block" id="Grid.write_row"><a class="viewcode-back" href="../../../geosoft.gxpy.grid.html#geosoft.gxpy.grid.Grid.write_row">[docs]</a>    <span class="k">def</span> <span class="nf">write_row</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :param data:    data to write, `geosoft.gxpy.vv.GXvv` instance or an array</span>
<span class="sd">        :param row:     row to write, if not specified the next row is written starting from row 0</span>
<span class="sd">        :param start:   the first point in the row, default is 0</span>
<span class="sd">        :param length:  number of points to read, the default is to the end of the row.</span>

<span class="sd">        .. versionadded:: 9.4</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">gxvv</span><span class="o">.</span><span class="n">GXvv</span><span class="p">):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">gxvv</span><span class="o">.</span><span class="n">GXvv</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">row</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_next_row</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_next_row</span> <span class="o">=</span> <span class="n">row</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_next_row</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">ny</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_next_row</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="n">row</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ny</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">GridException</span><span class="p">(</span><span class="n">_t</span><span class="p">(</span><span class="s1">&#39;Attempt to read row </span><span class="si">{}</span><span class="s1"> past the last row </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ny</span><span class="p">)))</span>
        <span class="k">if</span> <span class="n">length</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">length</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_img</span><span class="o">.</span><span class="n">write_y</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">gxvv</span><span class="p">)</span></div>

<div class="viewcode-block" id="Grid.write_column"><a class="viewcode-back" href="../../../geosoft.gxpy.grid.html#geosoft.gxpy.grid.Grid.write_column">[docs]</a>    <span class="k">def</span> <span class="nf">write_column</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :param data:    data to write, `geosoft.gxpy.vv.GXvv` instance or an array</span>
<span class="sd">        :param column:  column to write, if not specified the next column is written starting from column 0</span>
<span class="sd">        :param start:   the first point in the column, default is 0</span>
<span class="sd">        :param length:  number of points to write, the default is to the end of the row.</span>

<span class="sd">        .. versionadded:: 9.4</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">gxvv</span><span class="o">.</span><span class="n">GXvv</span><span class="p">):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">gxvv</span><span class="o">.</span><span class="n">GXvv</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">column</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">column</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_next_col</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_next_col</span> <span class="o">=</span> <span class="n">column</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_next_col</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">nx</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_next_col</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="n">column</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nx</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">GridException</span><span class="p">(</span><span class="n">_t</span><span class="p">(</span><span class="s1">&#39;Attempt to read column </span><span class="si">{}</span><span class="s1"> past the last column </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nx</span><span class="p">)))</span>
        <span class="k">if</span> <span class="n">length</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">length</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_img</span><span class="o">.</span><span class="n">write_x</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">gxvv</span><span class="p">)</span></div>

<div class="viewcode-block" id="Grid.reset_read_write"><a class="viewcode-back" href="../../../geosoft.gxpy.grid.html#geosoft.gxpy.grid.Grid.reset_read_write">[docs]</a>    <span class="k">def</span> <span class="nf">reset_read_write</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Reset the default read/write to the grid row 0, column 0. &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_next</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_next_col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_next_row</span> <span class="o">=</span> <span class="mi">0</span></div>

<div class="viewcode-block" id="Grid.name_parts"><a class="viewcode-back" href="../../../geosoft.gxpy.grid.html#geosoft.gxpy.grid.Grid.name_parts">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">name_parts</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        .. deprecated:: 9.2 use gxpy.grid.name_parts()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">name_parts</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></div>

<div class="viewcode-block" id="Grid.decorate_name"><a class="viewcode-back" href="../../../geosoft.gxpy.grid.html#geosoft.gxpy.grid.Grid.decorate_name">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">decorate_name</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">decorations</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        .. deprecated:: 9.2 use gxpy.grid.name_parts()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">decorate_name</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">decorations</span><span class="p">)</span></div>

<div class="viewcode-block" id="Grid.indexWindow"><a class="viewcode-back" href="../../../geosoft.gxpy.grid.html#geosoft.gxpy.grid.Grid.indexWindow">[docs]</a>    <span class="k">def</span> <span class="nf">indexWindow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">x0</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">y0</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">nx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ny</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        .. deprecated:: 9.2 gxpy.Grid.index_window()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_window</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">nx</span><span class="p">,</span> <span class="n">ny</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="Grid.xy_from_index"><a class="viewcode-back" href="../../../geosoft.gxpy.grid.html#geosoft.gxpy.grid.Grid.xy_from_index">[docs]</a>    <span class="k">def</span> <span class="nf">xy_from_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ix</span><span class="p">,</span> <span class="n">iy</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the rotated location of grid index ix, iy</span>

<span class="sd">        :param ix:  grid index x</span>
<span class="sd">        :param iy:  grid index y</span>

<span class="sd">        .. versionadded:: 9.4</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">rotate</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
            <span class="n">x</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x0</span>
            <span class="n">y</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y0</span>
            <span class="n">_x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cos_rot</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sin_rot</span>
            <span class="n">_y</span> <span class="o">=</span> <span class="o">-</span><span class="n">x</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sin_rot</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cos_rot</span>
            <span class="k">return</span> <span class="n">_x</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">x0</span><span class="p">,</span> <span class="n">_y</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">y0</span>

        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x0</span> <span class="o">+</span> <span class="p">(</span><span class="n">ix</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dx</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y0</span> <span class="o">+</span> <span class="p">(</span><span class="n">iy</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dy</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rot</span> <span class="o">!=</span> <span class="mf">0.</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">rotate</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span></div>

<div class="viewcode-block" id="Grid.extent_2d"><a class="viewcode-back" href="../../../geosoft.gxpy.grid.html#geosoft.gxpy.grid.Grid.extent_2d">[docs]</a>    <span class="k">def</span> <span class="nf">extent_2d</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the 2D extent of the grid on the grid plane.</span>

<span class="sd">        Extent is to the outer edge of grid &quot;cells&quot;, which extend half a cell beyond the edge points.</span>

<span class="sd">        :returns:(min_x, min_y, max_x, max_y)</span>

<span class="sd">        .. versionadded:: 9.2</span>

<span class="sd">        .. versionchanged:: 9.4 - extent to the cell edges.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xy_from_index</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xy_from_index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nx</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ny</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rot</span> <span class="o">!=</span> <span class="mf">0.</span><span class="p">:</span>
            <span class="n">xx0</span><span class="p">,</span> <span class="n">yy0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xy_from_index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nx</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">)</span>
            <span class="n">xx1</span><span class="p">,</span> <span class="n">yy1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xy_from_index</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ny</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)</span>
            <span class="n">min_x</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">xx0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">xx1</span><span class="p">)</span>
            <span class="n">min_y</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">y0</span><span class="p">,</span> <span class="n">yy0</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">yy1</span><span class="p">)</span>
            <span class="n">max_x</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">xx0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">xx1</span><span class="p">)</span>
            <span class="n">max_y</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">y0</span><span class="p">,</span> <span class="n">yy0</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">yy1</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">min_x</span><span class="p">,</span> <span class="n">min_y</span><span class="p">,</span> <span class="n">max_x</span><span class="p">,</span> <span class="n">max_y</span>

        <span class="k">return</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span></div>

<div class="viewcode-block" id="Grid.extent_point_2d"><a class="viewcode-back" href="../../../geosoft.gxpy.grid.html#geosoft.gxpy.grid.Grid.extent_point_2d">[docs]</a>    <span class="k">def</span> <span class="nf">extent_point_2d</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the 2D extent of the grid point (cell centers) on the grid plane.</span>

<span class="sd">        :returns:(min_x, min_y, max_x, max_y)</span>

<span class="sd">        .. versionadded:: 9.4</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y0</span>
        <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xy_from_index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ny</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rot</span> <span class="o">!=</span> <span class="mf">0.</span><span class="p">:</span>
            <span class="n">xx0</span><span class="p">,</span> <span class="n">yy0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xy_from_index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">xx1</span><span class="p">,</span> <span class="n">yy1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xy_from_index</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ny</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">min_x</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">xx0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">xx1</span><span class="p">)</span>
            <span class="n">min_y</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">y0</span><span class="p">,</span> <span class="n">yy0</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">yy1</span><span class="p">)</span>
            <span class="n">max_x</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">xx0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">xx1</span><span class="p">)</span>
            <span class="n">max_y</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">y0</span><span class="p">,</span> <span class="n">yy0</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">yy1</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">min_x</span><span class="p">,</span> <span class="n">min_y</span><span class="p">,</span> <span class="n">max_x</span><span class="p">,</span> <span class="n">max_y</span>

        <span class="k">return</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span></div>

<div class="viewcode-block" id="Grid.extent_cell_2d"><a class="viewcode-back" href="../../../geosoft.gxpy.grid.html#geosoft.gxpy.grid.Grid.extent_cell_2d">[docs]</a>    <span class="k">def</span> <span class="nf">extent_cell_2d</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        .. deprecated:: 9.4 - same as `extent_2d()`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">extent_2d</span><span class="p">()</span></div>

<div class="viewcode-block" id="Grid.extent_3d"><a class="viewcode-back" href="../../../geosoft.gxpy.grid.html#geosoft.gxpy.grid.Grid.extent_3d">[docs]</a>    <span class="k">def</span> <span class="nf">extent_3d</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the 3D extent of the grid in the base coordinate system.</span>

<span class="sd">        :returns: (min_x, min_y, min_z, max_x, max_y, max_z)</span>

<span class="sd">        .. versionadded:: 9.2</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">cs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coordinate_system</span>
        <span class="n">ex2d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extent_2d</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_crooked_path</span><span class="p">:</span>
            <span class="n">min_x</span><span class="p">,</span> <span class="n">min_y</span><span class="p">,</span> <span class="n">max_x</span><span class="p">,</span> <span class="n">max_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">crooked_path</span><span class="p">()</span><span class="o">.</span><span class="n">extent_xy</span>
            <span class="n">min_z</span> <span class="o">=</span> <span class="n">cs</span><span class="o">.</span><span class="n">xyz_from_oriented</span><span class="p">((</span><span class="n">ex2d</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ex2d</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mf">0.0</span><span class="p">))[</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">max_z</span> <span class="o">=</span> <span class="n">cs</span><span class="o">.</span><span class="n">xyz_from_oriented</span><span class="p">((</span><span class="n">ex2d</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ex2d</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="mf">0.0</span><span class="p">))[</span><span class="mi">2</span><span class="p">]</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">xyz0</span> <span class="o">=</span> <span class="n">cs</span><span class="o">.</span><span class="n">xyz_from_oriented</span><span class="p">((</span><span class="n">ex2d</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ex2d</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mf">0.0</span><span class="p">))</span>
            <span class="n">xyz1</span> <span class="o">=</span> <span class="n">cs</span><span class="o">.</span><span class="n">xyz_from_oriented</span><span class="p">((</span><span class="n">ex2d</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">ex2d</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mf">0.0</span><span class="p">))</span>
            <span class="n">xyz2</span> <span class="o">=</span> <span class="n">cs</span><span class="o">.</span><span class="n">xyz_from_oriented</span><span class="p">((</span><span class="n">ex2d</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">ex2d</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="mf">0.0</span><span class="p">))</span>
            <span class="n">xyz3</span> <span class="o">=</span> <span class="n">cs</span><span class="o">.</span><span class="n">xyz_from_oriented</span><span class="p">((</span><span class="n">ex2d</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ex2d</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="mf">0.0</span><span class="p">))</span>

            <span class="n">min_x</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">xyz0</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xyz1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xyz2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xyz3</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">min_y</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">xyz0</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">xyz1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">xyz2</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">xyz3</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">min_z</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">xyz0</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">xyz1</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">xyz2</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">xyz3</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">max_x</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">xyz0</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xyz1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xyz2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xyz3</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">max_y</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">xyz0</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">xyz1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">xyz2</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">xyz3</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">max_z</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">xyz0</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">xyz1</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">xyz2</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">xyz3</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">min_x</span><span class="p">,</span> <span class="n">min_y</span><span class="p">,</span> <span class="n">min_z</span><span class="p">,</span> <span class="n">max_x</span><span class="p">,</span> <span class="n">max_y</span><span class="p">,</span> <span class="n">max_z</span></div>

<div class="viewcode-block" id="Grid.extent_cell_3d"><a class="viewcode-back" href="../../../geosoft.gxpy.grid.html#geosoft.gxpy.grid.Grid.extent_cell_3d">[docs]</a>    <span class="k">def</span> <span class="nf">extent_cell_3d</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        .. deprecated:: 9.4 - same as `extent_3d()`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">extent_3d</span><span class="p">()</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">extent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Grid cell extent as `geosoft.gxpy.geometry.Point2`.</span>

<span class="sd">        .. versionadded:: 9.3.1</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">gxgm</span><span class="o">.</span><span class="n">Point2</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">extent_3d</span><span class="p">()),</span> <span class="n">coordinate_system</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">coordinate_system</span><span class="p">)</span>

<div class="viewcode-block" id="Grid.np"><a class="viewcode-back" href="../../../geosoft.gxpy.grid.html#geosoft.gxpy.grid.Grid.np">[docs]</a>    <span class="k">def</span> <span class="nf">np</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a numpy array of grid values in the working dtype.</span>

<span class="sd">        :param dtype:   desired data type, default is the work_dtype, ignored for color grids</span>

<span class="sd">        :returns: numpy array shape (nx, ny) or (nx, ny, 4) containing RGBA bytes in case of color grids</span>

<span class="sd">        .. versionadded:: 9.3.1</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">nx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nx</span>
        <span class="n">ny</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ny</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_color</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">ny</span><span class="p">,</span> <span class="n">nx</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">dtype</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">dtype</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">ny</span><span class="p">,</span> <span class="n">nx</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gximg</span><span class="o">.</span><span class="n">query_kx</span><span class="p">()</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nx</span><span class="p">):</span>
                <span class="n">column</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_column</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">np</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_color</span><span class="p">:</span>
                    <span class="n">column</span> <span class="o">=</span> <span class="n">_transform_color_int_to_rgba</span><span class="p">(</span><span class="n">column</span><span class="p">)</span>
                <span class="n">data</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">column</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ny</span><span class="p">):</span>
                <span class="n">row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_row</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">np</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_color</span><span class="p">:</span>
                    <span class="n">row</span> <span class="o">=</span> <span class="n">_transform_color_int_to_rgba</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
                <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">row</span>

        <span class="k">return</span> <span class="n">data</span></div>

<div class="viewcode-block" id="Grid.xyzv"><a class="viewcode-back" href="../../../geosoft.gxpy.grid.html#geosoft.gxpy.grid.Grid.xyzv">[docs]</a>    <span class="k">def</span> <span class="nf">xyzv</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a numpy float array of (x, y, z, v) grid points.</span>

<span class="sd">        x, y, z) is the location of each grid point in 3D space and v is the grid value at that location.</span>
<span class="sd">        Dummies will be numpy.nan.</span>

<span class="sd">        :returns: numpy array shape (nx, ny, 4)</span>

<span class="sd">        .. versionadded:: 9.2</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">nx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nx</span>
        <span class="n">ny</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ny</span>
        <span class="n">dx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dx</span>
        <span class="n">dy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dy</span>
        <span class="n">cs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coordinate_system</span>
        <span class="n">xyzv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">ny</span><span class="p">,</span> <span class="n">nx</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
        <span class="n">xyzv</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mgrid</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span> <span class="p">(</span><span class="n">nx</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">*</span> <span class="n">dx</span><span class="p">:</span> <span class="n">dx</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span> <span class="p">(</span><span class="n">ny</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">*</span> <span class="n">dy</span><span class="p">:</span> <span class="n">dy</span><span class="p">]</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rot</span> <span class="o">!=</span> <span class="mf">0.</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">xyzv</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">cosx</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cos_rot</span>
            <span class="n">sinx</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sin_rot</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">xyzv</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">cosy</span> <span class="o">=</span> <span class="n">y</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cos_rot</span>
            <span class="n">siny</span> <span class="o">=</span> <span class="n">y</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sin_rot</span>
            <span class="n">xyzv</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">cosx</span> <span class="o">+</span> <span class="n">siny</span>
            <span class="n">xyzv</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">cosy</span> <span class="o">-</span> <span class="n">sinx</span>

        <span class="n">xyzv</span> <span class="o">+=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">cs</span><span class="o">.</span><span class="n">is_oriented</span><span class="p">:</span>
            <span class="n">xyzv</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">cs</span><span class="o">.</span><span class="n">xyz_from_oriented</span><span class="p">(</span><span class="n">xyzv</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">ny</span><span class="p">,</span> <span class="n">nx</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gximg</span><span class="o">.</span><span class="n">query_kx</span><span class="p">()</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nx</span><span class="p">):</span>
                <span class="n">xyzv</span><span class="p">[:,</span> <span class="n">i</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_column</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">np</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ny</span><span class="p">):</span>
                <span class="n">xyzv</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_row</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">np</span>

        <span class="k">return</span> <span class="n">xyzv</span></div>

<div class="viewcode-block" id="Grid.xyz"><a class="viewcode-back" href="../../../geosoft.gxpy.grid.html#geosoft.gxpy.grid.Grid.xyz">[docs]</a>    <span class="k">def</span> <span class="nf">xyz</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the (x, y, z) location of an indexed point in the grid.</span>

<span class="sd">        :param item: tuple (ix, iy) grid point, or the point number counting by row</span>
<span class="sd">        :return: tuple (x, y, z) location</span>

<span class="sd">        .. versionadded:: 9.2.1</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">ix</span> <span class="o">=</span> <span class="n">item</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">nx</span>
            <span class="n">iy</span> <span class="o">=</span> <span class="n">item</span> <span class="o">//</span> <span class="bp">self</span><span class="o">.</span><span class="n">nx</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ix</span><span class="p">,</span> <span class="n">iy</span> <span class="o">=</span> <span class="n">item</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffered_xy</span> <span class="o">!=</span> <span class="n">iy</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_buffered_xy</span> <span class="o">=</span> <span class="n">iy</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_buffer_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nx</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_buffer_x</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dx</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_buffer_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nx</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_buffer_y</span> <span class="o">+=</span> <span class="n">iy</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dy</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rot</span> <span class="o">!=</span> <span class="mf">0.</span><span class="p">:</span>
                <span class="n">rx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer_x</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cos_rot</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer_y</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sin_rot</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_buffer_y</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer_y</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cos_rot</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_buffer_y</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer_x</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sin_rot</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_buffer_x</span> <span class="o">=</span> <span class="n">rx</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_buffer_x</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_buffer_y</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y0</span>

        <span class="n">ggx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer_x</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span>
        <span class="n">ggy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer_y</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span>
        <span class="n">ggz</span> <span class="o">=</span> <span class="mf">0.</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">coordinate_system</span><span class="o">.</span><span class="n">is_oriented</span><span class="p">:</span>
            <span class="n">ggx</span><span class="p">,</span> <span class="n">ggy</span><span class="p">,</span> <span class="n">ggz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coordinate_system</span><span class="o">.</span><span class="n">xyz_from_oriented</span><span class="p">((</span><span class="n">ggx</span><span class="p">,</span> <span class="n">ggy</span><span class="p">,</span> <span class="n">ggz</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">ggx</span><span class="p">,</span> <span class="n">ggy</span><span class="p">,</span> <span class="n">ggz</span></div>

<div class="viewcode-block" id="Grid.image_file"><a class="viewcode-back" href="../../../geosoft.gxpy.grid.html#geosoft.gxpy.grid.Grid.image_file">[docs]</a>    <span class="k">def</span> <span class="nf">image_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image_file_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">image_type</span><span class="o">=</span><span class="n">gxmap</span><span class="o">.</span><span class="n">RASTER_FORMAT_PNG</span><span class="p">,</span> <span class="n">pix_width</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                   <span class="n">shade</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">color_map</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">contour</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">display_area</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pix_32_bit</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save as a georeferenced image file.</span>

<span class="sd">        :param image_file_name:  image file name. The extension should be consistent with the image_type.</span>
<span class="sd">                            If not specified a temporary PNG file is created.</span>
<span class="sd">        :param image_type:  image type, one ot the RASTER_FORMAT constants in `geosoft.gxpy.map`.</span>
<span class="sd">        :param pix_width:   desired image width in pixels, default is the width of the aggregate base layer</span>
<span class="sd">        :param shade:       `True` to add shading effect</span>
<span class="sd">        :param color_map:   `geosoft.gxpy.group.Color_map` instance, or a colour ramp file name,</span>
<span class="sd">                            default is grid&#39;s default</span>
<span class="sd">        :param contour:     colour contour interval if colours need to break at exact levels</span>
<span class="sd">        :param display_area:    `geosoft.gxpy.geometry.Point2` instance, which defines the desired display</span>
<span class="sd">                                area. The display area coordinate system can be different from the grid.</span>
<span class="sd">        :param pix_32_bit:  make 32-bit image (with 8-bit alpha background)</span>
<span class="sd">        :return:            image file name.</span>

<span class="sd">        .. seealso:: `geosoft.gxpy.grid.image_file`, which creates an image directly from a grid file.</span>

<span class="sd">        .. Note:: Unless read-only this method saves the grid as a temporary file from which an aggregate and image are</span>
<span class="sd">            created. If the grid already exists as a grid file it is more efficient to call</span>
<span class="sd">            `geosoft.gxpy.grid.image_file`.</span>

<span class="sd">        .. versionadded:: 9.3.1</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">temp_grid</span> <span class="o">=</span> <span class="n">gx</span><span class="o">.</span><span class="n">gx</span><span class="p">()</span><span class="o">.</span><span class="n">temp_file</span><span class="p">(</span><span class="s1">&#39;grd&#39;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mode</span> <span class="o">==</span> <span class="n">FILE_READ</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">grd_decorated</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_name_decorated</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">temp_grid</span><span class="p">)</span> <span class="k">as</span> <span class="n">g</span><span class="p">:</span>
                    <span class="n">grd_decorated</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">file_name_decorated</span>

            <span class="k">if</span> <span class="n">color_map</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">color_map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_default_color_map</span><span class="p">()</span>

            <span class="n">imagefile</span> <span class="o">=</span> <span class="n">image_file</span><span class="p">(</span><span class="n">grd_decorated</span><span class="p">,</span>
                                   <span class="n">image_file</span><span class="o">=</span><span class="n">image_file_name</span><span class="p">,</span>
                                   <span class="n">image_type</span><span class="o">=</span><span class="n">image_type</span><span class="p">,</span>
                                   <span class="n">pix_width</span><span class="o">=</span><span class="n">pix_width</span><span class="p">,</span>
                                   <span class="n">shade</span><span class="o">=</span><span class="n">shade</span><span class="p">,</span>
                                   <span class="n">color_map</span><span class="o">=</span><span class="n">color_map</span><span class="p">,</span>
                                   <span class="n">contour</span><span class="o">=</span><span class="n">contour</span><span class="p">,</span>
                                   <span class="n">display_area</span><span class="o">=</span><span class="n">display_area</span><span class="p">,</span>
                                   <span class="n">pix_32_bit</span><span class="o">=</span><span class="n">pix_32_bit</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">delete_files</span><span class="p">(</span><span class="n">temp_grid</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">imagefile</span></div>

<div class="viewcode-block" id="Grid.generate_color_map"><a class="viewcode-back" href="../../../geosoft.gxpy.grid.html#geosoft.gxpy.grid.Grid.generate_color_map">[docs]</a>    <span class="k">def</span> <span class="nf">generate_color_map</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">gxapi</span><span class="o">.</span><span class="n">ITR_ZONE_DEFAULT</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate color map for grid based on statistics and method</span>

<span class="sd">        :param      method:  :ref:`ITR_ZONE`</span>
<span class="sd">        :return:    A `geosoft.gxpy.group.Color_map` instance.</span>

<span class="sd">        .. versionadded:: 9.4.0</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">itr</span> <span class="o">=</span> <span class="n">gxapi</span><span class="o">.</span><span class="n">GXITR</span><span class="o">.</span><span class="n">create_img</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_img</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">gxapi</span><span class="o">.</span><span class="n">rDUMMY</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">geosoft</span><span class="o">.</span><span class="n">gxpy</span><span class="o">.</span><span class="n">group</span><span class="o">.</span><span class="n">Color_map</span><span class="p">(</span><span class="n">itr</span><span class="p">)</span></div>

<div class="viewcode-block" id="Grid.get_default_color_map"><a class="viewcode-back" href="../../../geosoft.gxpy.grid.html#geosoft.gxpy.grid.Grid.get_default_color_map">[docs]</a>    <span class="k">def</span> <span class="nf">get_default_color_map</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get default color map for grid</span>

<span class="sd">        :return:  A `geosoft.gxpy.group.Color_map` instance.</span>

<span class="sd">        .. versionadded:: 9.4.0</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">itr</span> <span class="o">=</span> <span class="n">gxapi</span><span class="o">.</span><span class="n">GXITR</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>
        <span class="k">if</span> <span class="mi">1</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_img</span><span class="o">.</span><span class="n">get_def_itr</span><span class="p">(</span><span class="n">itr</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_color_map</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">geosoft</span><span class="o">.</span><span class="n">gxpy</span><span class="o">.</span><span class="n">group</span><span class="o">.</span><span class="n">Color_map</span><span class="p">(</span><span class="n">itr</span><span class="p">)</span></div>


<div class="viewcode-block" id="Grid.mask"><a class="viewcode-back" href="../../../geosoft.gxpy.grid.html#geosoft.gxpy.grid.Grid.mask">[docs]</a>    <span class="k">def</span> <span class="nf">mask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mask</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Mask against blank areas in `mask` grid.  Both grids must be same dimension.</span>

<span class="sd">        :param mask:  reference mask grid, file of `Grid` instance.</span>

<span class="sd">        .. versionadded:: 9.4</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">Grid</span><span class="p">):</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="n">Grid</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nx</span> <span class="o">!=</span> <span class="n">mask</span><span class="o">.</span><span class="n">nx</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">ny</span> <span class="o">!=</span> <span class="n">mask</span><span class="o">.</span><span class="n">ny</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">GridException</span><span class="p">(</span><span class="n">_t</span><span class="p">(</span><span class="s1">&#39;Grids dimensions do not match&#39;</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ny</span><span class="p">):</span>
            <span class="n">mr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_row</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
            <span class="n">mr</span><span class="o">.</span><span class="n">gxvv</span><span class="o">.</span><span class="n">mask</span><span class="p">(</span><span class="n">mask</span><span class="o">.</span><span class="n">read_row</span><span class="p">(</span><span class="n">row</span><span class="p">)</span><span class="o">.</span><span class="n">gxvv</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write_row</span><span class="p">(</span><span class="n">mr</span><span class="p">,</span> <span class="n">row</span><span class="p">)</span></div></div>


<span class="c1"># grid utilities</span>
<div class="viewcode-block" id="array_locations"><a class="viewcode-back" href="../../../geosoft.gxpy.grid.html#geosoft.gxpy.grid.array_locations">[docs]</a><span class="k">def</span> <span class="nf">array_locations</span><span class="p">(</span><span class="n">properties</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create an array of (x,y,z) points for a grid defined by properties</span>
<span class="sd">    :param properties:  grid properties</span>
<span class="sd">    :returns:           array of points, shaped (ny, nx, 3)</span>

<span class="sd">    .. versionadded:: 9.1</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">with</span> <span class="n">Grid</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">properties</span><span class="o">=</span><span class="n">properties</span><span class="p">)</span> <span class="k">as</span> <span class="n">g</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">g</span><span class="o">.</span><span class="n">xyzv</span><span class="p">()[:,</span> <span class="p">:,</span> <span class="p">:</span><span class="mi">3</span><span class="p">]</span></div>


<div class="viewcode-block" id="gridMosaic"><a class="viewcode-back" href="../../../geosoft.gxpy.grid.html#geosoft.gxpy.grid.gridMosaic">[docs]</a><span class="k">def</span> <span class="nf">gridMosaic</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    .. deprecated:: 9.2 use :py:method: grid_mosaic</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">grid_mosaic</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="grid_mosaic"><a class="viewcode-back" href="../../../geosoft.gxpy.grid.html#geosoft.gxpy.grid.grid_mosaic">[docs]</a><span class="k">def</span> <span class="nf">grid_mosaic</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    .. deprecated:: 9.4 use `geosoft.gxpy.grid_utility.grid_mosaic`</span>
<span class="sd">    &quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="gridBool"><a class="viewcode-back" href="../../../geosoft.gxpy.grid.html#geosoft.gxpy.grid.gridBool">[docs]</a><span class="k">def</span> <span class="nf">gridBool</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    .. deprecated:: 9.2 use `grid_bool`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">grid_bool</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="grid_bool"><a class="viewcode-back" href="../../../geosoft.gxpy.grid.html#geosoft.gxpy.grid.grid_bool">[docs]</a><span class="k">def</span> <span class="nf">grid_bool</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    .. deprecated:: 9.4 use `geosoft.gxpy.grid_utility.grid_bool`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">gxgrdu</span><span class="o">.</span><span class="n">grid_bool</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="figure_map"><a class="viewcode-back" href="../../../geosoft.gxpy.grid.html#geosoft.gxpy.grid.figure_map">[docs]</a><span class="k">def</span> <span class="nf">figure_map</span><span class="p">(</span><span class="n">grid_file</span><span class="p">,</span> <span class="n">map_file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">shade</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color_map</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">contour</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a map figure from a grid file.</span>

<span class="sd">    :param grid_file:   grid file name</span>
<span class="sd">    :param map_file:    name of the map file, if `None` a default map is created.</span>
<span class="sd">    :param shade:       `True` to add shading effect</span>
<span class="sd">    :param color_map:   `geosoft.gxpy.group.Color_map` instance, or a colour ramp file name, default is user&#39;s default</span>
<span class="sd">    :param contour:     colour contour interval if colours need to break at exact levels</span>
<span class="sd">    :param kwargs:      passed to  `geosoft.gxpy.agg.Aggregate_image.figure_map` and `geosoft.gxpy.map.Map.new`</span>
<span class="sd">    :return:            `geosoft.gxpy.map.Map` instance</span>

<span class="sd">    .. versionadded:: 9.3</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">with</span> <span class="n">gxagg</span><span class="o">.</span><span class="n">Aggregate_image</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">grid_file</span><span class="p">,</span> <span class="n">shade</span><span class="o">=</span><span class="n">shade</span><span class="p">,</span> <span class="n">color_map</span><span class="o">=</span><span class="n">color_map</span><span class="p">,</span> <span class="n">contour</span><span class="o">=</span><span class="n">contour</span><span class="p">)</span> <span class="k">as</span> <span class="n">agg</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">agg</span><span class="o">.</span><span class="n">figure_map</span><span class="p">(</span><span class="n">file_name</span><span class="o">=</span><span class="n">map_file</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="image_file"><a class="viewcode-back" href="../../../geosoft.gxpy.grid.html#geosoft.gxpy.grid.image_file">[docs]</a><span class="k">def</span> <span class="nf">image_file</span><span class="p">(</span><span class="n">grid_file</span><span class="p">,</span> <span class="n">image_file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">image_type</span><span class="o">=</span><span class="n">gxmap</span><span class="o">.</span><span class="n">RASTER_FORMAT_PNG</span><span class="p">,</span> <span class="n">pix_width</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">shade</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color_map</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">contour</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">display_area</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pix_32_bit</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Save a grid file grid as a georeferenced image file.</span>

<span class="sd">    :param grid_file:   grid file name</span>
<span class="sd">    :param image_file:  image file name. The extension should be consistent with the image_type.</span>
<span class="sd">                        If not specified a temporary PNG file is created.</span>
<span class="sd">    :param image_type:  image type, one ot the RASTER_FORMAT constants in `geosoft.gxpy.map`.</span>
<span class="sd">    :param pix_width:   desired image width in pixels, default is the width of the aggregate base layer</span>
<span class="sd">    :param shade:       `True` to add shading effect</span>
<span class="sd">    :param color_map:   `geosoft.gxpy.group.Color_map` instance, or a colour ramp file name, default is grid&#39;s default</span>
<span class="sd">    :param contour:     colour contour interval if colours need to break at exact levels</span>
<span class="sd">    :param display_area:    `geosoft.gxpy.geometry.Point2` instance, which defines the desired display</span>
<span class="sd">                            area. The display area coordinate system can be different from the grid.</span>
<span class="sd">    :param pix_32_bit:  make 32-bit image (with 8-bit alpha background)</span>

<span class="sd">    :return:            image file name.</span>

<span class="sd">    .. versionadded:: 9.3.1</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">color_map</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">Grid</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">grid_file</span><span class="p">)</span> <span class="k">as</span> <span class="n">g</span><span class="p">:</span>
            <span class="n">color_map</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">get_default_color_map</span><span class="p">()</span>

    <span class="k">with</span> <span class="n">gxagg</span><span class="o">.</span><span class="n">Aggregate_image</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">grid_file</span><span class="p">,</span> <span class="n">shade</span><span class="o">=</span><span class="n">shade</span><span class="p">,</span> <span class="n">color_map</span><span class="o">=</span><span class="n">color_map</span><span class="p">,</span> <span class="n">contour</span><span class="o">=</span><span class="n">contour</span><span class="p">)</span> <span class="k">as</span> <span class="n">agg</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">agg</span><span class="o">.</span><span class="n">image_file</span><span class="p">(</span><span class="n">image_file</span><span class="p">,</span> <span class="n">image_type</span><span class="o">=</span><span class="n">image_type</span><span class="p">,</span> <span class="n">pix_width</span><span class="o">=</span><span class="n">pix_width</span><span class="p">,</span>
                              <span class="n">display_area</span><span class="o">=</span><span class="n">display_area</span><span class="p">,</span> <span class="n">pix_32_bit</span><span class="o">=</span><span class="n">pix_32_bit</span><span class="p">)</span></div>
</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">Geosoft GX Python API 2023.2.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">geosoft.gxpy.grid</a></li> 
      </ul>
    </div>

    <div class="footer" role="contentinfo">
        &#169; Copyright 2023, Geosoft Inc.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 3.2.1.
    </div>
<div class="footer">This page uses <a href="http://analytics.google.com/">
Google Analytics</a> to collect statistics. You can disable it by blocking
the JavaScript coming from www.google-analytics.com.
<script type="text/javascript">
  (function() {
    var ga = document.createElement('script');
    ga.src = ('https:' == document.location.protocol ?
              'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    ga.setAttribute('async', 'true');
    document.documentElement.firstChild.appendChild(ga);
  })();
</script>
</div>

  </body>
</html>